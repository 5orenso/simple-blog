{"version":3,"sources":["webpack:///./components/public/raceTracking.js"],"names":["MARGIN_TOP","mu","marginTop","initialState","marginTopBack","marginBottom","subMenuMarginTop","isLoading","email","submenu","jwtToken","util","getJwtToken","reloadInSec","reloadIsActive","leaderboardMode","filterByraceClass","showLeaderBoard","showNews","ReloadTimer","observer","props","initComponent","setState","tickReloadTimeer","reloadLastEpoch","state","now","Math","floor","Date","getTime","clearTimeout","updateTimer","tick","setTimeout","componentDidMount","this","componentWillUnmount","render","radius","fontSize","classNames","reloadPercent","normalizeBetween","class","key","color","showPercentText","percent","showCenterText","centerText","centerTextSize","centerTextY","Component","Results","chooseSubmenu","e","target","closest","dataset","stores","waypoints","raceStore","raceClass","race","onMarkerClick","style","id","title","length","role","map","musher","idx","restPercent","format","restTime","raceTime","displayNameShort","onClick","rank","finishTime","currentState","getRankingColor","bib","flag","diffToFirstFinishTime","secToHms","formatDate","parseInputDate","locale","hour12","hour","minute","distanceToFinish","distanceToFirst","distanceToForward","distanceToBehind","currentAvgSpeed","speed","states","duration","height","showText","MusherInfo","toggleAdminInfo","stopPropagation","showAdminInfo","toggleInfo","showInfo","onDogClick","dogid","dogs","preventDefault","currentDog","find","uuidv4","showDog","userStore","dog","wpData","wp","findWaypointByBib","isAdmin","user","currentUser","getMusherByBibId","getMusherByBibEmail","team","getTeamById","members","m","totals","getClassByBib","getTotalsByTeamId","image","getImage","priority","fallback","image1","shortname","dotColor","hasBirthday","birth","daysUntilBirthday","ceil","daysUntilNextBirthday","findNearestMushers","inFront","behind","headerImage","imageHeader","s3XXLargeLink","topImage1","teamImages","images","i","push","s3SmallLink","s3LargeLink","indexOf","followers","followRequests","findIndex","firstname","lastname","sportsClub","type","data-submenu","public","name","markdown","replaceImages","description","markdownOpts","getMarkdownOptions","d","allDogs","ucfirst","findHarness","harness","age","deceased","gender","JSON","stringify","TrackingMap","handleHistoryPointIndex","historyIdx","parseInt","value","reload","historyPointIndex","timerRunning","updateWaypointPosition","abs","playHistory","replaySpeed","raceTrackerPointTimestamp","getRaceTrackerTimestamp","playingHistory","history","pauseHistory","loadLiveRaceResults","classInfo","teamIds","focusOnMushers","bibs","historySteps","replayHistory","showDrawerReplay","getClassById","classid","getRaceTrackerData","raceTrackerRace","startDate","endDate","getRaceTrackerActiveTeams","console","log","RELOAD_INTERVAL_IN_SEC","loadRaceResults","loadWorkoutSummary","raceid","getWorkoutSummaryActiveTeams","loadRace","allClassIds","selectedClassId","allTeamIds","err","appState","filterByBibs","load","getAllClassesSortedBy","selectedClassIds","classes","setSelectedClassId","toggleSelectedClassId","filter","currentClass","contestants","flat","loadTeams","join","liveRace","setLeaderboardMode","parentElement","mode","chooseRaceClass","toggleShowLeaderBoard","hide","toggleShowNews","closeAllDrawers","showResults","showDrawerCheckpoint","showDrawerMusher","onMusherClick","onCpMarkerClick","cpData","selectedCheckpointId","toggleDrawerMusher","toggleDrawerCheckpoint","toggleResults","selectCheckpoint","showDrawer","onTeamClick","teamid","showTeam","hideTeam","onUserClick","hideDog","setReplaySpeed","parseFloat","filterByClass","toggleReplayHistory","cleanupMemoryClass","selectedMusherBib","toggleFocusOnMusher","musherid","toggleBib","checkForEnter","maxPoints","toggleLines","showLines","width","window","innerWidth","innerHeight","componentWillReceiveProps","nextProps","showHeader","drawerClassNames","drawerWidth","largeMarkers","isAnimatedMarkers","linkBase","geoJSONs","zoomToMarkers","selectedClass","wpCheckpoints","checkpoints","slice","cp","position","lat","lng","showTracking","countryRegexp","currentLocationGeocode","RegExp","test","formattedCountry","back","href","resultsHide","getPillClass","data-id","waypoints2","fullscreenMap","onMarker2Click","showHeatmap","showTracks","showDistanceMarkers","groupWaypoints","musherId","getMusherById","data-musherid","mapCredits","onCloseClick","min","max","onInput","data-speed","onClickNav","countryRegexpMessage"],"mappings":"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","file":"13.chunk.6226b.js","sourcesContent":["import { h, Component } from 'preact';\nimport { useEffect } from 'preact/hooks';\nimport util from 'preact-util';\nimport { observer } from 'mobx-preact';\nimport { Text, Localizer } from 'preact-i18n';\nimport { route } from 'preact-router';\nimport Markdown from 'preact-markdown';\nimport linkstate from 'linkstate';\n\nimport Trackmap from '../../components/public/trackmap';\nimport Gauge from '../../components/gauge';\n\nimport DogScroller from '../../components/dog/scroller';\nimport ImageScroller from '../imageScroller';\n\nimport Overlay from '../../components/overlay/';\nimport Drawer from '../../components/drawer/';\nimport HeaderCustom from '../../components/header/custom';\nimport Loading from '../../components/loading/';\nimport TeamsPublicDetail from '../../routes/teams/publicDetail';\nimport DogPublicDetail from '../../routes/dogs/publicDetail';\nimport RaceLiveCheckpointResult from '../../components/races/liveCheckpointResult';\nimport LineGraph from '../../components/lineGraph';\nimport States from '../../components/states';\nimport PublicTeam from '../team/public';\nimport RaceTrackingMusherDetail from './raceTrackingMusherDetail';\n\nimport mu from '../../lib/musher-util';\nconst MARGIN_TOP = mu.marginTop(true, false);\nconst MARGIN_TOP_BACK = mu.marginTopBack(false);\nconst MARGIN_BOTTOM = mu.marginBottom();\nconst SUB_MENU_MARGIN_TOP = mu.subMenuMarginTop();\n\nfunction PageTitle(title, classes = '', style = '') {\n    useEffect(() => {\n        document.title = `Homerun Race: ${title}`;\n    }, [title]);\n    return <span class={classes} style={style}>{title}</span>;\n}\n\nfunction getWindowDimensions() {\n    const { innerWidth: width, innerHeight: height } = window;\n    return {\n        width,\n        height\n    };\n}\n\nconst fieldSorter = (fields) => (a, b) => fields.map(o => {\n    let dir = 1;\n    if (o[0] === '-') { dir = -1; o=o.substring(1); }\n    return a[o] > b[o] ? dir : a[o] < b[o] ? -(dir) : 0;\n}).reduce((p, n) => p ? p : n, 0);\n\nconst initialState = {\n    isLoading: false,\n    email: '',\n    submenu: 'ads',\n    jwtToken: util.getJwtToken(),\n\n    reloadInSec: null,\n    reloadIsActive: false,\n\n    leaderboardMode: 'mushers',\n    filterByraceClass: '',\n    showLeaderBoard: true,\n    showNews: true,\n};\n\nconst RELOAD_INTERVAL_IN_SEC = 60;\nconst REPLAY_SPEED = 1;\n\n@observer\nclass ReloadTimer extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            ...initialState,\n        };\n        this.updateTimer = {};\n    }\n\n    initComponent = () => {\n        this.setState({\n            reloadIsActive: true,\n        }, () => this.tickReloadTimeer());\n    }\n\n    tickReloadTimeer = () => {\n        const { reloadLastEpoch } = this.props;\n        const { reloadIsActive } = this.state;\n        if (reloadIsActive) {\n            const now = Math.floor(new Date().getTime() / 1000);\n            const reloadInSec = RELOAD_INTERVAL_IN_SEC - (now - reloadLastEpoch);\n            this.setState({ reloadInSec });\n            clearTimeout(this.updateTimer.tick);\n            this.updateTimer.tick = setTimeout(() => this.tickReloadTimeer(), 1000);\n        }\n        return false;\n    }\n\n    componentDidMount() {\n        this.initComponent();\n    }\n\n    componentWillUnmount() {\n        clearTimeout(this.updateTimer.tick);\n    }\n\n    render() {\n        const { reloadInSec } = this.state;\n        const { radius = 13, fontSize = 11, classNames = '' } = this.props;\n        const reloadPercent = Math.floor(util.normalizeBetween(reloadInSec, 0, RELOAD_INTERVAL_IN_SEC, 0, 100))\n\n        return (<>\n            <span class={classNames}>\n                <Gauge key={`gauge-reload-page`}\n                    color='primary'\n                    radius={radius}\n                    showPercentText={false}\n                    percent={reloadPercent}\n                    showCenterText={true}\n                    centerText={reloadInSec}\n                    centerTextSize={fontSize}\n                    centerTextY={'55%'}\n                />\n            </span>\n        </>);\n    }\n}\n\n@observer\nclass Results extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n        };\n    }\n\n    chooseSubmenu = (e) => {\n\t\tconst submenu = e.target.closest('button').dataset.submenu;\n\t\tthis.setState({ submenu });\n\t}\n\n    render() {\n        const { raceStore, userStore } = this.props.stores;\n        const { submenu = 'details' } = this.state;\n        const { isAdmin } = userStore;\n\n        const { waypoints } = raceStore;\n        const { raceClass = {}, race = {}, onMarkerClick = () => {} } = this.props;\n\n        return (<>\n            <div class='d-flex justify-content-center align-items-center mb-2'>\n                <span style='font-size: 1.3em;'><Text id='races.gps-ranking'>GPS Ranking</Text>: {race.title} - {raceClass.title}</span>\n            </div>\n\n            <div\n                class='w-100 overflow-auto'\n                style='max-height: 60vh;'\n            >\n                {!waypoints || waypoints.length === 0 && <>\n                    <div class='text-center text-muted'>\n                        <div class='display-1'><i class='fas fa-dog' /></div>\n                        <div class='w-100'>\n                            <h3><Text id='races.no-teams-found'>No teams found!</Text></h3>\n                            <Text id='races.loading-teams'>Loading teams...</Text>\n                        </div>\n                        <div class='spinner-border text-primary' style='width: 3rem; height: 3rem;' role='status'>\n                            <span class='sr-only'>Loading...</span>\n                        </div>\n                    </div>\n                </>}\n\n                <table class='table table-sm table-striped'>\n                    {waypoints && waypoints.map((musher, idx) => {\n                        const restPercent = util.format(musher.restTime / musher.raceTime * 100, 0);\n                        const shortname = mu.displayNameShort(musher);\n\n                        return (<>\n                            <tr onClick={() => onMarkerClick(musher)}>\n                                <td style='width: 15px;' class='text-center'>{musher.rank}</td>\n                                <td>\n                                    <div class='d-flex justify-content-between align-items-start w-100'>\n                                        {/* <div\n                                            class='rounded-circle imageRounded imageRoundedSmallIcon float-left text-center'\n                                            style={`\n                                                background-image: url(\"${musher.image}\");\n                                                background-size: cover;\n                                                border: 1px ${mu.getRankingColor(musher.rank || idx + 1)} solid;\n                                                width: 30px !important;\n                                                height: 30px;\n                                                padding-top: 3px;\n                                            `}\n                                        >\n                                            {musher.image ? '' : shortname}\n                                        </div> */}\n                                        <div class='flex-grow-1'>\n                                            <div class='float-right ml-2'>\n                                                <div class='text-center'>\n                                                    <Gauge key={`gauge-reload-page`}\n                                                        color={restPercent < 40 ? (restPercent < 30 ? 'danger' : 'warning') : 'success'}\n                                                        radius={30}\n                                                        showPercentText={false}\n                                                        percent={restPercent}\n                                                        showCenterText={true}\n                                                        centerText={`${restPercent}%`}\n                                                        centerTextSize={15}\n                                                        centerTextY={'55%'}\n                                                    />\n                                                </div>\n                                            </div>\n                                            <div class='float-right'>\n                                                {musher.finishTime < 9999999999 ? <>\n                                                    <i class='fas fa-flag-checkered text-success' />\n                                                </> : <>\n                                                    {musher.currentState === 'rest' ? <>\n                                                        <i class='fas fa-bed text-warning' />\n                                                    </> : <>\n                                                        <i class='fas fa-running text-primary' />\n                                                    </>}\n                                                </>}\n                                            </div>\n\n                                            <span class='text-white rounded-pill-left px-2 mr-2'\n                                                style={`background-color: ${mu.getRankingColor(musher.rank || idx + 1)};`}\n                                            >\n                                                {musher.bib}\n                                            </span>\n\n                                            {musher.flag}  {musher.title}\n                                            <div>\n                                                <small>\n                                                    {musher.finishTime < 9999999999 ? <>\n                                                        {musher.diffToFirstFinishTime > 0 ? <>\n                                                            <span class='text-muted'><i class='fas fa-arrow-up' /></span> {util.secToHms(musher.diffToFirstFinishTime)}\n                                                        </> : <>\n                                                            <span class='text-muted'><i class='fas fa-flag-checkered' /></span> {util.formatDate(util.parseInputDate(musher.finishTime), { locale: 'no-NB', hour12: false, hour: '2-digit', minute: '2-digit' })}\n                                                        </>}\n                                                        <nobr>\n                                                            <i class='fas fa-running text-muted' /> {util.secToHms(musher.raceTime)}\n                                                        </nobr>\n                                                        <nobr>\n                                                            <i class='fas fa-bed ml-2 text-muted' /> {util.format(musher.restTime / musher.raceTime * 100, 0)}%\n                                                        </nobr>\n                                                    </> : <>\n                                                        {/* <span class='text-muted'><i class='fas fa-compass' /></span> {mu.windDirection(musher.bearing)} */}\n                                                        {/* {util.format(musher.totalDistanceOnTrack, 1)} km */}\n                                                        <nobr>\n                                                            <span class='text-muted'><i class='fas fa-flag-checkered' /></span> {util.format(musher.distanceToFinish, 1)} km\n                                                        </nobr>\n                                                        {musher.distanceToFinish !== musher.distanceToFirst && musher.distanceToFirst > 0 && <>\n                                                            <nobr>\n                                                                <span class='text-muted font-weight-light ml-2'>1st:</span> {util.format(musher.distanceToFirst, 1)} km\n                                                            </nobr>\n                                                        </>}\n                                                        {musher.distanceToFinish !== musher.distanceToForward && musher.distanceToForward > 0 && <>\n                                                            <nobr>\n                                                                <span class='text-muted ml-2'><i class='fas fa-arrow-up' /></span> {util.format(musher.distanceToForward, 1)} km\n                                                            </nobr>\n                                                        </>}\n                                                        {musher.distanceToBehind > 0 && <>\n                                                            <nobr>\n                                                                <span class='text-muted ml-2'><i class='fas fa-arrow-down' /></span> {util.format(musher.distanceToBehind, 1)} km\n                                                            </nobr>\n                                                        </>}\n                                                        <br />\n                                                        <nobr>\n                                                            <span class='text-muted'><i class='fas fa-tachometer-alt' /></span> {util.format((musher.currentAvgSpeed ? musher.currentAvgSpeed * 3.6 : musher.speed) || 0, 1)} km/h\n                                                        </nobr>\n                                                        <nobr>\n                                                            <i class='fas fa-running ml-2 text-muted' /> {util.secToHms(musher.raceTime)}\n                                                        </nobr>\n                                                        <nobr>\n                                                            <i class='fas fa-bed ml-2 text-muted' /> {util.format(musher.restTime / musher.raceTime * 100, 0)}%\n                                                        </nobr>\n                                                    </>}\n\n                                                </small>\n                                            </div>\n                                        </div>\n                                    </div>\n                                    <div class='mt-1 container-fluid'>\n                                        <States stores={this.props.stores} states={musher.states} duration={musher.raceTime} key={`state-${musher.bib}`} height={'6px'} showText={false} />\n                                    </div>\n                                </td>\n                            </tr>\n                        </>);\n                    })}\n                </table>\n\n                {/* waypoints: {JSON.stringify(waypoints.slice(0, 5), null, 4)}<br /> */}\n            </div>\n        </>);\n    }\n}\n\n@observer\nclass MusherInfo extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n        };\n    }\n\n    toggleAdminInfo = (e) => {\n        e.stopPropagation();\n        const { showAdminInfo } = this.state;\n        this.setState({\n            showAdminInfo: !showAdminInfo,\n        });\n    }\n\n    toggleInfo = (e) => {\n        e.stopPropagation();\n        const { showInfo } = this.state;\n        this.setState({\n            showInfo: !showInfo,\n        });\n    }\n\n    onDogClick = (e, dogid, dogs) => {\n        e.preventDefault();\n        e.stopPropagation();\n        const currentDog = dogs.find(e => e.uuidv4 === dogid);\n        this.setState({\n            currentDog,\n            showDog: dogid,\n            dogs,\n        });\n        return false;\n    }\n\n    chooseSubmenu = (e) => {\n\t\tconst submenu = e.target.closest('button').dataset.submenu;\n\t\tthis.setState({ submenu });\n\t}\n\n    render() {\n        const { raceStore, userStore } = this.props.stores;\n        const { showAdminInfo, showInfo, submenu = 'details', showDog, currentDog: dog = {} } = this.state;\n\n        const { waypoints, totalTrackLength } = raceStore;\n\n        const { wpData = {}, onMarkerClick = () => {} } = this.props;\n        const wp = raceStore.findWaypointByBib(wpData.bib);\n\n        const { isAdmin } = userStore;\n        const { user: currentUser = {} } = userStore;\n\n        const musher = (wpData.bib ? raceStore.getMusherByBibId(wpData.bib) : raceStore.getMusherByBibEmail(wpData.email)) || {};\n        const team = raceStore.getTeamById(musher.team);\n        const user = team.members ? team.members.find(m => m.email === musher.email) : {};\n        const raceClass = raceStore.getClassByBib(wpData.bib);\n        const totals = raceStore.getTotalsByTeamId(musher.team);\n        const image = mu.getImage({ user, team, priority: 'user', fallback: musher.image1 });\n        const shortname = mu.displayNameShort(user) || mu.displayNameShort(musher);\n\n        const dotColor = mu.getRankingColor(wp.rank);\n\n        const hasBirthday = mu.hasBirthday(dog.birth);\n        const daysUntilBirthday = dog.birth ? Math.ceil(mu.daysUntilNextBirthday(dog.birth)) : 365;\n\n        // const totalDistancePercent = util.format(wp.totalDistanceOnTrack / totalTrackLength * 100, 0);\n        const { inFront, behind } = raceStore.findNearestMushers(wpData.bib);\n\n        const restPercent = util.format(wp.restTime / wp.raceTime * 100, 0);\n        // const runPercent = 100 - restPercent;\n\n        const defaultImage = {\n            s3XXLargeLink: musher.topImage1 || './assets/homerun-race-logo.png',\n        };\n        const headerImage = team && team.imageHeader && team.imageHeader.s3XXLargeLink ? team.imageHeader : defaultImage;\n\n        const teamImages = team && team.images ? [...team.images] : [];\n        for (let i = 0, l = 3; i < l; i += 1) {\n            if (musher[`image${i}`]) {\n                teamImages.push(\n                    {\n                        s3SmallLink: musher[`image${i}`],\n                        s3LargeLink: musher[`image${i}`],\n                    }\n                );\n            }\n        }\n\n        const locale = 'en-GB';\n\n        const isYourTeam = team.members && team.members.indexOf(currentUser.id) > -1;\n        const isFollowing = team.followers && team.followers.indexOf(currentUser.id) > -1;\n        const hasRequestedFollow = team.followRequests && team.followRequests.findIndex(e => e.id === currentUser.id) > -1;\n\n        const now = Math.floor(new Date().getTime() / 1000);\n\n        return (<>\n            {behind.bib && <button class='btn btn-link text-primary mx-2 py-0 float-right' onClick={() => onMarkerClick(behind)} style='line-height: 1.0em; font-size: 2.0em;'>\n                <i class='fas fa-angle-right' />\n            </button>}\n            {inFront.bib && <button class='btn btn-link text-primary mx-2 py-0 float-right' onClick={() => onMarkerClick(inFront)} style='line-height: 1.0em; font-size: 2.0em;'>\n                <i class='fas fa-angle-left' />\n            </button>}\n\n            <div class='d-flex justify-content-center align-items-center mb-2'>\n                <span style='font-size: 1.3em; height: 16vh;'>&nbsp;</span>\n            </div>\n            <div\n                class='w-100 overflow-auto'\n                style='max-height: 55vh;'\n            >\n\n                <div class='w-100 position-absolute'\n                    style={`z-index: -1; height: 18vh; top: 0px; left: 0px; background-size: cover; background-repeat: no-repeat; background-position: 50% 30%; background-color: #a0a0a0; ${headerImage ? `background-image: url(\"${headerImage.s3XXLargeLink}\");` : ''}`}\n                />\n\n                <div class='d-flex position-relative'>\n                    <div\n                        class={`position-relative text-center border rounded-circle imageRounded imageRoundedMedium`}\n                        style={image ? `background-image: url(\"${image}\"); background-size: cover;` : ''}\n                    >\n                        {!image && <div class='text-muted' style='font-size: 25px; padding-top: 5px;'>{shortname}</div>}\n                        <div\n                            class={`rounded-pill-both px-2 text-center position-absolute ${dotColor ? '' : 'bg-secondary'} font-weight-bold`}\n                            style={`bottom: -20px; right: 0; ${dotColor ? `background-color: ${dotColor};` : ''}`}\n                        >\n                            {musher.bib && musher.bib !== 'n/a' && <>{musher.bib}</>}\n                        </div>\n                    </div>\n                    <div class='flex-grow-1 pl-3 text-overflow mb-3' style='line-height: 1.8em;'>\n                        <div class='float-right' style='font-size: 1.2em;'>\n                            {wp.finishTime < 9999999999 ? <>\n                                <i class='fas fa-flag-checkered text-success' />\n                            </> : <>\n                                {wp.currentState === 'rest' ? <>\n                                    <i class='fas fa-bed text-warning' />\n                                </> : <>\n                                    <i class='fas fa-running text-primary' />\n                                </>}\n                            </>}\n                        </div>\n                        {/* {!isYourTeam && !isFollowing && !hasRequestedFollow && team.public > 0 && <span class='float-right'>\n                            <PublicTeam stores={this.props.stores} team={team} buttonOnly={true} simple={true} classNames={'btn btn-link text-primary'} />\n                        </span>} */}\n\n                        <h3 class='mb-0'>\n                            {musher.flag} {musher.firstname} {musher.lastname}\n                        </h3>\n                        <h6 class='mb-0'>{musher.sportsClub || <>&nbsp;</>}</h6>\n                    </div>\n                </div>\n\n                <div class='d-flex justify-content-center mb-3'>\n                    <div class='col px-0 pt-2'>\n                        <button\n                            type='button'\n                            class={`btn btn-block rounded-pill-left rounded-none ${submenu === 'details' ? 'btn-primary' : 'btn-outline-primary'} text-nowrap`}\n                            style='text-overflow: ellipsis; overflow: hidden;'\n                            onClick={this.chooseSubmenu}\n                            data-submenu='details'\n                        >\n                            Details\n                        </button>\n                    </div>\n                    <div class='col px-0 pt-2'>\n                        <button\n                            type='button'\n                            class={`btn btn-block rounded-none ${submenu === 'team' ? 'btn-primary' : 'btn-outline-primary'} text-nowrap`}\n                            style='text-overflow: ellipsis; overflow: hidden;'\n                            onClick={this.chooseSubmenu}\n                            data-submenu='team'\n                        >\n                            Team\n                        </button>\n                    </div>\n                    <div class='col px-0 pt-2'>\n                        <button\n                            type='button'\n                            class={`btn btn-block rounded-pill-right rounded-none ${submenu === 'dogs' ? 'btn-primary' : 'btn-outline-primary'} text-nowrap`}\n                            style='text-overflow: ellipsis; overflow: hidden;'\n                            onClick={this.chooseSubmenu}\n                            data-submenu='dogs'\n                        >\n                            Dogs\n                        </button>\n                    </div>\n                </div>\n\n                <div\n                    class='w-100 overflow-auto position-relative'\n                >\n                    {submenu === 'details' && <>\n                        <RaceTrackingMusherDetail\n                            stores={this.props.stores}\n                            wp={wp}\n                            musher={musher}\n                        />\n                    </>}\n                    {submenu === 'team' && <>\n                        {team.public > 0 ? <>\n                            <h3>{team.name}</h3>\n                            <Markdown markdown={mu.replaceImages(team.description, team.images)} markdownOpts={mu.getMarkdownOptions()} />\n                            <ImageScroller stores={this.props.stores} images={teamImages} />\n                        </> : <>\n                            <div class='text-center text-muted'>\n                                <div class='display-1'><i class='fas fa-dog' /></div>\n                                <h3><Text id='teams.no-public-team'>No public team!</Text></h3>\n                                <Text id='teams.no-public-team'>This team is not publicly visible.</Text>\n                                {teamImages && <div class='my-3'><ImageScroller stores={this.props.stores} images={teamImages} /></div>}\n                            </div>\n                        </>}\n                    </>}\n                    {submenu === 'dogs' && <>\n                        {team.public > 0 ? <>\n                            {team.dogs && <div class='w-100 container-fluid'>\n                                <div class='row pt-2'>\n                                    <DogScroller stores={this.props.stores} dogs={team.dogs.map(d => d.id)} allDogs={team.dogs} onDogClick={this.onDogClick} />\n                                </div>\n                            </div>}\n                            {showDog && <>\n                                <div class='d-flex mb-0 mt-3 position-relative'>\n                                    <div class={`text-center border rounded-circle imageRounded imageRoundedLarge text-muted pt-2`} style={dog.image ? `background-image: url(\"${dog.image.s3LargeLink}\"); background-size: cover;` : ''}>\n                                        {!dog.image && <span class='font-weight-lighter' style='font-size: 35px;'>{util.ucfirst(dog.name, true)}</span>}\n                                    </div>\n                                    <div class='flex-grow-1 pl-3 pr-2'\n                                        style={`border-right: 4px solid ${userStore.findHarness(dog.harness, 'colorNonstop')} !important; line-height: 1.2em;`}\n                                    >\n                                        <h5 class='mb-1'>\n                                            {dog.shortname || dog.name} {dog.shortname && dog.shortname !== '' && <> - <span class='font-weight-lighter'>{dog.name}</span></>}\n                                            {hasBirthday && <>\n                                                <i class='fas fa-birthday-cake ml-3' />\n                                            </>}\n                                        </h5>\n                                        <div>\n                                            {daysUntilBirthday < 7 && <>\n                                                <span class='text-muted mr-2'>\n                                                    <i class='fas fa-birthday-cake' /> in {daysUntilBirthday} days\n                                                </span>\n                                            </>}\n                                            {dog.birth && <span class='mr-2'>{util.age(dog.birth, dog.deceased)}</span>}\n                                            {dog.gender === 'female' ? <i class='fas fa-venus' /> : <i class='fas fa-mars' />}\n                                        </div>\n                                    </div>\n                                </div>\n                                {/* <xmp>dog: {JSON.stringify(dog, null, 4)}</xmp> */}\n                            </>}\n                        </> : <>\n                            <div class='text-center text-muted'>\n                                <div class='display-1'><i class='fas fa-dog' /></div>\n                                <h3><Text id='teams.no-public-team'>No public team!</Text></h3>\n                                <Text id='teams.no-public-team'>This team is not publicly visible.</Text>\n                            </div>\n                        </>}\n                    </>}\n\n                    {isAdmin && <div style='max-height: 200px; max-width: 70vw; overflow: auto;'>\n                        <button class='btn btn-link btn-block' onClick={this.toggleAdminInfo}>\n                            Toggle admin info\n                        </button>\n                        {showAdminInfo && <>\n                            <small>\n                                <xmp>\n                                    musher: {JSON.stringify(musher, null, 4)}<br />\n                                    user: {JSON.stringify(user, null, 4)}<br />\n                                    team: {JSON.stringify(team, null, 4)}<br />\n                                    totals: {JSON.stringify(totals, null, 4)}<br />\n\n                                    {/* {\n                                        \"firstDate\": \"2021-03-19 11:59\",\n                                        \"lastDate\": \"2021-03-20 17:13\",\n                                        \"firstEpoch\": 1616151540000,\n                                        \"lastEpoch\": 1616256780000,\n                                        \"now\": {\n                                            \"$numberDecimal\": \"1642675856939\"\n                                        },\n                                        \"totalTimeUsedSec\": 26524316,\n                                        \"totalWorkoutTimeUsedSec\": 130895,\n                                        \"lastDuration\": 25655,\n                                        \"team\": 84,\n                                        \"count\": 4,\n                                        \"distanceKm\": 301.5906237951766,\n                                        \"elevation\": 3610.019075719202,\n                                        \"duration\": 77343,\n                                        \"rest\": 1332,\n                                        \"speedAvg\": 8.294634979660305,\n                                        \"totalRest\": 54884,\n                                        \"loadIndex\": 1080.75,\n                                        \"totalKcalRelated\": 544.535560976128,\n                                        \"weightedTotalKcal\": 12303.171406247127,\n                                        \"flatTotalKcal\": 9424.70699359927,\n                                        \"firstGpxStartEpoch\": null,\n                                        \"lastGpxStartEpoch\": null\n                                    } */}\n\n                                </xmp>\n                            </small>\n                        </>}\n                    </div>}\n                </div>\n            </div>\n        </>);\n    }\n}\n\n@observer\nclass TrackingMap extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            ...initialState,\n            reloadLastEpoch: Math.floor(new Date().getTime() / 1000),\n            historyPointIndex: 0,\n            timerRunning: true,\n            replayHistory: false,\n            replaySpeed: REPLAY_SPEED,\n        };\n        this.updateTimer = {};\n    }\n\n    handleHistoryPointIndex = (e) => {\n        const historyIdx = parseInt(e.target.value, 10);\n        clearTimeout(this.updateTimer.reload);\n\n        // console.log({ historyIdx });\n        this.setState({\n            historyPointIndex: historyIdx,\n            timerRunning: false,\n        }, () => {\n            const { historyPointIndex } = this.state;\n            const { raceStore } = this.props.stores;\n            raceStore.updateWaypointPosition(Math.abs(historyPointIndex));\n        });\n    }\n\n    playHistory = () => {\n        clearTimeout(this.updateTimer.reload);\n        const { historyPointIndex, replaySpeed } = this.state;\n        const { raceStore } = this.props.stores;\n        const raceTrackerPointTimestamp = raceStore.getRaceTrackerTimestamp(historyPointIndex + 1);\n        // console.log('playHistory', { historyPointIndex });\n        const state = {\n            historyPointIndex: historyPointIndex + 1,\n            timerRunning: false,\n            playingHistory: true,\n        };\n        if (raceTrackerPointTimestamp) {\n            state.raceTrackerPointTimestamp = raceTrackerPointTimestamp\n        }\n        this.setState({\n            ...state,\n        }, () => {\n            raceStore.updateWaypointPosition(Math.abs(historyPointIndex + 1));\n        });\n\n        // Set replay timer\n        clearTimeout(this.updateTimer.history);\n        this.updateTimer.history = setTimeout(() => {\n            this.playHistory();\n        }, replaySpeed * 1000);\n    }\n\n    pauseHistory = () => {\n        clearTimeout(this.updateTimer.history);\n        this.setState({\n            playingHistory: false,\n        });\n    }\n\n    loadLiveRaceResults = async (props = this.props, { teamIds, focusOnMushers, bibs, classid, historySteps }) => {\n        const { raceStore, userStore } = props.stores;\n        const { race } = raceStore;\n        const { historyPointIndex, replayHistory, timerRunning } = this.state;\n        const { showDrawerReplay } = this.props;\n        const classInfo = raceStore.getClassById(classid) || {};\n        const { isAdmin } = userStore;\n\n        await raceStore.getRaceTrackerData(race.raceTrackerRace, {\n            historySteps,\n            history: (replayHistory || showDrawerReplay),\n            bibs,\n            classid,\n            startDate: classInfo.startDate,\n            endDate: classInfo.endDate,\n            isAdmin,\n        });\n        raceStore.getRaceTrackerActiveTeams(teamIds, focusOnMushers, bibs);\n\n        // Set reload timer\n        if (timerRunning) {\n            clearTimeout(this.updateTimer.reload);\n            this.updateTimer.reload = setTimeout(() => {\n                console.log('loadLiveRaceResults.reloading...');\n                const reloadLastEpoch = Math.floor(new Date().getTime() / 1000);\n                this.setState({ reloadLastEpoch });\n                // this.loadRace(props);\n                this.loadLiveRaceResults(this.props, { teamIds, focusOnMushers, bibs, classid, historySteps });\n            }, RELOAD_INTERVAL_IN_SEC * 1000);\n        }\n    }\n\n    loadRaceResults = async (props = this.props, teamIds, focusOnMushers) => {\n        const { raceStore } = props.stores;\n        const { raceid } = props;\n        const { timerRunning } = this.state;\n\n        await raceStore.loadWorkoutSummary(teamIds, raceid);\n        raceStore.getWorkoutSummaryActiveTeams(teamIds, focusOnMushers);\n\n        if (timerRunning) {\n            clearTimeout(this.updateTimer.reload);\n            this.updateTimer.reload = setTimeout(() => {\n                const reloadLastEpoch = Math.floor(new Date().getTime() / 1000);\n                this.setState({ reloadLastEpoch });\n                // this.loadRace(props);\n                this.loadRaceResults(this.props, teamIds, focusOnMushers);\n            }, RELOAD_INTERVAL_IN_SEC * 1000);\n        }\n    }\n\n    loadRace = async (props = this.props) => {\n        try {\n            this.setState({ isLoading: true });\n            const { raceStore, appState } = props.stores;\n            const { raceid, classid, filterByBibs, historySteps } = props;\n            await raceStore.load(raceid);\n            raceStore.getAllClassesSortedBy();\n\n            const { race } = raceStore;\n            const { focusOnMushers } = appState;\n\n            const { selectedClassIds = [] } = appState;\n            const allClassIds = race?.classes.map(e => e.id);\n            let selectedClassId = classid || selectedClassIds[0];\n            if (allClassIds.indexOf(selectedClassId) === -1) {\n                selectedClassId = allClassIds[0];\n                appState.setSelectedClassId(selectedClassId);\n            }\n            if (classid) {\n                appState.toggleSelectedClassId(classid, true);\n            }\n            const allTeamIds = race.classes\n                .filter(currentClass => currentClass.id === selectedClassId)\n                .filter(currentClass => currentClass.contestants && currentClass.contestants.length > 0)\n                .map((currentClass) => {\n                    return currentClass.contestants.filter(musher => musher.team > 0).map(musher => musher.team);\n                })\n                .flat();\n\n            const bibs = filterByBibs ? filterByBibs : race.classes\n                .filter(currentClass => currentClass.id === selectedClassId)\n                .filter(currentClass => currentClass.contestants && currentClass.contestants.length > 0)\n                .map((currentClass) => {\n                    return currentClass.contestants.filter(musher => musher.bib > 0).map(musher => musher.bib);\n                })\n                .flat();\n\n            if (allTeamIds.length > 0) {\n                await raceStore.loadTeams(allTeamIds.join(','), false, true, true);\n            }\n            if (race.liveRace > 0) {\n                await this.loadLiveRaceResults(this.props, { teamIds: allTeamIds, focusOnMushers, bibs, classid: selectedClassId, historySteps });\n            } else {\n                await this.loadRaceResults(this.props, allTeamIds, focusOnMushers);\n            }\n\n            this.setState({ isLoading: false });\n\t\t} catch (err) {\n\t\t\tconsole.log(err);\n\t\t}\n    }\n\n    setLeaderboardMode = (e) => {\n        const leaderboardMode = e.target.parentElement.dataset.mode || e.target.dataset.mode;\n        this.setState({ leaderboardMode })\n    }\n\n    chooseRaceClass = (e) => {\n        const filterByraceClass = e.target.value;\n        this.setState({ filterByraceClass })\n    }\n\n    toggleShowLeaderBoard = (hide) => {\n        const { showLeaderBoard } = this.state;\n        if (hide === true) {\n            this.setState({ showLeaderBoard: false });\n        } else {\n            this.setState({ showLeaderBoard: !showLeaderBoard });\n        }\n    }\n\n    toggleShowNews = (hide) => {\n        const { showNews } = this.state;\n        if (hide === true) {\n            this.setState({ showNews: false });\n        } else {\n            this.setState({ showNews: !showNews });\n        }\n    }\n\n    componentWillUnmount() {\n        clearTimeout(this.updateTimer.reload);\n        clearTimeout(this.updateTimer.history);\n        clearTimeout(this.updateTimer.tick);\n    }\n\n    componentDidMount() {\n        this.loadRace();\n        try {\n            const { width, height } = getWindowDimensions();\n            if (width < 800) {\n                this.toggleShowLeaderBoard(true);\n                this.toggleShowNews(true);\n            }\n        } catch (err) {\n            console.log(err);\n        }\n    }\n\n    componentWillReceiveProps(nextProps) {\n        if (this.props.classid !== nextProps.classid || this.props.showDrawerReplay !== nextProps.showDrawerReplay) {\n\t\t    this.loadRace(nextProps);\n        }\n\t}\n\n    closeAllDrawers = () => {\n        this.setState({\n            showResults: false,\n            showDrawerCheckpoint: false,\n            showDrawerMusher: false,\n        });\n    }\n\n    onMarkerClick = (wpData) => {\n        this.closeAllDrawers();\n        this.setState({\n            showDrawerMusher: true,\n            wpData,\n        });\n    }\n\n    onMusherClick = (wpData) => {\n        this.setState({\n            showDrawerMusher: true,\n            wpData,\n        });\n    }\n\n    onCpMarkerClick = (cpData) => {\n        if (!cpData || !cpData.id) {\n            return null;\n        }\n        this.closeAllDrawers();\n        this.setState({\n            selectedCheckpointId: cpData.id,\n            showDrawerCheckpoint: true,\n            cpData,\n        });\n    }\n\n    toggleDrawerMusher = () => {\n        const { showDrawerMusher } = this.state;\n        this.setState({\n            showDrawerMusher: !showDrawerMusher,\n        });\n    }\n\n    toggleDrawerCheckpoint = () => {\n        const { showDrawerCheckpoint } = this.state;\n        this.setState({\n            showDrawerCheckpoint: !showDrawerCheckpoint,\n        });\n    }\n\n    toggleResults = () => {\n        const { showResults } = this.state;\n        this.closeAllDrawers();\n        this.setState({            \n            showResults: !showResults,\n        });\n    }\n\n    selectCheckpoint = (selectedCheckpointId) => {\n        this.closeAllDrawers();\n        this.setState({\n            selectedCheckpointId,\n            showDrawerCheckpoint: true,\n            showDrawerMusher: false,\n            showDrawer: false,\n        });\n    }\n\n    // Overlay functions\n    onTeamClick = (e, teamid) => {\n        e.preventDefault();\n        e.stopPropagation();\n        this.setState({\n            showTeam: teamid,\n        });\n        return false;\n    }\n\n    hideTeam = () => {\n        this.setState({\n            showTeam: null,\n        });\n    }\n\n    onUserClick = (e, userid) => {\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n    }\n\n    onDogClick = (e, dogid, dogs) => {\n        e.preventDefault();\n        e.stopPropagation();\n        this.setState({\n            showDog: dogid,\n            dogs,\n        });\n        return false;\n    }\n\n    hideDog = () => {\n        this.setState({\n            showDog: null,\n        });\n    }\n\n    // /Overlay functions\n\n    setReplaySpeed = (e) => {\n        const speed = e.target.closest('button').dataset.speed;\n        this.setState({\n            replaySpeed: parseFloat(speed),\n        });\n    }\n\n\tfilterByClass = async (e) => {\n        try {\n            const selectedClassId = e.target.closest('button').dataset.id;\n\n            const {\n                showDrawerReplay,\n                historySteps,\n                filterByBibs,\n            } = this.props;\n            const { replayHistory } = this.state;\n            if (replayHistory || showDrawerReplay) {\n                this.toggleReplayHistory();\n            }\n\n            const { appState, raceStore } = this.props.stores;\n            raceStore.cleanupMemoryClass();\n            appState.toggleSelectedClassId(selectedClassId, true);\n\n            const { race } = raceStore;\n            const { focusOnMushers } = appState;\n\n            const allTeamIds = race.classes\n                .filter(currentClass => currentClass.id === selectedClassId)\n                .filter(currentClass => currentClass.contestants && currentClass.contestants.length > 0)\n                .map((currentClass) => {\n                    return currentClass.contestants.filter(musher => musher.team > 0).map(musher => musher.team);\n                })\n                .flat();\n\n            const bibs = filterByBibs ? filterByBibs : race.classes\n                .filter(currentClass => currentClass.id === selectedClassId)\n                .filter(currentClass => currentClass.contestants && currentClass.contestants.length > 0)\n                .map((currentClass) => {\n                    return currentClass.contestants.filter(musher => musher.bib > 0).map(musher => musher.bib);\n                })\n                .flat();\n\n            this.setState({\n                allTeamIds,\n                bibs,\n                selectedMusherBib: '',\n                showDrawerCheckpoint: false,\n                showDrawerMusher: false,\n                showDrawer: false,\n            });\n\n            if (allTeamIds.length > 0) {\n                await raceStore.loadTeams(allTeamIds.join(','), false, true, true);\n            }\n            if (race.liveRace > 0) {\n                await this.loadLiveRaceResults(this.props, { teamIds: allTeamIds, focusOnMushers, bibs, classid: selectedClassId, historySteps });\n\n            } else {\n                await this.loadRaceResults(this.props, allTeamIds, focusOnMushers);\n            }\n\t\t} catch (err) {\n\t\t\tconsole.log(err);\n\t\t}\n\t}\n\n    toggleFocusOnMusher = (e) => {\n        try {\n            const musherId = e.target.parentElement.dataset.musherid || e.target.dataset.musherid;\n            const { appState, raceStore } = this.props.stores;\n            appState.toggleFocusOnMusher(musherId);\n\n            const { focusOnMushers = [], selectedClassIds = [] } = appState;\n            const classid = selectedClassIds[0]\n\n            const { race } = raceStore;\n            const bibs = race.classes\n                .filter(currentClass => currentClass.id === classid)\n                .filter(currentClass => currentClass.contestants && currentClass.contestants.length > 0)\n                .map((currentClass) => {\n                    return currentClass.contestants.filter(musher => musher.bib > 0).map(musher => musher.bib);\n                })\n                .flat();\n\n            if (race.liveRace > 0) {\n                raceStore.getRaceTrackerActiveTeams(null, focusOnMushers, bibs);\n            } else {\n                raceStore.getWorkoutSummaryActiveTeams(null, focusOnMushers, bibs);\n            }\n\t\t} catch (err) {\n\t\t\tconsole.log(err);\n\t\t}\n\t}\n\n    toggleBib = () => {\n        try {\n            const { bib } = this.state;\n            const { appState, raceStore } = this.props.stores;\n            const musher = raceStore.getMusherByBibId(bib);\n            appState.toggleFocusOnMusher(musher.id);\n\t\t} catch (err) {\n\t\t\tconsole.log(err);\n\t\t}\n    }\n\n    checkForEnter = (e) => {\n        if (e.key === 'Enter') {\n            this.toggleBib();\n        }\n    }\n\n    toggleReplayHistory = () => {\n        const { replayHistory } = this.state;\n        clearTimeout(this.updateTimer.reload);\n        this.setState({\n            showDrawer: false,\n            historyPointIndex: 0,\n            replayHistory: !replayHistory,\n            timerRunning: replayHistory,\n        }, async () => {\n            await this.loadRace();\n            const { historyPointIndex } = this.state;\n            const { raceStore } = this.props.stores;\n            const { maxPoints } = raceStore;\n            if (replayHistory) {\n                console.log('toggleReplayHistory: setting to maxPoints', maxPoints);\n                raceStore.updateWaypointPosition(Math.abs(maxPoints - 1));\n            } else {\n                console.log('toggleReplayHistory: setting to first points');\n                for (let i = 0, l = 10; i < l; i += 1) {\n                    raceStore.updateWaypointPosition(Math.abs(historyPointIndex + i));\n                }\n            }\n        });\n    }\n\n    toggleLines = () => {\n        const { showLines } = this.state;\n        this.setState({\n            showLines: !showLines,\n        });\n    }\n\n    render() {\n        const { historyPointIndex, timerRunning, playingHistory, replaySpeed, raceTrackerPointTimestamp, showLines,\n            allTeamIds, bibs,\n        } = this.state;\n        const { userStore, raceStore, appState } = this.props.stores;\n        const { user = {}, teams = [], isAdmin } = userStore;\n        const { language = 'en' } = user;\n\n        const {\n            raceid,\n            path,\n            showHeader = true,\n            drawerClassNames,\n            drawerWidth,\n            showDrawerReplay,\n            largeMarkers,\n            isAnimatedMarkers,\n            linkBase = '/app-races/',\n        } = this.props;\n        const { focusOnMushers = [], infoOnMushers = [], selectedClassIds = [] } = appState;\n\n        const filterByClassId = (c) => {\n\t\t\tif (selectedClassIds.length > 0) {\n\t\t\t\treturn selectedClassIds.indexOf(c.id) > -1;\n\t\t\t}\n\t\t\treturn true;\n\t\t};\n\n        const { leaderboardMode, filterByraceClass, showLeaderBoard, showNews, reloadLastEpoch,\n            showDrawerMusher, showDrawerCheckpoint,\n            wpData = {},\n            cpData = {},\n            showResults,\n            showTeam, showDog,\n            submenu, replayHistory,\n            selectedCheckpointId,\n        } = this.state;\n\n        const { activeTeams, teamList, waypoints, geoJSONs, waypoints2, waypoints3, zoomToMarkers, classes, race, racetrackerData, maxPoints } = raceStore;\n\n        const musher = wpData.bib ? raceStore.getMusherByBibId(wpData.bib) : raceStore.getMusherByBibEmail(wpData.email);\n        const team = raceStore.getTeamById(musher.team);\n        const selectedClass = raceStore.getClassById(selectedClassIds[0]) || {};\n\n        let wpCheckpoints = [];\n        if (selectedClass.waypoints && selectedClass.waypoints.length > 0) {\n            wpCheckpoints = selectedClass.waypoints;\n        } else if (selectedClass.checkpoints && selectedClass.checkpoints.length > 0) {\n            wpCheckpoints = selectedClass.checkpoints\n                .slice()\n                .filter(cp => cp.position && cp.position[0])\n                .map(cp => ({\n                    id: cp.id,\n                    title: cp.name,\n                    lat: cp.position[0],\n                    lng: cp.position[1],\n                }));\n        }\n\n        let showTracking = true;\n        if (race.countryRegexp) {\n            if (user && user.currentLocationGeocode) {\n                const regexp = new RegExp(race.countryRegexp, 'i');\n                if (regexp.test(user.currentLocationGeocode.formattedCountry)) {\n                    showTracking = false;\n                }\n            }\n        }\n\n        return (<>\n            {showTeam && <Overlay>\n                <TeamsPublicDetail stores={this.props.stores} teamid={showTeam} marginTop={'0px;'} marginBottom={'0px;'} back={this.hideTeam} hideTeam={this.hideTeam} />\n            </Overlay>}\n            {showDog && <Overlay>\n                <DogPublicDetail stores={this.props.stores} dogid={showDog} marginTop={'0px;'} marginBottom={'0px;'} back={this.hideDog} dogs={team.dogs} />\n            </Overlay>}\n\n\n            {showHeader && <HeaderCustom height={MARGIN_TOP}>\n                <div class='d-flex justify-content-between align-items-center w-100'>\n                    <div class='d-flex align-items-center'>\n                        <span class='' style='font-size: 2.3em;'>\n                            <a href={`${linkBase}${race.id}`}>\n                                <i class='fas fa-angle-left' />\n                            </a>\n                        </span>\n                        <span class='ml-4 text-primary' style='font-size: 1.4em;' onClick={this.toggleResults}>\n                            <i class='fas fa-list-ol' />\n                        </span>\n                        <span class='ml-4 text-primary' style='font-size: 1.4em;' >\n                            {!race.resultsHide && <a href={`${linkBase}${race.id}/results`}>\n                                <i class='fas fa-stopwatch' />\n                            </a>}\n                        </span>\n                    </div>\n                    <div>\n                        <span class='font-weight-normal text-white' style='font-size: 1.2em;'>{race.title}</span>\n                    </div>\n                    {race.liveRace > 0 ? <>\n                        <div class='d-flex align-items-center text-primary' onClick={this.toggleReplayHistory}>\n                            <span class=''>Replay</span>\n                            <span class='ml-2' style='font-size: 1.4em;'>\n                                <i class='fas fa-play' />\n                            </span>\n                        </div>\n                    </> : <>\n                        <div class='d-flex align-items-center'>\n                            &nbsp;\n                        </div>\n                    </>}\n                </div>\n\n                <div class='w-100 overflow-hidden'>\n                    <div\n                        class='d-flex flex-row flex-nowrap pb-2 px-1'\n                        style='overflow: auto; scroll-snap-type: x mandatory;'\n                    >\n                        {race.classes && race.classes.map((currentClass, idx) => <>\n                            <div class='col px-0 pt-0'>\n                                <button\n                                    type='button'\n                                    class={`btn btn-block ${mu.getPillClass(race.classes.length, idx)} rounded-none ${selectedClassIds.indexOf(currentClass.id) > -1 ? 'btn-primary' : 'btn-outline-primary'} text-nowrap`}\n                                    style='text-overflow: ellipsis; overflow: hidden;'\n                                    onClick={this.filterByClass}\n                                    data-id={currentClass.id}\n                                >\n                                    {currentClass.title}\n                                </button>\n                            </div>\n                        </>)}\n                    </div>\n                </div>\n            </HeaderCustom>}\n\n            {!showTracking ? <>\n                <div\n                    class='container-fluid position-relative p-0 w-100 h-100'\n                    style={`margin-top: ${showHeader ? MARGIN_TOP : 0};`}\n                >\n                    <div class='text-center text-muted'>\n                        <div class='display-1'><i class='fas fa-hand-paper' /></div>\n                        <h3>Not allowed to view tracking</h3>\n                        {race.countryRegexpMessage}\n                    </div>\n                </div>\n            </> : <>\n                <div\n                    class='container-fluid position-relative p-0 w-100 h-100'\n                    style={`margin-top: ${showHeader ? MARGIN_TOP : 0};`}\n                >\n                    {race.id ? <>\n                        <Trackmap\n                            marginTop={MARGIN_TOP}\n                            stores={this.props.stores}\n                            raceid={raceid}\n                            waypoints={waypoints}\n                            geoJSONs={showLines ? geoJSONs : null}\n                            // waypoints2={waypoints2}\n                            // waypoints3={waypoints3}\n                            waypoints2={wpCheckpoints}\n\n                            zoomToMarkers={zoomToMarkers}\n                            fullscreenMap={true}\n                            onMarkerClick={this.onMarkerClick}\n                            onMarker2Click={this.onCpMarkerClick}\n                            showHeatmap={race.liveRace < 1}\n                            allTeamIds={allTeamIds}\n                            showTracks={race.liveRace >= 1}\n                            selectedClassIds={selectedClassIds}\n                            showDistanceMarkers={false}\n                            groupWaypoints={false}\n                            focusOnMushers={focusOnMushers}\n                            largeMarkers={largeMarkers}\n                            isAnimatedMarkers={isAnimatedMarkers}\n                            replaySpeed={replaySpeed * 1000}\n                            // key={`trackmap-${selectedClassIds.join('-')}`}\n                            // key={`heatmap-${racetrackerData.map(e => e.bib).join('-')}`}\n                            // mapid={`heatmap-${racetrackerData.map(e => e.bib).join('-')}`}\n                        />\n                    </> : <>\n                        <Loading stores={this.props.stores} />\n                    </>}\n\n\n                    {timerRunning && <div class='position-absolute' style='top: 125px; left: 5px; z-index: 9999; width: 30px; height: 30px;'>\n                        <ReloadTimer stores={this.props.stores} classNames='float-right ml-2' reloadLastEpoch={reloadLastEpoch} />\n                    </div>}\n\n                    {focusOnMushers && focusOnMushers.length > 0 && <>\n                        <div\n                            class='row mb-2'\n                            style='\n                                background-color: #1C1F4C;\n                                background-image: url(\"https://themusher.app/assets/tv-single-background.jpg\");\n                                background-size: cover !important;\n                                background-position: 0 0;\n                                border-radius: 10px;\n                            '\n                        >\n                            <div class='col-12 text-white' style='font-size: 1.3em;'>\n                                {focusOnMushers && focusOnMushers.map(musherId => {\n                                    const musher = raceStore.getMusherById(musherId);\n                                    return <>\n                                        <div>\n                                            <nobr>\n                                                <span class='mr-2' onClick={this.toggleFocusOnMusher} data-musherid={musher.id}>{focusOnMushers.indexOf(musher.id) > -1 ? <i class='fas fa-times text-warning' /> : <i class='far fa-star' />}</span>\n                                                <span class='text-right' style='width: 50px; display: inline-block;'>{musher.bib}</span> {musher.flag} {musher.firstname} {musher.lastname}<br />\n                                                {/* <small class='text-muted'>{musher.sportsClub}</small><br /> */}\n                                            </nobr>\n                                        </div>\n                                    </>\n                                })}\n                            </div>\n                        </div>\n                    </>}\n\n                    {race.mapCredits && <>\n                        <div class='position-absolute' style='bottom: 30px; left: 7px; z-index: 9999; width: 100px; height: 40px;'>\n                            <Markdown markdown={mu.replaceImages(race.mapCredits, race.images)} markdownOpts={mu.getMarkdownOptions()} />\n                        </div>\n                    </>}\n\n                    {/* <div class={`row`}>\n                        <div class='col-12 form-inline align-top d-flex justify-content-center'>\n                            <div class='form-group'>\n                                <input\n                                    class='form-control form-control-lg text-dark border-primary'\n                                    style='background-color: inherit;'\n                                    type='text'\n                                    onInput={linkstate(this, 'bib')}\n                                    onKeyDown={this.checkForEnter}\n                                />\n                                <button\n                                    type='button'\n                                    class='ml-2 btn btn-lg btn-primary'\n                                    onClick={this.toggleBib}\n                                >Search for Bib</button>\n                            </div>\n                        </div>\n                    </div> */}\n\n                    {(showDrawerReplay || replayHistory) && <>\n                        <Drawer stores={this.props.stores} onCloseClick={this.toggleReplayHistory} classNames={drawerClassNames} width={drawerWidth}>\n\n                            {maxPoints > 0 ? <>\n                                <div class='d-flex justify-content-center mx-3'>\n                                    {playingHistory ? <>\n                                        <div class='pl-1'>\n                                            <button class='btn btn-warning' onClick={this.pauseHistory}><i class='fas fa-pause' /></button>\n                                        </div>\n                                    </> : <>\n                                        <div class='pl-1'>\n                                            <button class='btn btn-success' onClick={this.playHistory}><i class='fas fa-play' /></button>\n                                        </div>\n                                    </>}\n                                    <div class='pl-2 pt-2 flex-grow-1'>\n                                        <input type='range' class='custom-range w-100' min={0} max={maxPoints} value={historyPointIndex} onInput={this.handleHistoryPointIndex} />\n                                    </div>\n                                </div>\n                                <div class='d-flex justify-content-center'>\n                                    <div class='col px-0 pt-2'>\n                                        <button\n                                            type='button'\n                                            class={`btn btn-block rounded-pill-left rounded-none ${replaySpeed === 1 ? 'btn-secondary' : 'btn-outline-secondary'} text-nowrap`}\n                                            style='text-overflow: ellipsis; overflow: hidden;'\n                                            onClick={this.setReplaySpeed}\n                                            data-speed={1}\n                                        >\n                                            60x\n                                        </button>\n                                    </div>\n                                    <div class='col px-0 pt-2'>\n                                        <button\n                                            type='button'\n                                            class={`btn btn-block rounded-none ${replaySpeed === 0.5 ? 'btn-secondary' : 'btn-outline-secondary'} text-nowrap`}\n                                            style='text-overflow: ellipsis; overflow: hidden;'\n                                            onClick={this.setReplaySpeed}\n                                            data-speed={0.5}\n                                        >\n                                            120x\n                                        </button>\n                                    </div>\n                                    <div class='col px-0 pt-2'>\n                                        <button\n                                            type='button'\n                                            class={`btn btn-block rounded-none ${replaySpeed === 0.25 ? 'btn-secondary' : 'btn-outline-secondary'} text-nowrap`}\n                                            style='text-overflow: ellipsis; overflow: hidden;'\n                                            onClick={this.setReplaySpeed}\n                                            data-speed={0.25}\n                                        >\n                                            240x\n                                        </button>\n                                    </div>\n                                    <div class='col px-0 pt-2'>\n                                        <button\n                                            type='button'\n                                            class={`btn btn-block right rounded-none ${replaySpeed === 0.12 ? 'btn-secondary' : 'btn-outline-secondary'} text-nowrap`}\n                                            style='text-overflow: ellipsis; overflow: hidden;'\n                                            onClick={this.setReplaySpeed}\n                                            data-speed={0.12}\n                                        >\n                                            480x\n                                        </button>\n                                    </div>\n                                    <div class='col px-0 pt-2'>\n                                        <button\n                                            type='button'\n                                            class={`btn btn-block rounded-pill-right rounded-none ${replaySpeed === 0.05 ? 'btn-secondary' : 'btn-outline-secondary'} text-nowrap`}\n                                            style='text-overflow: ellipsis; overflow: hidden;'\n                                            onClick={this.setReplaySpeed}\n                                            data-speed={0.05}\n                                        >\n                                            1000x\n                                        </button>\n                                    </div>\n                                </div>\n                                <div class='d-flex justify-content-center'>\n                                    <div class='flex-grow-1 pt-0 font-weight-bolder text-center' style='font-size: 1.1em;'>\n                                        {raceTrackerPointTimestamp && <>\n                                            {util.formatDate(util.parseInputDate(raceTrackerPointTimestamp), { locale: 'no-NB', hour12: false, hour: '2-digit', minute: '2-digit' })}\n                                        </>}\n                                        {isAdmin && <>\n                                            / {historyPointIndex}\n                                        </>}\n                                    </div>\n                                    {isAdmin && <>\n                                        <button class='btn btn-danger mt-2 mr-4 rounded-pill-both rounded-none' onClick={this.toggleLines}>\n                                            <i class='fas fa-wave-square' /> Show lines\n                                        </button>\n                                    </>}\n                                </div>\n                            </> : <>\n                                <div class='spinner-border text-primary' role='status'>\n                                    <span class='sr-only'>Loading...</span>\n                                </div>\n                            </>}\n                        </Drawer>\n                    </>}\n\n                    {showResults && <>\n                        <Drawer stores={this.props.stores} onCloseClick={this.toggleResults} classNames={drawerClassNames} width={drawerWidth}>\n                            <Results\n                                stores={this.props.stores}\n                                raceClass={selectedClass}\n                                race={race}\n                                onMarkerClick={this.onMusherClick}\n                            />\n                        </Drawer>\n                    </>}\n\n                    {showDrawerMusher && <>\n                        <Drawer stores={this.props.stores} onCloseClick={this.toggleDrawerMusher} classNames={drawerClassNames} width={drawerWidth}>\n                            <MusherInfo\n                                stores={this.props.stores}\n                                wpData={wpData}\n                                onMarkerClick={this.onMarkerClick}\n                                onTeamClick={this.onTeamClick}\n                                onUserClick={this.onUserClick}\n                                onDogClick={this.onDogClick}\n                            />\n                        </Drawer>\n                    </>}\n\n                    {showDrawerCheckpoint && <>\n                        <Drawer stores={this.props.stores} onCloseClick={this.toggleDrawerCheckpoint}>\n                            <RaceLiveCheckpointResult stores={this.props.stores} id={selectedCheckpointId} onClickNav={this.selectCheckpoint} />\n                        </Drawer>\n                    </>}\n\n                </div>\n            </>}\n        </>);\n    }\n}\n\nexport default TrackingMap;\n"],"sourceRoot":""}