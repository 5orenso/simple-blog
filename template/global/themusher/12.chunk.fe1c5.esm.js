(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{zYNi:function(e,t,s){"use strict";(function(e){function a(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function i(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?a(Object(s),!0).forEach((function(t){o(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):a(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function o(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var l,n,r,c,h=s("hosL"),d=(s("QRet"),s("Utv1")),b=s("/eY4"),p=s("OhSV"),u=(s("Y3FI"),s("fh8t")),m=s.n(u),g=(s("go65"),s("HQo+")),O=s("wanP"),f=s("ZQlJ"),j=s("s4FZ"),y=s("q/oJ"),w=s("cH0S"),k=s("fVsX"),x=s("8n2v"),v=s("gWxU"),T=s("Nanz"),S=s("zUny"),C=(s("bbv7"),s("ukv5")),R=(s("eQ6k"),s("e0EM")),D=s("ZOvn");const M=D.a.marginTop(!0,!1),I=(D.a.marginTopBack(!1),D.a.marginBottom(),D.a.subMenuMarginTop(),{isLoading:!1,email:"",submenu:"ads",jwtToken:d.a.getJwtToken(),reloadInSec:null,reloadIsActive:!1,leaderboardMode:"mushers",filterByraceClass:"",showLeaderBoard:!0,showNews:!0});let B=Object(b.a)(l=class extends h.Component{constructor(e){super(e),this.initComponent=()=>{this.setState({reloadIsActive:!0},()=>this.tickReloadTimeer())},this.tickReloadTimeer=()=>{const{reloadLastEpoch:e}=this.props,{reloadIsActive:t}=this.state;if(t){const t=Math.floor((new Date).getTime()/1e3);this.setState({reloadInSec:60-(t-e)}),clearTimeout(this.updateTimer.tick),this.updateTimer.tick=setTimeout(()=>this.tickReloadTimeer(),1e3)}return!1},this.state=i({},I),this.updateTimer={}}componentDidMount(){this.initComponent()}componentWillUnmount(){clearTimeout(this.updateTimer.tick)}render(){const{reloadInSec:t}=this.state,{radius:s=13,fontSize:a=11,classNames:i=""}=this.props,o=Math.floor(d.a.normalizeBetween(t,0,60,0,100));return Object(h.h)(e,null,Object(h.h)("span",{class:i},Object(h.h)(O.a,{key:"gauge-reload-page",color:"primary",radius:s,showPercentText:!1,percent:o,showCenterText:!0,centerText:t,centerTextSize:a,centerTextY:"55%"})))}})||l,L=Object(b.a)(n=class extends h.Component{constructor(e){super(e),this.chooseSubmenu=e=>{const t=e.target.closest("button").dataset.submenu;this.setState({submenu:t})},this.state={}}render(){const{raceStore:t,userStore:s}=this.props.stores,{submenu:a="details"}=this.state,{waypoints:i}=t,{raceClass:o={},race:l={},onMarkerClick:n=(()=>{})}=this.props;return Object(h.h)(e,null,Object(h.h)("div",{class:"d-flex justify-content-center align-items-center mb-2"},Object(h.h)("span",{style:"font-size: 1.3em;"},Object(h.h)(p.c,{id:"races.gps-ranking"},"GPS Ranking"),": ",l.title," - ",o.title)),Object(h.h)("div",{class:"w-100 overflow-auto",style:"max-height: 60vh;"},!i||0===i.length&&Object(h.h)(e,null,Object(h.h)("div",{class:"text-center text-muted"},Object(h.h)("div",{class:"display-1"},Object(h.h)("i",{class:"fas fa-dog"})),Object(h.h)("div",{class:"w-100"},Object(h.h)("h3",null,Object(h.h)(p.c,{id:"races.no-teams-found"},"No teams found!")),Object(h.h)(p.c,{id:"races.loading-teams"},"Loading teams...")),Object(h.h)("div",{class:"spinner-border text-primary",style:"width: 3rem; height: 3rem;",role:"status"},Object(h.h)("span",{class:"sr-only"},"Loading...")))),Object(h.h)("table",{class:"table table-sm table-striped"},i&&i.map((t,s)=>{const a=d.a.format(t.restTime/t.raceTime*100,0);D.a.displayNameShort(t);return Object(h.h)(e,null,Object(h.h)("tr",{onClick:()=>n(t)},Object(h.h)("td",{style:"width: 15px;",class:"text-center"},t.rank),Object(h.h)("td",null,Object(h.h)("div",{class:"d-flex justify-content-between align-items-start w-100"},Object(h.h)("div",{class:"flex-grow-1"},Object(h.h)("div",{class:"float-right ml-2"},Object(h.h)("div",{class:"text-center"},Object(h.h)(O.a,{key:"gauge-reload-page",color:a<40?a<30?"danger":"warning":"success",radius:30,showPercentText:!1,percent:a,showCenterText:!0,centerText:a+"%",centerTextSize:15,centerTextY:"55%"}))),Object(h.h)("div",{class:"float-right"},t.finishTime<9999999999?Object(h.h)(e,null,Object(h.h)("i",{class:"fas fa-flag-checkered text-success"})):Object(h.h)(e,null,"rest"===t.currentState?Object(h.h)(e,null,Object(h.h)("i",{class:"fas fa-bed text-warning"})):Object(h.h)(e,null,Object(h.h)("i",{class:"fas fa-running text-primary"})))),Object(h.h)("span",{class:"text-white rounded-pill-left px-2 mr-2",style:`background-color: ${D.a.getRankingColor(t.rank||s+1)};`},t.bib),t.flag,"  ",t.title,Object(h.h)("div",null,Object(h.h)("small",null,t.finishTime<9999999999?Object(h.h)(e,null,t.diffToFirstFinishTime>0?Object(h.h)(e,null,Object(h.h)("span",{class:"text-muted"},Object(h.h)("i",{class:"fas fa-arrow-up"}))," ",d.a.secToHms(t.diffToFirstFinishTime)):Object(h.h)(e,null,Object(h.h)("span",{class:"text-muted"},Object(h.h)("i",{class:"fas fa-flag-checkered"}))," ",d.a.formatDate(d.a.parseInputDate(t.finishTime),{locale:"no-NB",hour12:!1,hour:"2-digit",minute:"2-digit"})),Object(h.h)("nobr",null,Object(h.h)("i",{class:"fas fa-running text-muted"})," ",d.a.secToHms(t.raceTime)),Object(h.h)("nobr",null,Object(h.h)("i",{class:"fas fa-bed ml-2 text-muted"})," ",d.a.format(t.restTime/t.raceTime*100,0),"%")):Object(h.h)(e,null,Object(h.h)("nobr",null,Object(h.h)("span",{class:"text-muted"},Object(h.h)("i",{class:"fas fa-flag-checkered"}))," ",d.a.format(t.distanceToFinish,1)," km"),t.distanceToFinish!==t.distanceToFirst&&t.distanceToFirst>0&&Object(h.h)(e,null,Object(h.h)("nobr",null,Object(h.h)("span",{class:"text-muted font-weight-light ml-2"},"1st:")," ",d.a.format(t.distanceToFirst,1)," km")),t.distanceToFinish!==t.distanceToForward&&t.distanceToForward>0&&Object(h.h)(e,null,Object(h.h)("nobr",null,Object(h.h)("span",{class:"text-muted ml-2"},Object(h.h)("i",{class:"fas fa-arrow-up"}))," ",d.a.format(t.distanceToForward,1)," km")),t.distanceToBehind>0&&Object(h.h)(e,null,Object(h.h)("nobr",null,Object(h.h)("span",{class:"text-muted ml-2"},Object(h.h)("i",{class:"fas fa-arrow-down"}))," ",d.a.format(t.distanceToBehind,1)," km")),Object(h.h)("br",null),Object(h.h)("nobr",null,Object(h.h)("span",{class:"text-muted"},Object(h.h)("i",{class:"fas fa-tachometer-alt"}))," ",d.a.format((t.currentAvgSpeed?3.6*t.currentAvgSpeed:t.speed)||0,1)," km/h"),Object(h.h)("nobr",null,Object(h.h)("i",{class:"fas fa-running ml-2 text-muted"})," ",d.a.secToHms(t.raceTime)),Object(h.h)("nobr",null,Object(h.h)("i",{class:"fas fa-bed ml-2 text-muted"})," ",d.a.format(t.restTime/t.raceTime*100,0),"%")))))),Object(h.h)("div",{class:"mt-1 container-fluid"},Object(h.h)(C.a,{stores:this.props.stores,states:t.states,duration:t.raceTime,key:"state-"+t.bib,height:"6px",showText:!1})))))}))))}})||n,P=Object(b.a)(r=class extends h.Component{constructor(e){super(e),this.toggleAdminInfo=e=>{e.stopPropagation();const{showAdminInfo:t}=this.state;this.setState({showAdminInfo:!t})},this.toggleInfo=e=>{e.stopPropagation();const{showInfo:t}=this.state;this.setState({showInfo:!t})},this.onDogClick=(e,t,s)=>{e.preventDefault(),e.stopPropagation();const a=s.find(e=>e.uuidv4===t);return this.setState({currentDog:a,showDog:t,dogs:s}),!1},this.chooseSubmenu=e=>{const t=e.target.closest("button").dataset.submenu;this.setState({submenu:t})},this.state={}}render(){const{raceStore:t,userStore:s}=this.props.stores,{showAdminInfo:a,submenu:i="details",showDog:o,currentDog:l={}}=this.state,{wpData:n={},onMarkerClick:r=(()=>{})}=this.props,c=t.findWaypointByBib(n.bib),{isAdmin:b}=s,{user:u={}}=s,g=(n.bib?t.getMusherByBibId(n.bib):t.getMusherByBibEmail(n.email))||{},O=t.getTeamById(g.team),y=O.members?O.members.find(e=>e.email===g.email):{},w=(t.getClassByBib(n.bib),t.getTotalsByTeamId(g.team)),k=D.a.getImage({user:y,team:O,priority:"user",fallback:g.image1}),x=D.a.displayNameShort(y)||D.a.displayNameShort(g),v=D.a.getRankingColor(c.rank),T=D.a.hasBirthday(l.birth),S=l.birth?Math.ceil(D.a.daysUntilNextBirthday(l.birth)):365,{inFront:C,behind:M}=t.findNearestMushers(n.bib),I=(d.a.format(c.restTime/c.raceTime*100,0),O&&O.imageHeader&&O.imageHeader.s3XXLargeLink?O.imageHeader:{s3XXLargeLink:g.topImage1||"./assets/homerun-race-logo.png"}),B=O&&O.images?[...O.images]:[];for(let e=0,t=3;e<t;e+=1)g["image"+e]&&B.push({s3SmallLink:g["image"+e],s3LargeLink:g["image"+e]});O.members&&O.members.indexOf(u.id),O.followers&&O.followers.indexOf(u.id),O.followRequests&&O.followRequests.findIndex(e=>e.id===u.id),Math.floor((new Date).getTime()/1e3);return Object(h.h)(e,null,M.bib&&Object(h.h)("button",{class:"btn btn-link text-primary mx-2 py-0 float-right",onClick:()=>r(M),style:"line-height: 1.0em; font-size: 2.0em;"},Object(h.h)("i",{class:"fas fa-angle-right"})),C.bib&&Object(h.h)("button",{class:"btn btn-link text-primary mx-2 py-0 float-right",onClick:()=>r(C),style:"line-height: 1.0em; font-size: 2.0em;"},Object(h.h)("i",{class:"fas fa-angle-left"})),Object(h.h)("div",{class:"d-flex justify-content-center align-items-center mb-2"},Object(h.h)("span",{style:"font-size: 1.3em; height: 16vh;"}," ")),Object(h.h)("div",{class:"w-100 overflow-auto",style:"max-height: 55vh;"},Object(h.h)("div",{class:"w-100 position-absolute",style:"z-index: -1; height: 18vh; top: 0px; left: 0px; background-size: cover; background-repeat: no-repeat; background-position: 50% 30%; background-color: #a0a0a0; "+(I?`background-image: url("${I.s3XXLargeLink}");`:"")}),Object(h.h)("div",{class:"d-flex position-relative"},Object(h.h)("div",{class:"position-relative text-center border rounded-circle imageRounded imageRoundedMedium",style:k?`background-image: url("${k}"); background-size: cover;`:""},!k&&Object(h.h)("div",{class:"text-muted",style:"font-size: 25px; padding-top: 5px;"},x),Object(h.h)("div",{class:`rounded-pill-both px-2 text-center position-absolute ${v?"":"bg-secondary"} font-weight-bold`,style:"bottom: -20px; right: 0; "+(v?`background-color: ${v};`:"")},g.bib&&"n/a"!==g.bib&&Object(h.h)(e,null,g.bib))),Object(h.h)("div",{class:"flex-grow-1 pl-3 text-overflow mb-3",style:"line-height: 1.8em;"},Object(h.h)("div",{class:"float-right",style:"font-size: 1.2em;"},c.finishTime<9999999999?Object(h.h)(e,null,Object(h.h)("i",{class:"fas fa-flag-checkered text-success"})):Object(h.h)(e,null,"rest"===c.currentState?Object(h.h)(e,null,Object(h.h)("i",{class:"fas fa-bed text-warning"})):Object(h.h)(e,null,Object(h.h)("i",{class:"fas fa-running text-primary"})))),Object(h.h)("h3",{class:"mb-0"},g.flag," ",g.firstname," ",g.lastname),Object(h.h)("h6",{class:"mb-0"},g.sportsClub||Object(h.h)(e,null," ")))),Object(h.h)("div",{class:"d-flex justify-content-center mb-3"},Object(h.h)("div",{class:"col px-0 pt-2"},Object(h.h)("button",{type:"button",class:`btn btn-block rounded-pill-left rounded-none ${"details"===i?"btn-primary":"btn-outline-primary"} text-nowrap`,style:"text-overflow: ellipsis; overflow: hidden;",onClick:this.chooseSubmenu,"data-submenu":"details"},"Details")),Object(h.h)("div",{class:"col px-0 pt-2"},Object(h.h)("button",{type:"button",class:`btn btn-block rounded-none ${"team"===i?"btn-primary":"btn-outline-primary"} text-nowrap`,style:"text-overflow: ellipsis; overflow: hidden;",onClick:this.chooseSubmenu,"data-submenu":"team"},"Team")),Object(h.h)("div",{class:"col px-0 pt-2"},Object(h.h)("button",{type:"button",class:`btn btn-block rounded-pill-right rounded-none ${"dogs"===i?"btn-primary":"btn-outline-primary"} text-nowrap`,style:"text-overflow: ellipsis; overflow: hidden;",onClick:this.chooseSubmenu,"data-submenu":"dogs"},"Dogs"))),Object(h.h)("div",{class:"w-100 overflow-auto position-relative"},"details"===i&&Object(h.h)(e,null,Object(h.h)(R.a,{stores:this.props.stores,wp:c,musher:g})),"team"===i&&Object(h.h)(e,null,O.public>0?Object(h.h)(e,null,Object(h.h)("h3",null,O.name),Object(h.h)(m.a,{markdown:D.a.replaceImages(O.description,O.images),markdownOpts:D.a.getMarkdownOptions()}),Object(h.h)(j.a,{stores:this.props.stores,images:B})):Object(h.h)(e,null,Object(h.h)("div",{class:"text-center text-muted"},Object(h.h)("div",{class:"display-1"},Object(h.h)("i",{class:"fas fa-dog"})),Object(h.h)("h3",null,Object(h.h)(p.c,{id:"teams.no-public-team"},"No public team!")),Object(h.h)(p.c,{id:"teams.no-public-team"},"This team is not publicly visible."),B&&Object(h.h)("div",{class:"my-3"},Object(h.h)(j.a,{stores:this.props.stores,images:B}))))),"dogs"===i&&Object(h.h)(e,null,O.public>0?Object(h.h)(e,null,O.dogs&&Object(h.h)("div",{class:"w-100 container-fluid"},Object(h.h)("div",{class:"row pt-2"},Object(h.h)(f.a,{stores:this.props.stores,dogs:O.dogs.map(e=>e.id),allDogs:O.dogs,onDogClick:this.onDogClick}))),o&&Object(h.h)(e,null,Object(h.h)("div",{class:"d-flex mb-0 mt-3 position-relative"},Object(h.h)("div",{class:"text-center border rounded-circle imageRounded imageRoundedLarge text-muted pt-2",style:l.image?`background-image: url("${l.image.s3LargeLink}"); background-size: cover;`:""},!l.image&&Object(h.h)("span",{class:"font-weight-lighter",style:"font-size: 35px;"},d.a.ucfirst(l.name,!0))),Object(h.h)("div",{class:"flex-grow-1 pl-3 pr-2",style:`border-right: 4px solid ${s.findHarness(l.harness,"colorNonstop")} !important; line-height: 1.2em;`},Object(h.h)("h5",{class:"mb-1"},l.shortname||l.name," ",l.shortname&&""!==l.shortname&&Object(h.h)(e,null," - ",Object(h.h)("span",{class:"font-weight-lighter"},l.name)),T&&Object(h.h)(e,null,Object(h.h)("i",{class:"fas fa-birthday-cake ml-3"}))),Object(h.h)("div",null,S<7&&Object(h.h)(e,null,Object(h.h)("span",{class:"text-muted mr-2"},Object(h.h)("i",{class:"fas fa-birthday-cake"})," in ",S," days")),l.birth&&Object(h.h)("span",{class:"mr-2"},d.a.age(l.birth,l.deceased)),"female"===l.gender?Object(h.h)("i",{class:"fas fa-venus"}):Object(h.h)("i",{class:"fas fa-mars"})))))):Object(h.h)(e,null,Object(h.h)("div",{class:"text-center text-muted"},Object(h.h)("div",{class:"display-1"},Object(h.h)("i",{class:"fas fa-dog"})),Object(h.h)("h3",null,Object(h.h)(p.c,{id:"teams.no-public-team"},"No public team!")),Object(h.h)(p.c,{id:"teams.no-public-team"},"This team is not publicly visible.")))),b&&Object(h.h)("div",{style:"max-height: 200px; max-width: 70vw; overflow: auto;"},Object(h.h)("button",{class:"btn btn-link btn-block",onClick:this.toggleAdminInfo},"Toggle admin info"),a&&Object(h.h)(e,null,Object(h.h)("small",null,Object(h.h)("xmp",null,"musher: ",JSON.stringify(g,null,4),Object(h.h)("br",null),"user: ",JSON.stringify(y,null,4),Object(h.h)("br",null),"team: ",JSON.stringify(O,null,4),Object(h.h)("br",null),"totals: ",JSON.stringify(w,null,4),Object(h.h)("br",null))))))))}})||r,H=Object(b.a)(c=class extends h.Component{constructor(e){var t;super(e),t=this,this.handleHistoryPointIndex=e=>{const t=parseInt(e.target.value,10);clearTimeout(this.updateTimer.reload),this.setState({historyPointIndex:t,timerRunning:!1},()=>{const{historyPointIndex:e}=this.state,{raceStore:t}=this.props.stores;t.updateWaypointPosition(Math.abs(e))})},this.playHistory=()=>{clearTimeout(this.updateTimer.reload);const{historyPointIndex:e,replaySpeed:t}=this.state,{raceStore:s}=this.props.stores,a=s.getRaceTrackerTimestamp(e+1),o={historyPointIndex:e+1,timerRunning:!1,playingHistory:!0};a&&(o.raceTrackerPointTimestamp=a),this.setState(i({},o),()=>{s.updateWaypointPosition(Math.abs(e+1))}),clearTimeout(this.updateTimer.history),this.updateTimer.history=setTimeout(()=>{this.playHistory()},1e3*t)},this.pauseHistory=()=>{clearTimeout(this.updateTimer.history),this.setState({playingHistory:!1})},this.loadLiveRaceResults=async function(e=t.props,{teamIds:s,focusOnMushers:a,bibs:i,classid:o,historySteps:l}){const{raceStore:n,userStore:r}=e.stores,{race:c}=n,{replayHistory:h,timerRunning:d}=t.state,{showDrawerReplay:b}=t.props,p=n.getClassById(o)||{},{isAdmin:u}=r;await n.getRaceTrackerData(c.raceTrackerRace,{historySteps:l,history:h||b,bibs:i,classid:o,startDate:p.startDate,endDate:p.endDate,isAdmin:u}),n.getRaceTrackerActiveTeams(s,a,i),d&&(clearTimeout(t.updateTimer.reload),t.updateTimer.reload=setTimeout(()=>{console.log("loadLiveRaceResults.reloading...");const e=Math.floor((new Date).getTime()/1e3);t.setState({reloadLastEpoch:e}),t.loadLiveRaceResults(t.props,{teamIds:s,focusOnMushers:a,bibs:i,classid:o,historySteps:l})},6e4))},this.loadRaceResults=async function(e=t.props,s,a){const{raceStore:i}=e.stores,{raceid:o}=e,{timerRunning:l}=t.state;await i.loadWorkoutSummary(s,o),i.getWorkoutSummaryActiveTeams(s,a),l&&(clearTimeout(t.updateTimer.reload),t.updateTimer.reload=setTimeout(()=>{const e=Math.floor((new Date).getTime()/1e3);t.setState({reloadLastEpoch:e}),t.loadRaceResults(t.props,s,a)},6e4))},this.loadRace=async function(e=t.props){try{t.setState({isLoading:!0});const{raceStore:s,appState:a}=e.stores,{raceid:i,classid:o,filterByBibs:l,historySteps:n}=e;await s.load(i),s.getAllClassesSortedBy();const{race:r}=s,{focusOnMushers:c}=a,{selectedClassIds:h=[]}=a,d=null==r?void 0:r.classes.map(e=>e.id);let b=o||h[0];-1===d.indexOf(b)&&(b=d[0],a.setSelectedClassId(b)),o&&a.toggleSelectedClassId(o,!0);const p=r.classes.filter(e=>e.id===b).filter(e=>e.contestants&&e.contestants.length>0).map(e=>e.contestants.filter(e=>e.team>0).map(e=>e.team)).flat(),u=l||r.classes.filter(e=>e.id===b).filter(e=>e.contestants&&e.contestants.length>0).map(e=>e.contestants.filter(e=>e.bib>0).map(e=>e.bib)).flat();p.length>0&&await s.loadTeams(p.join(","),!1,!0,!0),r.liveRace>0?await t.loadLiveRaceResults(t.props,{teamIds:p,focusOnMushers:c,bibs:u,classid:b,historySteps:n}):await t.loadRaceResults(t.props,p,c),t.setState({isLoading:!1})}catch(e){console.log(e)}},this.setLeaderboardMode=e=>{this.setState({leaderboardMode:e.target.parentElement.dataset.mode||e.target.dataset.mode})},this.chooseRaceClass=e=>{this.setState({filterByraceClass:e.target.value})},this.toggleShowLeaderBoard=e=>{const{showLeaderBoard:t}=this.state;this.setState(!0===e?{showLeaderBoard:!1}:{showLeaderBoard:!t})},this.toggleShowNews=e=>{const{showNews:t}=this.state;this.setState(!0===e?{showNews:!1}:{showNews:!t})},this.closeAllDrawers=()=>{this.setState({showResults:!1,showDrawerCheckpoint:!1,showDrawerMusher:!1})},this.onMarkerClick=e=>{this.closeAllDrawers(),this.setState({showDrawerMusher:!0,wpData:e})},this.onMusherClick=e=>{this.setState({showDrawerMusher:!0,wpData:e})},this.onCpMarkerClick=e=>{if(!e||!e.id)return null;this.closeAllDrawers(),this.setState({selectedCheckpointId:e.id,showDrawerCheckpoint:!0,cpData:e})},this.toggleDrawerMusher=()=>{const{showDrawerMusher:e}=this.state;this.setState({showDrawerMusher:!e})},this.toggleDrawerCheckpoint=()=>{const{showDrawerCheckpoint:e}=this.state;this.setState({showDrawerCheckpoint:!e})},this.toggleResults=()=>{const{showResults:e}=this.state;this.closeAllDrawers(),this.setState({showResults:!e})},this.selectCheckpoint=e=>{this.closeAllDrawers(),this.setState({selectedCheckpointId:e,showDrawerCheckpoint:!0,showDrawerMusher:!1,showDrawer:!1})},this.onTeamClick=(e,t)=>(e.preventDefault(),e.stopPropagation(),this.setState({showTeam:t}),!1),this.hideTeam=()=>{this.setState({showTeam:null})},this.onUserClick=e=>(e.preventDefault(),e.stopPropagation(),!1),this.onDogClick=(e,t,s)=>(e.preventDefault(),e.stopPropagation(),this.setState({showDog:t,dogs:s}),!1),this.hideDog=()=>{this.setState({showDog:null})},this.setReplaySpeed=e=>{const t=e.target.closest("button").dataset.speed;this.setState({replaySpeed:parseFloat(t)})},this.filterByClass=async function(e){try{const s=e.target.closest("button").dataset.id,{showDrawerReplay:a,historySteps:i,filterByBibs:o}=t.props,{replayHistory:l}=t.state;(l||a)&&t.toggleReplayHistory();const{appState:n,raceStore:r}=t.props.stores;r.cleanupMemoryClass(),n.toggleSelectedClassId(s,!0);const{race:c}=r,{focusOnMushers:h}=n,d=c.classes.filter(e=>e.id===s).filter(e=>e.contestants&&e.contestants.length>0).map(e=>e.contestants.filter(e=>e.team>0).map(e=>e.team)).flat(),b=o||c.classes.filter(e=>e.id===s).filter(e=>e.contestants&&e.contestants.length>0).map(e=>e.contestants.filter(e=>e.bib>0).map(e=>e.bib)).flat();t.setState({allTeamIds:d,bibs:b,selectedMusherBib:"",showDrawerCheckpoint:!1,showDrawerMusher:!1,showDrawer:!1}),d.length>0&&await r.loadTeams(d.join(","),!1,!0,!0),c.liveRace>0?await t.loadLiveRaceResults(t.props,{teamIds:d,focusOnMushers:h,bibs:b,classid:s,historySteps:i}):await t.loadRaceResults(t.props,d,h)}catch(e){console.log(e)}},this.toggleFocusOnMusher=e=>{try{const t=e.target.parentElement.dataset.musherid||e.target.dataset.musherid,{appState:s,raceStore:a}=this.props.stores;s.toggleFocusOnMusher(t);const{focusOnMushers:i=[],selectedClassIds:o=[]}=s,l=o[0],{race:n}=a,r=n.classes.filter(e=>e.id===l).filter(e=>e.contestants&&e.contestants.length>0).map(e=>e.contestants.filter(e=>e.bib>0).map(e=>e.bib)).flat();n.liveRace>0?a.getRaceTrackerActiveTeams(null,i,r):a.getWorkoutSummaryActiveTeams(null,i,r)}catch(e){console.log(e)}},this.toggleBib=()=>{try{const{bib:e}=this.state,{appState:t,raceStore:s}=this.props.stores,a=s.getMusherByBibId(e);t.toggleFocusOnMusher(a.id)}catch(e){console.log(e)}},this.checkForEnter=e=>{"Enter"===e.key&&this.toggleBib()},this.toggleReplayHistory=()=>{const{replayHistory:e}=this.state;clearTimeout(this.updateTimer.reload),this.setState({showDrawer:!1,historyPointIndex:0,replayHistory:!e,timerRunning:e},(async function(){await t.loadRace();const{historyPointIndex:s}=t.state,{raceStore:a}=t.props.stores,{maxPoints:i}=a;if(e)console.log("toggleReplayHistory: setting to maxPoints",i),a.updateWaypointPosition(Math.abs(i-1));else{console.log("toggleReplayHistory: setting to first points");for(let e=0,t=10;e<t;e+=1)a.updateWaypointPosition(Math.abs(s+e))}}))},this.toggleLines=()=>{const{showLines:e}=this.state;this.setState({showLines:!e})},this.state=i(i({},I),{},{reloadLastEpoch:Math.floor((new Date).getTime()/1e3),historyPointIndex:0,timerRunning:!0,replayHistory:!1,replaySpeed:1}),this.updateTimer={}}componentWillUnmount(){clearTimeout(this.updateTimer.reload),clearTimeout(this.updateTimer.history),clearTimeout(this.updateTimer.tick)}componentDidMount(){this.loadRace();try{const{width:e}=function(){const{innerWidth:e,innerHeight:t}=window;return{width:e,height:t}}();e<800&&(this.toggleShowLeaderBoard(!0),this.toggleShowNews(!0))}catch(e){console.log(e)}}componentWillReceiveProps(e){this.props.classid===e.classid&&this.props.showDrawerReplay===e.showDrawerReplay||this.loadRace(e)}render(){const{historyPointIndex:t,timerRunning:s,playingHistory:a,replaySpeed:i,raceTrackerPointTimestamp:o,showLines:l,allTeamIds:n}=this.state,{userStore:r,raceStore:c,appState:b}=this.props.stores,{user:p={},teams:u=[],isAdmin:O}=r,{language:f="en"}=p,{raceid:j,showHeader:C=!0,drawerClassNames:R,drawerWidth:I,showDrawerReplay:H,largeMarkers:N,isAnimatedMarkers:z,linkBase:A="/app-races/"}=this.props,{focusOnMushers:F=[],infoOnMushers:$=[],selectedClassIds:E=[]}=b,{reloadLastEpoch:W,showDrawerMusher:J,showDrawerCheckpoint:U,wpData:X={},cpData:Y={},showResults:q,showTeam:Q,showDog:G,replayHistory:Z,selectedCheckpointId:V}=this.state,{waypoints:K,geoJSONs:_,zoomToMarkers:ee,race:te,maxPoints:se}=c,ae=X.bib?c.getMusherByBibId(X.bib):c.getMusherByBibEmail(X.email),ie=c.getTeamById(ae.team),oe=c.getClassById(E[0])||{};let le=[];oe.waypoints&&oe.waypoints.length>0?le=oe.waypoints:oe.checkpoints&&oe.checkpoints.length>0&&(le=oe.checkpoints.slice().filter(e=>e.position&&e.position[0]).map(e=>({id:e.id,title:e.name,lat:e.position[0],lng:e.position[1]})));let ne=!0;if(te.countryRegexp&&p&&p.currentLocationGeocode){new RegExp(te.countryRegexp,"i").test(p.currentLocationGeocode.formattedCountry)&&(ne=!1)}return Object(h.h)(e,null,Q&&Object(h.h)(y.a,null,Object(h.h)(v.default,{stores:this.props.stores,teamid:Q,marginTop:"0px;",marginBottom:"0px;",back:this.hideTeam,hideTeam:this.hideTeam})),G&&Object(h.h)(y.a,null,Object(h.h)(T.default,{stores:this.props.stores,dogid:G,marginTop:"0px;",marginBottom:"0px;",back:this.hideDog,dogs:ie.dogs})),C&&Object(h.h)(k.a,{height:M},Object(h.h)("div",{class:"d-flex justify-content-between align-items-center w-100"},Object(h.h)("div",{class:"d-flex align-items-center"},Object(h.h)("span",{class:"",style:"font-size: 2.3em;"},Object(h.h)("a",{href:`${A}${te.id}`},Object(h.h)("i",{class:"fas fa-angle-left"}))),Object(h.h)("span",{class:"ml-4 text-primary",style:"font-size: 1.4em;",onClick:this.toggleResults},Object(h.h)("i",{class:"fas fa-list-ol"})),Object(h.h)("span",{class:"ml-4 text-primary",style:"font-size: 1.4em;"},!te.resultsHide&&Object(h.h)("a",{href:`${A}${te.id}/results`},Object(h.h)("i",{class:"fas fa-stopwatch"})))),Object(h.h)("div",null,Object(h.h)("span",{class:"font-weight-normal text-white",style:"font-size: 1.2em;"},te.title)),te.liveRace>0?Object(h.h)(e,null,Object(h.h)("div",{class:"d-flex align-items-center text-primary",onClick:this.toggleReplayHistory},Object(h.h)("span",{class:""},"Replay"),Object(h.h)("span",{class:"ml-2",style:"font-size: 1.4em;"},Object(h.h)("i",{class:"fas fa-play"})))):Object(h.h)(e,null,Object(h.h)("div",{class:"d-flex align-items-center"}," "))),Object(h.h)("div",{class:"w-100 overflow-hidden"},Object(h.h)("div",{class:"d-flex flex-row flex-nowrap pb-2 px-1",style:"overflow: auto; scroll-snap-type: x mandatory;"},te.classes&&te.classes.map((t,s)=>Object(h.h)(e,null,Object(h.h)("div",{class:"col px-0 pt-0"},Object(h.h)("button",{type:"button",class:`btn btn-block ${D.a.getPillClass(te.classes.length,s)} rounded-none ${E.indexOf(t.id)>-1?"btn-primary":"btn-outline-primary"} text-nowrap`,style:"text-overflow: ellipsis; overflow: hidden;",onClick:this.filterByClass,"data-id":t.id},t.title))))))),ne?Object(h.h)(e,null,Object(h.h)("div",{class:"container-fluid position-relative p-0 w-100 h-100",style:`margin-top: ${C?M:0};`},te.id?Object(h.h)(e,null,Object(h.h)(g.a,{marginTop:M,stores:this.props.stores,raceid:j,waypoints:K,geoJSONs:l?_:null,waypoints2:le,zoomToMarkers:ee,fullscreenMap:!0,onMarkerClick:this.onMarkerClick,onMarker2Click:this.onCpMarkerClick,showHeatmap:te.liveRace<1,allTeamIds:n,showTracks:te.liveRace>=1,selectedClassIds:E,showDistanceMarkers:!1,groupWaypoints:!1,focusOnMushers:F,largeMarkers:N,isAnimatedMarkers:z,replaySpeed:1e3*i})):Object(h.h)(e,null,Object(h.h)(x.a,{stores:this.props.stores})),s&&Object(h.h)("div",{class:"position-absolute",style:"top: 125px; left: 5px; z-index: 9999; width: 30px; height: 30px;"},Object(h.h)(B,{stores:this.props.stores,classNames:"float-right ml-2",reloadLastEpoch:W})),F&&F.length>0&&Object(h.h)(e,null,Object(h.h)("div",{class:"row mb-2",style:' background-color: #1C1F4C; background-image: url("https://themusher.app/assets/tv-single-background.jpg"); background-size: cover !important; background-position: 0 0; border-radius: 10px; '},Object(h.h)("div",{class:"col-12 text-white",style:"font-size: 1.3em;"},F&&F.map(t=>{const s=c.getMusherById(t);return Object(h.h)(e,null,Object(h.h)("div",null,Object(h.h)("nobr",null,Object(h.h)("span",{class:"mr-2",onClick:this.toggleFocusOnMusher,"data-musherid":s.id},F.indexOf(s.id)>-1?Object(h.h)("i",{class:"fas fa-times text-warning"}):Object(h.h)("i",{class:"far fa-star"})),Object(h.h)("span",{class:"text-right",style:"width: 50px; display: inline-block;"},s.bib)," ",s.flag," ",s.firstname," ",s.lastname,Object(h.h)("br",null))))})))),te.mapCredits&&Object(h.h)(e,null,Object(h.h)("div",{class:"position-absolute",style:"bottom: 30px; left: 7px; z-index: 9999; width: 100px; height: 40px;"},Object(h.h)(m.a,{markdown:D.a.replaceImages(te.mapCredits,te.images),markdownOpts:D.a.getMarkdownOptions()}))),(H||Z)&&Object(h.h)(e,null,Object(h.h)(w.a,{stores:this.props.stores,onCloseClick:this.toggleReplayHistory,classNames:R,width:I},se>0?Object(h.h)(e,null,Object(h.h)("div",{class:"d-flex justify-content-center mx-3"},a?Object(h.h)(e,null,Object(h.h)("div",{class:"pl-1"},Object(h.h)("button",{class:"btn btn-warning",onClick:this.pauseHistory},Object(h.h)("i",{class:"fas fa-pause"})))):Object(h.h)(e,null,Object(h.h)("div",{class:"pl-1"},Object(h.h)("button",{class:"btn btn-success",onClick:this.playHistory},Object(h.h)("i",{class:"fas fa-play"})))),Object(h.h)("div",{class:"pl-2 pt-2 flex-grow-1"},Object(h.h)("input",{type:"range",class:"custom-range w-100",min:0,max:se,value:t,onInput:this.handleHistoryPointIndex}))),Object(h.h)("div",{class:"d-flex justify-content-center"},Object(h.h)("div",{class:"col px-0 pt-2"},Object(h.h)("button",{type:"button",class:`btn btn-block rounded-pill-left rounded-none ${1===i?"btn-secondary":"btn-outline-secondary"} text-nowrap`,style:"text-overflow: ellipsis; overflow: hidden;",onClick:this.setReplaySpeed,"data-speed":1},"60x")),Object(h.h)("div",{class:"col px-0 pt-2"},Object(h.h)("button",{type:"button",class:`btn btn-block rounded-none ${.5===i?"btn-secondary":"btn-outline-secondary"} text-nowrap`,style:"text-overflow: ellipsis; overflow: hidden;",onClick:this.setReplaySpeed,"data-speed":.5},"120x")),Object(h.h)("div",{class:"col px-0 pt-2"},Object(h.h)("button",{type:"button",class:`btn btn-block rounded-none ${.25===i?"btn-secondary":"btn-outline-secondary"} text-nowrap`,style:"text-overflow: ellipsis; overflow: hidden;",onClick:this.setReplaySpeed,"data-speed":.25},"240x")),Object(h.h)("div",{class:"col px-0 pt-2"},Object(h.h)("button",{type:"button",class:`btn btn-block right rounded-none ${.12===i?"btn-secondary":"btn-outline-secondary"} text-nowrap`,style:"text-overflow: ellipsis; overflow: hidden;",onClick:this.setReplaySpeed,"data-speed":.12},"480x")),Object(h.h)("div",{class:"col px-0 pt-2"},Object(h.h)("button",{type:"button",class:`btn btn-block rounded-pill-right rounded-none ${.05===i?"btn-secondary":"btn-outline-secondary"} text-nowrap`,style:"text-overflow: ellipsis; overflow: hidden;",onClick:this.setReplaySpeed,"data-speed":.05},"1000x"))),Object(h.h)("div",{class:"d-flex justify-content-center"},Object(h.h)("div",{class:"flex-grow-1 pt-0 font-weight-bolder text-center",style:"font-size: 1.1em;"},o&&Object(h.h)(e,null,d.a.formatDate(d.a.parseInputDate(o),{locale:"no-NB",hour12:!1,hour:"2-digit",minute:"2-digit"})),O&&Object(h.h)(e,null,"/ ",t)),O&&Object(h.h)(e,null,Object(h.h)("button",{class:"btn btn-danger mt-2 mr-4 rounded-pill-both rounded-none",onClick:this.toggleLines},Object(h.h)("i",{class:"fas fa-wave-square"})," Show lines")))):Object(h.h)(e,null,Object(h.h)("div",{class:"spinner-border text-primary",role:"status"},Object(h.h)("span",{class:"sr-only"},"Loading..."))))),q&&Object(h.h)(e,null,Object(h.h)(w.a,{stores:this.props.stores,onCloseClick:this.toggleResults,classNames:R,width:I},Object(h.h)(L,{stores:this.props.stores,raceClass:oe,race:te,onMarkerClick:this.onMusherClick}))),J&&Object(h.h)(e,null,Object(h.h)(w.a,{stores:this.props.stores,onCloseClick:this.toggleDrawerMusher,classNames:R,width:I},Object(h.h)(P,{stores:this.props.stores,wpData:X,onMarkerClick:this.onMarkerClick,onTeamClick:this.onTeamClick,onUserClick:this.onUserClick,onDogClick:this.onDogClick}))),U&&Object(h.h)(e,null,Object(h.h)(w.a,{stores:this.props.stores,onCloseClick:this.toggleDrawerCheckpoint},Object(h.h)(S.a,{stores:this.props.stores,id:V,onClickNav:this.selectCheckpoint}))))):Object(h.h)(e,null,Object(h.h)("div",{class:"container-fluid position-relative p-0 w-100 h-100",style:`margin-top: ${C?M:0};`},Object(h.h)("div",{class:"text-center text-muted"},Object(h.h)("div",{class:"display-1"},Object(h.h)("i",{class:"fas fa-hand-paper"})),Object(h.h)("h3",null,"Not allowed to view tracking"),te.countryRegexpMessage))))}})||c;t.a=H}).call(this,s("hosL").Fragment)}}]);
//# sourceMappingURL=12.chunk.fe1c5.esm.js.map