(window.webpackJsonp=window.webpackJsonp||[]).push([[81],{"K+T6":function(e,t,s){"use strict";(function(e){function a(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function i(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var r,o=s("hosL"),n=s("Utv1"),l=s("/eY4"),c=(s("OhSV"),s("fh8t")),d=s.n(c),h=s("ZOvn");const p={likeMessage:{}};let u=Object(l.a)(r=class extends o.Component{constructor(e){var t;super(e),t=this,this.addLike=async function(e){e.stopPropagation(),e.preventDefault();const s=e.target.closest(".inboxBubble").dataset.id,{messageStore:a}=t.props.stores,{likeMessage:i}=t.state;return i[s]=!0,t.setState({likeMessage:i}),setTimeout(()=>{const{likeMessage:e}=t.state;delete e[s],t.setState({likeMessage:e})},1200),await a.likeMessage({messageId:s}),!0},this.state=function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?a(Object(s),!0).forEach((function(t){i(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):a(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}({},p)}render(){const{likeMessage:t}=this.state,{message:s={},messageUser:a}=this.props,{userStore:i}=this.props.stores,{user:r}=i,{language:l="en"}=r,c=r.uuidv4===s.fromUser,p=h.a.displayNameShort(a),u=a.image||(a.images?a.images[0]:void 0),g=s.images||[];return Object(o.h)("div",{class:"position-relative"},Object(o.h)("div",{class:"d-flex "+(c?"justify-content-end":"justify-content-start")},Object(o.h)("div",{class:"d-flex align-items-start flex-column overflow-auto",style:"max-width: 80%;"},g&&g.length>0&&Object(o.h)(e,null,Object(o.h)("div",{class:"d-flex flex-column",style:""+(c?"":"margin-left: 29px;")},n.a.isArray(g)&&g.map((t,a)=>Object(o.h)(e,null,Object(o.h)("div",{class:"px-0 overflow-hidden rounded-lg",style:"max-height: 50vh;"},Object(o.h)("img",{loading:"lazy",class:"img-fluid border rounded-lg",src:t.s3MediumLink,onClick:this.viewImage,"data-id":s.uuidv4,"data-idx":a})))))),Object(o.h)("div",{class:"d-flex flex-row flex-nowrap position-relative "+(c?"align-self-end":"")},!c&&Object(o.h)("div",{class:"text-center text-muted border rounded-circle imageRounded imageRoundedThumb pt-0 mr-1",style:(u?`background-image: url("${u.s3SmallLink}"); background-size: cover;`:"")+" border-width: 3px !important; line-height: 15px;"},!u&&Object(o.h)("span",{class:"font-weight-lighter",style:"font-size: 15px;"},p)),Object(o.h)("div",{class:"d-flex flex-column"},Object(o.h)("div",{class:`inboxBubble py-2 px-3 rounded-lg position-relative ${c?"bg-primary text-white":"bg-secondary text-white"} overflow-hidden`,style:"overflow: auto;","data-id":s.uuidv4,onDblclick:c?null:this.addLike},Object(o.h)(d.a,{markdown:h.a.replaceImages(s.body,s.images,l,!1),markdownOpts:h.a.getMarkdownOptions()}),t[s.uuidv4]&&Object(o.h)("span",{class:"likeHeart position-absolute text-white display-1",style:"top: calc(50% - 50px); left: calc(50% - 50px); width: 100px; height: 100px;"},Object(o.h)("i",{class:"fas fa-heart likeStory"}))),Object(o.h)("div",{class:"flex-fill position-relative align-self-end mr-2"},s.likes&&s.likes.length>0&&Object(o.h)(e,null,Object(o.h)("div",{class:"position-absolute text-center",style:`line-height: 10px; bottom: 18px; right: ${c?"12px":"0px"};`},Object(o.h)("i",{class:"fas fa-thumbs-up text-warning"}))),c&&s.readDate&&Object(o.h)(e,null,Object(o.h)("div",{class:"position-absolute text-center text-muted border rounded-circle imageRounded imageRoundedIcon pt-0 bg-secondary",style:(u?`background-image: url("${u.s3SmallLink}"); background-size: cover;`:"")+" border-width: 1px !important; line-height: 11px; bottom: 18px; right: -8px;"},!u&&Object(o.h)("span",{class:"font-weight-lighter text-white",style:"font-size: 10px;"},p))),Object(o.h)("small",{class:"text-muted ml-2"},n.a.formatDistance(s.sentDate,new Date,{locale:"no-NB"}))))))))}})||r;t.a=u}).call(this,s("hosL").Fragment)},om2D:function(e,t,s){"use strict";var a,i=s("hosL"),r=s("/eY4"),o=(s("cneo"),s("Utv1"),s("u2zT"));let n=Object(r.a)(a=class extends i.Component{constructor(e){super(e),this.handleAddImage=e=>{const{addToImages:t=!0}=this.props,{updateField:s,object:a,field:i}=this.props;if(i&&s({id:a.id,field:i,value:e,skipTimer:!0}),t){const t=[];t.push(e),s({id:a.id,field:"images",value:t,skipTimer:!0})}},this.state={files:[]}}render(){const{uploadStatus:e=(()=>{}),before:t=(()=>{}),after:s=(()=>{}),autoOpen:a=!0}=this.props;return Object(i.h)("div",{class:"row"},Object(i.h)("div",{class:"col-12"},Object(i.h)(o.a,{handleAddImage:this.handleAddImage,uploadStatus:e,apiUrl:"/api/fileupload",before:t,after:s,autoOpen:a},Object(i.h)("div",{style:{height:30,width:"100%"}}))))}})||a;t.a=n},paVh:function(e,t,s){"use strict";function a(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function i(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var r,o=s("hosL"),n=(s("Utv1"),s("/eY4"));const l={};let c=Object(n.a)(r=class extends o.Component{constructor(e){super(e),this.state=function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?a(Object(s),!0).forEach((function(t){i(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):a(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}({},l),this.container=null}componentDidMount(){this.container.scrollIntoView({behavior:"smooth",block:"start"})}render(){return Object(o.h)("div",{class:"col-12 mb-5",ref:e=>this.container=e},"Â ")}})||r;t.a=c},sSOa:function(e,t,s){"use strict";s.r(t),function(e){function a(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function i(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var r,o=s("hosL"),n=s("Utv1"),l=s("/eY4"),c=s("OhSV"),d=s("go65"),h=s("K+T6"),p=s("paVh"),u=s("om2D"),g=s("ZOvn");const b=g.a.marginTop(!1),f=g.a.marginBottom(),m={};let O=Object(l.a)(r=class extends o.Component{constructor(e){var t;super(e),t=this,this.markAsRead=()=>{const{fromuser:e}=this.props,{messageStore:t,userStore:s}=this.props.stores,{user:a}=s,{unread:i}=t;i>0&&(this.markAsReadTimer=setTimeout(()=>t.markAsRead({to:e,user:a}),2e3))},this.sendMessage=async function(){const{fromuser:e}=t.props,{message:s,sendButtonEnabled:a}=t.state;if(!a)return!1;t.setState({sendButtonEnabled:!1});const{messageStore:i}=t.props.stores;await i.sendMessage({message:s,to:e}),t.setState({showAddImage:!1,message:{body:"",images:[]},sendButtonEnabled:!0},()=>{g.a.resizeTextarea(t.inputRef)})},this.addImage=()=>{const{showAddImage:e}=this.state;this.setState({showAddImage:!e})},this.addImages=({value:e})=>{const{message:t}=this.state;t.images.push(...e),this.setState({message:t})},this.beforeImagesUploaded=()=>{this.setState({sendButtonEnabled:!1})},this.afterImagesUploaded=()=>{this.setState({sendButtonEnabled:!0})},this.handleImageErrored=e=>{const t=e.target;t.onerror=null,setTimeout(()=>{t.src+="?"+new Date},1e3)},this.backIndicate=(e,{absXDiff:t})=>{this.setState({marginLeft:t})},this.back=()=>{const{history:e}=this.props.stores;e.goBack()},this.state=function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?a(Object(s),!0).forEach((function(t){i(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):a(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}({message:{body:"",images:[]},sendButtonEnabled:!0},m),this.inputRef=null}async loadMessages(){const{fromuser:e}=this.props;this.setState({isLoading:!0});const{messageStore:t,userStore:s}=this.props.stores;await s.getNotifications(),await t.getUnReadMessages(),await t.loadConversation({to:e}),this.setState({isLoading:!1}),this.markAsRead()}componentWillMount(){this.loadMessages()}componentWillUnmount(){const{appState:e}=this.props.stores;e.setSwipeRight(),e.setSwipeRightIndicate()}componentDidMount(){const{back:e=this.back,backIndicate:t=this.backIndicate}=this.props,{appState:s}=this.props.stores;s.setSwipeRight(()=>{s.setSwipeRight(),e()}),s.setSwipeRightIndicate((e,{startY:s,startX:a,xUp:i,yUp:r,xDiff:o,yDiff:n,absXDiff:l,absYDiff:c})=>{t(e,{startY:s,startX:a,xUp:i,yUp:r,xDiff:o,yDiff:n,absXDiff:l,absYDiff:c})})}render(){const{message:t,showAddImage:s,marginLeft:a,sendButtonEnabled:i}=this.state,{fromuser:r}=this.props,{messageStore:l,appState:m}=this.props.stores,{darkmode:O}=m,{conversationUser:v={},messages:j=[]}=l,x=j.filter(e=>r===e.user||r===e.fromUser),y=g.a.displayNameShort(v),w=g.a.displayName(v,!0),D=v.image||(v.images?v.images[0]:void 0)||v.teamImage,k=v.teamName,S=v.teamUuidv4;return Object(o.h)(e,null,a>0&&Object(o.h)("div",{class:"position-absolute h-100 w-25 d-flex align-items-center"},Object(o.h)("div",{class:"text-muted"},Object(o.h)("div",{class:"display-4 align-content-center"},Object(o.h)("i",{class:"fas fa-angle-double-right"})),Object(o.h)(c.c,{id:"inbox.go-back"},"Go back"))),Object(o.h)("div",{class:"container-fluid position-relative bg-"+(O?"darkmode":"lightmode"),style:`margin-bottom: ${f}; margin-top: ${b}; margin-left: ${a}px; transition: .2s;`},Object(o.h)("div",{class:"row fixed-top bg-light",style:`margin-top: ${b};`},Object(o.h)("div",{class:"col-12 offset-0 col-sm-8 offset-sm-2 col-lg-6 offset-lg-3 mx-2"},Object(o.h)("button",{onClick:this.back,class:"p-0 btn btn-link float-left mr-3",style:"font-size: 2.8em; line-height: 1.0em;"},Object(o.h)("i",{class:"fas fa-angle-left"})),Object(o.h)("div",{class:"d-flex flex-row flex-nowrap position-relative",style:"overflow: auto;"},Object(o.h)("div",{class:"text-center border rounded-circle imageRounded imageRoundedSmall pt-0",style:(D?`background-image: url("${D.s3SmallLink}"); background-size: cover;`:"")+" border-width: 3px !important;"},!D&&Object(o.h)("span",{class:"font-weight-lighter",style:"font-size: 20px;"},y)),Object(o.h)("div",{class:"flex-grow-1 pl-3 pt-0"},Object(o.h)("div",{class:"text-overflow"},Object(o.h)("strong",null,w)),Object(o.h)("div",{class:"text-overflow"},v.place?v.place+", ":""," ",v.country),k&&Object(o.h)("div",{class:"text-overflow"},Object(o.h)("a",{href:"/teams/public/"+S},k)))))),Object(o.h)("div",{class:"row",style:"margin-top: 110px;"},x&&x.map((t,s)=>Object(o.h)(e,null,Object(o.h)("div",{class:"col-12 offset-0 col-sm-8 offset-sm-2 col-lg-6 offset-lg-3 mt-3"},Object(o.h)(h.a,{stores:this.props.stores,message:t,messageUser:v})),x.length-1===s&&Object(o.h)(p.a,null))),!x||0===x.length&&Object(o.h)(e,null,Object(o.h)("div",{class:"col-12 offset-0 col-sm-8 offset-sm-2 col-lg-6 offset-lg-3 mt-3"},Object(o.h)("div",{class:"mb-5 py-3 text-center"},Object(o.h)("div",{class:"display-1 text-muted"},Object(o.h)("i",{class:"far fa-comments"})),Object(o.h)("h3",null,Object(o.h)(c.c,{id:"inbox.write-message"},"Write the first message ðŸ˜ƒ")),Object(o.h)("span",{class:"text-muted"},Object(o.h)(c.c,{id:"inbox.write-message-help"},"Use the message field at the bottom of the page."),Object(o.h)("br",null)))))),Object(o.h)("div",{class:"fixed-bottom w-100 px-1 py-1 bg-light",style:"margin-bottom: 60px;"},Object(o.h)("div",{class:"col-12 offset-0 col-sm-8 offset-sm-2 col-lg-6 offset-lg-3 mt-0"},Object(o.h)("div",{class:"d-flex flex-row flex-nowrap position-relative",style:"overflow: auto;"},Object(o.h)("div",{class:"flex-grow-1 pb-2"},Object(o.h)("label",{class:"sr-only",for:"inboxSearch"},Object(o.h)(c.c,{id:"inbox.search"},"Search")),Object(o.h)("div",{class:"border rounded rounded-lg position-relative"},Object(o.h)(c.b,null,Object(o.h)("textarea",{class:"form-control-plaintext px-2",onInput:Object(d.a)(this,"message.body"),onKeyUp:g.a.resizeTextarea,onFocus:g.a.resizeTextarea,style:"height: 2.3em;",value:t.body,ref:e=>this.inputRef=e})),Object(o.h)("div",{class:"position-absolute",style:"bottom: 8px; right: 10px; font-size: 1.2em;"},Object(o.h)("i",{class:"fas fa-image pointerCursor",onClick:this.addImage})))),Object(o.h)("div",{class:"align-self-end ml-1"},Object(o.h)("button",{type:"button",class:"btn btn-primary mb-2",onClick:this.sendMessage,disabled:!i},Object(o.h)("i",{class:"fas fa-paper-plane"})))),s&&Object(o.h)(e,null,Object(o.h)("div",{class:"col-12 text-center mt-2"},Object(o.h)("div",{class:"container-fluid"},Object(o.h)("div",{class:"row"},n.a.isArray(t.images)&&t.images.map(e=>Object(o.h)("div",{class:"col-3 p-1"},Object(o.h)("img",{src:e.s3SmallLink,class:"img-fluid",onError:this.handleImageErrored}),Object(o.h)("button",{class:"btn btn-sm btn-link",onClick:this.removeImage,"data-name":e.name},Object(o.h)("i",{class:"fas fa-trash"})," Del"))))),Object(o.h)(u.a,{object:t,updateField:this.addImages,before:this.beforeImagesUploaded,after:this.afterImagesUploaded,autoOpen:!0})))))))}})||r;t.default=O}.call(this,s("hosL").Fragment)},u2zT:function(e,t,s){"use strict";var a,i=s("hosL"),r=s("/eY4"),o=s("Utv1"),n=s("OhSV");let l=Object(r.a)(a=class extends i.Component{constructor(e){super(e),this.dropRef=Object(i.createRef)(),this.handleDrag=e=>{e.preventDefault(),e.stopPropagation()},this.handleDragIn=e=>{e.preventDefault(),e.stopPropagation(),this.dragCounter++,e.dataTransfer.items&&e.dataTransfer.items.length>0&&this.setState({drag:!0})},this.handleDragOut=e=>{e.preventDefault(),e.stopPropagation(),this.dragCounter--,0===this.dragCounter&&this.setState({drag:!1})},this.handleDrop=e=>{if(e.preventDefault(),e.stopPropagation(),this.setState({drag:!1}),e.dataTransfer.files&&e.dataTransfer.files.length>0){for(let t=0,s=e.dataTransfer.files.length;t<s;t+=1){this.readLocalFile(e.dataTransfer.files[t])}this.dragCounter=0}},this.handleAddFiles=e=>{e.preventDefault();const t=e.target;for(let e=0,s=t.files.length;e<s;e+=1){this.readLocalFile(t.files[e])}},this.handleEvent=()=>{0},this.handleUpload=e=>{const{uploadStatus:t=(()=>{}),before:s=(()=>{}),after:a=(()=>{})}=this.props;t(!1),o.a.isFunction(s)&&s();const i=new FormData;i.append("files[]",e);const r={progress:1};r.xhr=new XMLHttpRequest,r.xhr.upload.addEventListener("progress",t=>{this.updateProgress(t,e)}),r.xhr.addEventListener("loadstart",t=>{this.handleEvent(t,e)}),r.xhr.addEventListener("load",t=>{this.handleEvent(t,e)}),r.xhr.addEventListener("loadend",t=>{const s=e;o.a.isFunction(a)&&a(),this.handleEvent(t,s)}),r.xhr.addEventListener("progress",t=>{this.handleEvent(t,e)}),r.xhr.addEventListener("error",t=>{this.handleEvent(t,e)}),r.xhr.addEventListener("abort",t=>{this.handleEvent(t,e)}),r.xhr.addEventListener("readystatechange",t=>{this.uploadDone(t,e)}),r.xhr.open("POST",`${o.a.getApiServer()}${this.props.apiUrl}`),r.xhr.setRequestHeader("Authorization","Bearer "+o.a.getJwtToken()),r.xhr.send(i);const n=e.name,l=this.state.uploadedFilesData;l[n]||(l[n]={}),l[n].uploadMeta=r,l[n].imageNum=this.state.imageNum,this.setState({uploadedFilesData:l})},this.readLocalFile=e=>new Promise((t,s)=>{const a=new FileReader;a.addEventListener("error",e=>{s(e)}),a.addEventListener("load",s=>{const a=e,i=a.name,r=this.state.uploadedFilesData;r[i]||(r[i]={}),r[i].event=s,this.setState({uploadedFilesData:r}),this.handleUpload(a),t(s)}),a.readAsDataURL(e)}),this.updateProgress=(e,t)=>{if(e.lengthComputable){const s=t.name,a=this.state.uploadedFilesData,i=e.loaded/e.total*100;0,a[s].uploadMeta.progress=i,this.setState({uploadedFilesData:a})}},this.uploadDone=(e,t)=>{const s=t.name,a=this.state.uploadedFilesData,i=a[s].uploadMeta;if(i&&4===i.xhr.readyState&&201===i.xhr.status){const e=JSON.parse(i.xhr.responseText).data.files;for(let t=0;t<e.length;t+=1){this.addFileToUpload(e[t]),this.fileInput.value=""}}},this.state={drag:!1,loadingProgress:0,uploadedFiles:[],uploadedFilesData:{}}}addFileToUpload(e){const{uploadedFilesData:t}=this.state,{handleAddImage:s,uploadStatus:a=(()=>{})}=this.props;delete t[e.name],this.setState({uploadedFilesData:t}),s(e),a(!0)}componentDidMount(){const e=this.dropRef.current;e.addEventListener("dragenter",this.handleDragIn),e.addEventListener("dragleave",this.handleDragOut),e.addEventListener("dragover",this.handleDrag),e.addEventListener("drop",this.handleDrop);const{autoOpen:t}=this.props;t&&setTimeout(()=>{this.fileInput.click()},10)}componentWillUnmount(){const e=this.dropRef.current;e.removeEventListener("dragenter",this.handleDragIn),e.removeEventListener("dragleave",this.handleDragOut),e.removeEventListener("dragover",this.handleDrag),e.removeEventListener("drop",this.handleDrop)}render(){const{uploadedFilesData:e}=this.state;return Object(i.h)("div",{style:{position:"relative"},ref:this.dropRef},this.state.drag&&Object(i.h)("div",{style:{border:"dashed grey 4px",backgroundColor:"rgba(255,255,255,.8)",position:"absolute",top:0,bottom:0,left:0,right:0,zIndex:9999}},Object(i.h)("div",{style:{position:"absolute",top:"50%",right:0,left:0,textAlign:"center",color:"grey",fontSize:36}},Object(i.h)("div",null,Object(i.h)(n.c,{id:"imageupload.drag-files-here"},"drop your files here :)")))),Object(i.h)("div",null,Object(i.h)("input",{class:"btn btn-info col-sm-12",multiple:!0,type:"file",id:"image-file",onchange:this.handleAddFiles,ref:e=>{this.fileInput=e}})),Object(i.h)("div",null,Object.keys(e).length>0?Object(i.h)("h3",null,Object(i.h)(n.c,{id:"imageupload.upload-images"},"Uploaded images")):"",Object(i.h)("ul",{class:"list-group"},Object.keys(e).map(t=>{const{uploadMeta:s={}}=e[t],a=t.match(/(jpg|jpeg|png|gif|heic|heif|svg|webp|tif)/i);return Object(i.h)("li",{class:"list-group-item list-group-item-action flex-column align-items-start"},Object(i.h)("div",{class:"d-flex w-100 justify-content-between"},a&&Object(i.h)("img",{class:"img-fluid mr-3",src:e[t].event.target.result,style:"max-height: 50px;"}),Object(i.h)("small",null,e[t].event.uploadDone),Object(i.h)(n.c,{id:"imageupload.uploading-image"},"Laster opp bilde..."),Object(i.h)("small",null,o.a.formatBytes(e[t].event.total,2))),Object(i.h)("div",{class:"progress mt-1",style:"height: 4px;"},Object(i.h)("div",{class:"progress-bar progress-bar-striped progress-bar-animated bg-success",role:"progressbar",style:`width: ${s.progress}%; height: 4px;`,"aria-valuenow":s.progress,"aria-valuemin":"0","aria-valuemax":"100"})))}))),this.props.children)}})||a;t.a=l}}]);
//# sourceMappingURL=81.chunk.10b43.esm.js.map