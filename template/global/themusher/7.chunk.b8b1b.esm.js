(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"3on9":function(e,t,s){"use strict";(function(e){function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}function i(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function o(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?i(Object(s),!0).forEach((function(t){d(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):i(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function d(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var l,n=s("hosL"),r=s("Utv1"),c=s("/eY4"),h=s("cneo"),g=s("go65"),p=(s("Y3FI"),s("OhSV")),b=s("dVCl");const u={id:0,name:"empty"},m=()=>{const e=o({},u);return e.unique=`${(new Date).getTime()}-${r.a.randomPassword()}`,e};class f extends n.Component{render(){const{provided:e,snapshot:t,innerRef:s,children:i,className:o}=this.props;return Object(n.h)("div",a({class:"h-100 border "+o},e.droppableProps,{ref:s,style:(d=t.isDraggingOver,{borderStyle:d?"dashed":"",width:110})}),i);var d}}class O extends n.Component{constructor(...e){super(...e),this.removeThisPlaceholder=()=>{const{removePlaceholder:e=(()=>{}),idx:t,list:s}=this.props;e({idx:t,list:s})}}render(){const{provided:t,snapshot:s,innerRef:i,dog:d}=this.props;return Object(n.h)("div",a({},t.draggableProps,t.dragHandleProps,{ref:i,class:"mx-2 my-2 p-2",style:(l=s.isDragging,c=t.draggableProps.style,o({userSelect:"none",background:l?"#808080":"",maxWidth:92,height:100},c))}),0===d.id?Object(n.h)(e,null,Object(n.h)("div",null,Object(n.h)("div",{class:"text-center border rounded-circle imageRounded text-muted pt-2"},Object(n.h)("span",{class:"font-weight-lighter",style:"font-size: 35px;"}," ")),Object(n.h)("div",{class:"text-center"},Object(n.h)("button",{class:"btn btn-sm btn-link float-right p-0",onClick:this.removeThisPlaceholder},Object(n.h)("i",{class:"fas fa-trash-alt"}))," "))):Object(n.h)(e,null,Object(n.h)("div",null,Object(n.h)("div",{class:"text-center border rounded-circle imageRounded text-muted pt-2",style:""+(d.image?`background-image: url("${d.image.s3ThumbLink}");`:"")},!d.image&&Object(n.h)("span",{class:"font-weight-lighter",style:"font-size: 35px;"},r.a.ucfirst(d.name,!0))),Object(n.h)("div",{class:"text-center"},Object(n.h)("small",null,d.shortname||d.name,Object(n.h)("br",null))))));var l,c}}const j={filterby:r.a.get("dogs-filter")};let v=Object(c.a)(l=class extends n.Component{constructor(e){var t;super(e),t=this,this.toggleDog=async function(e){const{id:s}=e.target.closest("#dogContainer").dataset,a=parseInt(s,10),{object:i,type:o,elementtype:d,field:l,updateField:n,isNew:r,showPositions:c}=t.props,g=Object(h.i)(i[l])||[],p=g.indexOf(a);let b;p>-1?(g.splice(p,1),b="remove"):(g.push(a),b="add"),await n({id:i.id,field:l,value:g,type:o,elementtype:d,isNew:r,skipTimer:!0,singleValue:a}),t.setState({filterText:""}),c&&t.dndDogs({dogId:a,action:b})},this.findAllDogsInTeams=()=>{const{dogStore:e}=this.props.stores,{dogs:t=[]}=e,{object:s,currentTeam:a={}}=this.props,i=Object(h.i)(s.teams||[]),o=a.id;return t.filter(e=>!!(e.team===o||e.teams&&e.teams.indexOf(o)>-1)||(i.indexOf(e.team)>-1||!!e.teams&&e.teams.some(e=>i.indexOf(e)>=0))).map(e=>e.id)},this.addAllDogsInTeam=async function(){const{object:e,type:s,elementtype:a,field:i,updateField:o,isNew:d}=t.props,l=t.findAllDogsInTeams();await o({id:e.id,field:i,value:l,type:s,elementtype:a,isNew:d,skipTimer:!0})},this.dndDogs=({dogId:e,action:t})=>{const{dogStore:s}=this.props.stores,{dogs:a=[]}=s,{object:i}=this.props,o=i.dogs?e=>i.dogs.indexOf(e.id)>-1:()=>!1,d=Object(h.i)(a),l=e=>0===e||d.find(t=>t.id===e)&&-1===i.dogsRight.indexOf(e),n=e=>0===e||d.find(t=>t.id===e)&&-1===i.dogsLeft.indexOf(e),r=d.filter(o),c=Math.ceil(r.length/2),g=r.splice(0,c);let p=[];i.dogsLeft&&i.dogsLeft.length>0&&(p=i.dogsLeft.filter(l).map(e=>d.find(t=>t.id===e)||m()));let b=[];if(i.dogsRight&&i.dogsRight.length>0&&(b=i.dogsRight.filter(n).map(e=>d.find(t=>t.id===e)||m())),"add"===t){const t=a.find(t=>t.id===e);t&&(p.length>b.length?b.push(t):p.push(t))}if("remove"===t){const t=p.findIndex(t=>t.id===e);t>-1&&p.splice(t,1);const s=b.findIndex(t=>t.id===e);s>-1&&b.splice(s,1)}0===p.length&&0===b.length&&(p=g,b=r),t?this.setState({dogsLeft:p,dogsRight:b,dogPositionUpdated:!0},()=>this.updateDogPositions()):this.setState({dogsLeft:p,dogsRight:b})},this.addPlaceholderLeft=()=>{const{dogsLeft:e=[]}=this.state;e.push(m()),this.setState({dogsLeft:e,dogPositionUpdated:!0})},this.addPlaceholderRight=()=>{const{dogsRight:e=[]}=this.state;e.push(m()),this.setState({dogsRight:e,dogPositionUpdated:!0})},this.removePlaceholder=({idx:e,list:t})=>{if("dogsLeft"===t){const{dogsLeft:t=[]}=this.state;t.splice(e,1),this.setState({dogsLeft:t,dogPositionUpdated:!0})}if("dogsRight"===t){const{dogsRight:t=[]}=this.state;t.splice(e,1),this.setState({dogsRight:t,dogPositionUpdated:!0})}},this.clearAllDogs=async function(){const{object:e,type:s,elementtype:a,field:i,updateField:o,isNew:d}=t.props;await o({id:e.id,field:i,value:[],type:s,elementtype:a,isNew:d,skipTimer:!0}),t.resetDogPositions()},this.toggleSearchField=()=>{const{showSearchField:e}=this.state;this.setState({showSearchField:e?null:1})},this.getList=e=>this.state[e],this.onDragEnd=e=>{const{source:t,destination:s}=e;if(s)if(t.droppableId===s.droppableId){const e=((e,t,s)=>{const a=Array.from(e),[i]=a.splice(t,1);return a.splice(s,0,i),a})(this.getList(t.droppableId),t.index,s.index);this.setState({[t.droppableId]:e,dogPositionUpdated:!0})}else{const e=((e,t,s,a)=>{const i=Array.from(e),o=Array.from(t),[d]=i.splice(s.index,1);o.splice(a.index,0,d);const l={};return l[s.droppableId]=i,l[a.droppableId]=o,l})(this.getList(t.droppableId),this.getList(s.droppableId),t,s);this.setState({dogsLeft:e.dogsLeft,dogsRight:e.dogsRight,dogPositionUpdated:!0})}},this.updateDogPositions=async function(){const{dogsLeft:e=[],dogsRight:s=[]}=t.state,{object:a,updateField:i,isNew:o}=t.props;await i({id:a.id,field:"dogsLeft",value:e.map(e=>e.id),isNew:o,datatype:"array"}),await i({id:a.id,field:"dogsRight",value:s.map(e=>e.id),isNew:o,datatype:"array"}),t.setState({dogPositionUpdated:!1})},this.resetDogPositions=async function(){const{dogStore:e}=t.props.stores,{dogs:s=[]}=e,{object:a,updateField:i,isNew:o}=t.props,d=Object(h.i)(s).filter(e=>a.dogs.indexOf(e.id)>-1),l=Math.ceil(d.length/2),n=d.splice(0,l);await i({id:a.id,field:"dogsLeft",value:n.map(e=>e.id),isNew:o,datatype:"array"}),await i({id:a.id,field:"dogsRight",value:d.map(e=>e.id),isNew:o,datatype:"array"}),t.setState({dogsLeft:n,dogsRight:d,dogPositionUpdated:!1})},this.clearDogPositions=async function(){const{object:e,updateField:s,isNew:a}=t.props,i=[],o=[];await s({id:e.id,field:"dogsLeft",value:o,isNew:a,datatype:"array"}),await s({id:e.id,field:"dogsRight",value:i,isNew:a,datatype:"array"}),t.setState({dogsLeft:o,dogsRight:i,dogPositionUpdated:!1})},this.changeFilter=e=>{const t=e.target.value;this.setState({filterby:t}),r.a.set("dogs-filter",t),this.loadDog()},this.getFilteredDogs=(e=this.props)=>{const{filterby:t,filterText:s}=this.state,{object:a,filter:i=(()=>!0)}=e,{dogStore:o}=this.props.stores,{dogs:d=[]}=o;let l=i;if(a.dogs)switch(t){case"all":l=s?e=>e.name.match(new RegExp(s,"i"))||a.dogs.indexOf(e.id)>-1:()=>!0;break;case"onlySelected":l=s?e=>e.name.match(new RegExp(s,"i"))||a.dogs.indexOf(e.id)>-1:e=>a.dogs.indexOf(e.id)>-1;break;case"onlyTeam":l=s?e=>e.name.match(new RegExp(s,"i"))||a.dogs.indexOf(e.id)>-1:e=>a.team===e.team||a.dogs.indexOf(e.id)>-1;break;case"leadOnly":l=e=>a.dogs.indexOf(e.id)>-1||r.a.getNestedValue(e,"positions.lead.distanceKm")>0;break;case"pointOnly":l=e=>a.dogs.indexOf(e.id)>-1||r.a.getNestedValue(e,"positions.point.distanceKm")>0;break;case"teamOnly":l=e=>a.dogs.indexOf(e.id)>-1||r.a.getNestedValue(e,"positions.team.distanceKm")>0;break;case"wheelOnly":l=e=>a.dogs.indexOf(e.id)>-1||r.a.getNestedValue(e,"positions.wheel.distanceKm")>0}let n=d.filter(l);this.setState({filteredDogs:n})},this.state=o({dogsLeft:[],dogsRight:[]},j)}async loadDog(e=this.props){const{showPositions:t}=this.props,{dogStore:s}=e.stores;await s.load({query:{deceased:0},addData:["team","user","workoutSummary","vaccineStatuses","historyStatuses","vaccineLogStatuses","allDogs"]}),t&&this.dndDogs({}),this.getFilteredDogs()}componentWillReceiveProps(e){e.filter!==this.props.filter&&this.getFilteredDogs(e)}componentDidMount(){this.loadDog()}render(){const{filterby:t,filterText:s,showSearchField:a,dogsLeft:i=[],dogsRight:o=[],dogPositionUpdated:d,filteredDogs:l=[]}=this.state,{userStore:c,dogStore:u}=this.props.stores,{dogs:m=[]}=u,{user:j}=c,{language:v="en"}=j,{saved:y={},object:x,field:w,title:D,icon:P,help:L,showPositions:S=!1,currentTeam:k={}}=this.props,R=Object(h.i)(x[w])||[],F=this.findAllDogsInTeams(),T=x.teams?x.teams.map(e=>c.findTeam(e)):[];return Object(n.h)("div",{class:"form-group  mb-5 pb-1 border-bottom "+(y[`${w}.${x.id}`]?"is-valid":"")},Object(n.h)("span",{class:"float-right",onClick:this.toggleSearchField},Object(n.h)("i",{class:"fas fa-search"})),Object(n.h)("button",{class:"btn btn-sm btn-link float-right mr-5",onClick:this.clearAllDogs},Object(n.h)("i",{class:"fas fa-eraser"})," ",Object(n.h)(p.c,{id:"dog.dogs.remove-all-dogs"},"Fjern alle hundene")),Object(n.h)("label",{for:w+"Input"},P&&Object(n.h)("i",{class:P+" text-muted"})," ",D),Object(n.h)("div",{class:"container-fluid px-0"},a&&Object(n.h)("div",{class:"row"},Object(n.h)("div",{class:"col-12"},Object(n.h)(p.b,null,Object(n.h)("input",{class:"form-control form-control-sm",type:"text",placeholder:Object(n.h)(p.c,{id:"dog.dogs.search-for-dogs"},"Søk etter hund"),value:s,onInput:Object(g.a)(this,"filterText")})))),Object(n.h)("div",{class:"row"},Object(n.h)("div",{class:"col-12"},Object(n.h)("div",{class:"form-row align-items-center"},Object(n.h)("div",{class:"col-auto my-2 mx-auto"},Object(n.h)("select",{class:"custom-select",style:"background-color: inherit; border: none; padding-top: 0; padding-bottom: 0; height: 1.4em; font-size: 0.8em;",onInput:this.changeFilter},Object(n.h)("option",{value:"",selected:!t},"-- ",Object(n.h)(p.c,{id:"dog.dogs.choose-filter"},"Choose filter")," ---"),Object(n.h)("option",{value:"all",selected:"all"===t},Object(n.h)(p.c,{id:"dog.dogs.show-all"},"Vis alle")),Object(n.h)("option",{value:"onlySelected",selected:"onlySelected"===t},Object(n.h)(p.c,{id:"dog.dogs.show-only-selected"},"Vis kun valgte")),Object(n.h)("option",{value:"onlyTeam",selected:"onlyTeam"===t},Object(n.h)(p.c,{id:"dog.dogs.show-only-team-dogs"},"Vis kun hundene i teamet")),Object(n.h)("option",{value:"leadOnly",selected:"leadOnly"===t},Object(n.h)(p.c,{id:"dog.dogs.show-lead-dogs-only"},"Vis kun lederhunder")),Object(n.h)("option",{value:"pointOnly",selected:"pointOnly"===t},Object(n.h)(p.c,{id:"dog.dogs.show-point-dogs-only"},"Vis kun pointhunder")),Object(n.h)("option",{value:"teamOnly",selected:"teamOnly"===t},Object(n.h)(p.c,{id:"dog.dogs.show-team-dogs-only"},"Vis kun teamhunder")),Object(n.h)("option",{value:"wheelOnly",selected:"wheelOnly"===t},Object(n.h)(p.c,{id:"dog.dogs.show-wheel-dogs-only"},"Vis kun wheelhunder"))))))),Object(n.h)("div",{class:"row"},F.length>0&&Object(n.h)(e,null,Object(n.h)("button",{class:"btn btn-primary btn-block",onClick:this.addAllDogsInTeam},Object(n.h)("i",{class:"fas fa-plus mr-2"})," ",Object(n.h)(p.c,{id:"dog.dogs.add-all-in-team",fields:{total:F.length}},"Add all dogs in team"),k.name?": "+k.name:"",T&&T.length>0&&Object(n.h)("span",{class:"font-weight-lighter"},", ",T.map((t,s)=>Object(n.h)(e,null,s>0?", ":"",t))))),r.a.isArray(m)&&l.map(e=>{const s=c.findDogstatus({status:e.status,language:v}),a=c.findDogposition({position:e.position,language:v}),i=u.findHistoryStatuses(e.id);return Object(n.h)("div",{class:"col-6 col-sm-6 col-md-6 col-lg-6 mb-1"},Object(n.h)("div",{class:`border rounded px-3 pt-2 pb-1 ${R.indexOf(e.id)>-1?"bg-success":""} position-relative`,onClick:this.toggleDog,id:"dogContainer","data-id":e.id,style:"padding: .3rem !important; line-height: 1.1em; cursor: pointer; pointer-events: inherit;"},a&&Object(n.h)("small",{class:"position-absolute",style:"left:5px; top: 32px;"},Object(n.h)("span",{class:`badge badge-${a.class||"primary"} mr-3`},a.icon&&Object(n.h)("i",{class:a.icon})," ",a.name)),"leadOnly"===t&&r.a.getNestedValue(e,"positions.lead.distanceKm")>0&&Object(n.h)("small",{class:"position-absolute",style:"left:5px; top: 32px;"},Object(n.h)("span",{class:"badge badge-secondary mr-3"},Object(n.h)(p.c,{id:"dogs.sort-lead"},"Lead"),": ",r.a.format(r.a.getNestedValue(e,"positions.lead.distanceKm"),0),"km")),"pointOnly"===t&&r.a.getNestedValue(e,"positions.point.distanceKm")>0&&Object(n.h)("small",{class:"position-absolute",style:"left:5px; top: 32px;"},Object(n.h)("span",{class:"badge badge-secondary mr-3"},Object(n.h)(p.c,{id:"dogs.sort-point"},"Point"),": ",r.a.format(r.a.getNestedValue(e,"positions.point.distanceKm"),0),"km")),"teamOnly"===t&&r.a.getNestedValue(e,"positions.team.distanceKm")>0&&Object(n.h)("small",{class:"position-absolute",style:"left:5px; top: 32px;"},Object(n.h)("span",{class:"badge badge-secondary mr-3"},Object(n.h)(p.c,{id:"dogs.sort-team"},"Team"),": ",r.a.format(r.a.getNestedValue(e,"positions.team.distanceKm"),0),"km")),"wheelOnly"===t&&r.a.getNestedValue(e,"positions.wheel.distanceKm")>0&&Object(n.h)("small",{class:"position-absolute",style:"left:5px; top: 32px;"},Object(n.h)("span",{class:"badge badge-secondary mr-3"},Object(n.h)(p.c,{id:"dogs.sort-wheel"},"Wheel"),": ",r.a.format(r.a.getNestedValue(e,"positions.wheel.distanceKm"),0),"km")),Object(n.h)("div",{class:"d-flex"},Object(n.h)("div",{class:"text-center border rounded-circle imageRounded imageRoundedSmall text-muted pt-2",style:""+(e.image?`background-image: url("${e.image.s3ThumbLink}");`:"")},!e.image&&Object(n.h)("span",{class:"font-weight-lighter",style:"font-size: 20px;"},r.a.ucfirst(e.name,!0))),Object(n.h)("div",{class:"flex-grow-1 pl-2 pr-1",style:`border-right: 4px solid ${c.findHarness(e.harness,"colorNonstop")} !important; line-height: 0.9em;`},Object(n.h)("small",null,Object(n.h)("small",{class:"float-right"},e.birth&&Object(n.h)("span",{class:"mr-1"},r.a.age(e.birth,e.deceased)),"female"===e.gender?Object(n.h)("i",{class:"fas fa-venus"}):Object(n.h)("i",{class:"fas fa-mars"})),e.shortname||e.name,Object(n.h)("br",null),Object(n.h)("div",{style:"line-height: 0.8em;"},Object(n.h)("small",null,c.findTeam(e.team)))),Object(n.h)("small",{class:"float-right"},s&&s.id&&Object(n.h)("span",{class:`badge badge-${s.class} mr-2 font-weight-light`},s.icon&&Object(n.h)("i",{class:s.icon})," ",s.name),e.specialNeeds&&Object(n.h)("span",{class:"badge badge-warning mr-2 font-weight-light"},Object(n.h)("i",{class:"fas fa-exclamation-triangle"})," ",e.specialNeeds),i&&i.map(e=>Object(n.h)("span",{class:"badge badge-warning mr-2",title:r.a.isoDate(e.endDate,!1,!1,!0)},e.title)))))))}))),y[`${w}.${x.id}`]?Object(n.h)("div",{class:"valid-feedback",style:"display: block;"},Object(n.h)(p.c,{id:"dog.dogs.saved-changes"},"Endringene er lagret")):Object(n.h)("small",{id:w+"Help",class:"form-text text-muted"},L),S&&Object(n.h)(e,null,Object(n.h)("div",{class:"container-fluid px-0 clearfix"},Object(n.h)("div",{class:"row"},Object(n.h)("div",{class:"col-12"},Object(n.h)("h5",null,Object(n.h)(p.c,{id:"dog.dogs.dogs-positions"},"Posisjoner i spannet")))),Object(n.h)(b.a,{onDragEnd:this.onDragEnd},Object(n.h)("div",{class:"row"},Object(n.h)("div",{class:"col-6 pr-0",style:"min-height: 100px;"},Object(n.h)(b.c,{droppableId:"dogsLeft"},(e,t)=>Object(n.h)(f,{provided:e,snapshot:t,innerRef:e.innerRef,className:"ml-auto"},i&&i.map((e,s)=>Object(n.h)(b.b,{key:`${e.id}-${e.unique}`,draggableId:`dragId-${e.id}-${e.unique}`,index:s},a=>Object(n.h)(O,{provided:a,snapshot:t,innerRef:a.innerRef,dog:e,removePlaceholder:this.removePlaceholder,idx:s,list:"dogsLeft"}))),e.placeholder))),Object(n.h)("div",{class:"col-6 pl-0",style:"min-height: 100px;"},Object(n.h)(b.c,{droppableId:"dogsRight"},(e,t)=>Object(n.h)(f,{provided:e,snapshot:t,innerRef:e.innerRef,className:"mr-auto"},o&&o.map((e,s)=>Object(n.h)(b.b,{key:`${e.id}-${e.unique}`,draggableId:`dragId-${e.id}-${e.unique}`,index:s},a=>Object(n.h)(O,{provided:a,snapshot:t,innerRef:a.innerRef,dog:e,removePlaceholder:this.removePlaceholder,idx:s,list:"dogsRight"}))),e.placeholder))))),Object(n.h)("div",{class:"row mb-3 mt-2"},Object(n.h)("div",{class:"col-6 pr-0"},Object(n.h)("button",{class:"btn btn-sm btn-outline-secondary",onClick:this.addPlaceholderLeft},Object(n.h)("i",{class:"fas fa-plus-circle"})," ",Object(n.h)(p.c,{id:"dog.dogs.addplaceholder"},"Add placeholder"))),Object(n.h)("div",{class:"col-6 pl-0"},Object(n.h)("button",{class:"float-right btn btn-sm btn-outline-secondary",onClick:this.addPlaceholderRight},Object(n.h)("i",{class:"fas fa-plus-circle"})," ",Object(n.h)(p.c,{id:"dog.dogs.addplaceholder"},"Add placeholder"))))),Object(n.h)("div",{class:"container-fluid px-0"},Object(n.h)("div",{class:"row"},Object(n.h)("div",{class:"col-6"},Object(n.h)("button",{class:"btn btn-sm btn-"+(d?"primary":"secondary"),onClick:this.updateDogPositions},Object(n.h)("i",{class:"fas fa-save"})," ",Object(n.h)(p.c,{id:"dog.dogs.saveDogPositions"},"Save dog positions"))),Object(n.h)("div",{class:"col-6"},Object(n.h)("button",{class:"float-right btn btn-sm btn-warning",onClick:this.resetDogPositions},Object(n.h)("i",{class:"fas fa-sync"})," ",Object(n.h)(p.c,{id:"dog.dogs.resetDogPositions"},"Reset dog positions")))),Object(n.h)("div",{class:"row mt-2"},Object(n.h)("div",{class:"col-6"}," "),Object(n.h)("div",{class:"col-6"},Object(n.h)("button",{class:"float-right btn btn-sm btn-link",onClick:this.clearDogPositions},Object(n.h)("i",{class:"fas fa-eraser"})," ",Object(n.h)(p.c,{id:"dog.dogs.clearDogPositions"},"Clear dog positions")))))))}})||l;t.a=v}).call(this,s("hosL").Fragment)},om2D:function(e,t,s){"use strict";var a,i=s("hosL"),o=s("/eY4"),d=(s("cneo"),s("Utv1"),s("u2zT"));let l=Object(o.a)(a=class extends i.Component{constructor(e){super(e),this.handleAddImage=e=>{const{addToImages:t=!0}=this.props,{updateField:s,object:a,field:i}=this.props;if(i&&s({id:a.id,field:i,value:e,skipTimer:!0}),t){const t=[];t.push(e),s({id:a.id,field:"images",value:t,skipTimer:!0})}},this.state={files:[]}}render(){const{uploadStatus:e=(()=>{}),before:t=(()=>{}),after:s=(()=>{}),autoOpen:a=!0}=this.props;return Object(i.h)("div",{class:"row"},Object(i.h)("div",{class:"col-12"},Object(i.h)(d.a,{handleAddImage:this.handleAddImage,uploadStatus:e,apiUrl:"/api/fileupload",before:t,after:s,autoOpen:a},Object(i.h)("div",{style:{height:30,width:"100%"}}))))}})||a;t.a=l},u2zT:function(e,t,s){"use strict";var a,i=s("hosL"),o=s("/eY4"),d=s("Utv1"),l=s("OhSV");let n=Object(o.a)(a=class extends i.Component{constructor(e){super(e),this.dropRef=Object(i.createRef)(),this.handleDrag=e=>{e.preventDefault(),e.stopPropagation()},this.handleDragIn=e=>{e.preventDefault(),e.stopPropagation(),this.dragCounter++,e.dataTransfer.items&&e.dataTransfer.items.length>0&&this.setState({drag:!0})},this.handleDragOut=e=>{e.preventDefault(),e.stopPropagation(),this.dragCounter--,0===this.dragCounter&&this.setState({drag:!1})},this.handleDrop=e=>{if(e.preventDefault(),e.stopPropagation(),this.setState({drag:!1}),e.dataTransfer.files&&e.dataTransfer.files.length>0){for(let t=0,s=e.dataTransfer.files.length;t<s;t+=1){this.readLocalFile(e.dataTransfer.files[t])}this.dragCounter=0}},this.handleAddFiles=e=>{e.preventDefault();const t=e.target;for(let e=0,s=t.files.length;e<s;e+=1){this.readLocalFile(t.files[e])}},this.handleEvent=()=>{0},this.handleUpload=e=>{const{uploadStatus:t=(()=>{}),before:s=(()=>{}),after:a=(()=>{})}=this.props;t(!1),d.a.isFunction(s)&&s();const i=new FormData;i.append("files[]",e);const o={progress:1};o.xhr=new XMLHttpRequest,o.xhr.upload.addEventListener("progress",t=>{this.updateProgress(t,e)}),o.xhr.addEventListener("loadstart",t=>{this.handleEvent(t,e)}),o.xhr.addEventListener("load",t=>{this.handleEvent(t,e)}),o.xhr.addEventListener("loadend",t=>{const s=e;d.a.isFunction(a)&&a(),this.handleEvent(t,s)}),o.xhr.addEventListener("progress",t=>{this.handleEvent(t,e)}),o.xhr.addEventListener("error",t=>{this.handleEvent(t,e)}),o.xhr.addEventListener("abort",t=>{this.handleEvent(t,e)}),o.xhr.addEventListener("readystatechange",t=>{this.uploadDone(t,e)}),o.xhr.open("POST",`${d.a.getApiServer()}${this.props.apiUrl}`),o.xhr.setRequestHeader("Authorization","Bearer "+d.a.getJwtToken()),o.xhr.send(i);const l=e.name,n=this.state.uploadedFilesData;n[l]||(n[l]={}),n[l].uploadMeta=o,n[l].imageNum=this.state.imageNum,this.setState({uploadedFilesData:n})},this.readLocalFile=e=>new Promise((t,s)=>{const a=new FileReader;a.addEventListener("error",e=>{s(e)}),a.addEventListener("load",s=>{const a=e,i=a.name,o=this.state.uploadedFilesData;o[i]||(o[i]={}),o[i].event=s,this.setState({uploadedFilesData:o}),this.handleUpload(a),t(s)}),a.readAsDataURL(e)}),this.updateProgress=(e,t)=>{if(e.lengthComputable){const s=t.name,a=this.state.uploadedFilesData,i=e.loaded/e.total*100;0,a[s].uploadMeta.progress=i,this.setState({uploadedFilesData:a})}},this.uploadDone=(e,t)=>{const s=t.name,a=this.state.uploadedFilesData,i=a[s].uploadMeta;if(i&&4===i.xhr.readyState&&201===i.xhr.status){const e=JSON.parse(i.xhr.responseText).data.files;for(let t=0;t<e.length;t+=1){this.addFileToUpload(e[t]),this.fileInput.value=""}}},this.state={drag:!1,loadingProgress:0,uploadedFiles:[],uploadedFilesData:{}}}addFileToUpload(e){const{uploadedFilesData:t}=this.state,{handleAddImage:s,uploadStatus:a=(()=>{})}=this.props;delete t[e.name],this.setState({uploadedFilesData:t}),s(e),a(!0)}componentDidMount(){const e=this.dropRef.current;e.addEventListener("dragenter",this.handleDragIn),e.addEventListener("dragleave",this.handleDragOut),e.addEventListener("dragover",this.handleDrag),e.addEventListener("drop",this.handleDrop);const{autoOpen:t}=this.props;t&&setTimeout(()=>{this.fileInput.click()},10)}componentWillUnmount(){const e=this.dropRef.current;e.removeEventListener("dragenter",this.handleDragIn),e.removeEventListener("dragleave",this.handleDragOut),e.removeEventListener("dragover",this.handleDrag),e.removeEventListener("drop",this.handleDrop)}render(){const{uploadedFilesData:e}=this.state;return Object(i.h)("div",{style:{position:"relative"},ref:this.dropRef},this.state.drag&&Object(i.h)("div",{style:{border:"dashed grey 4px",backgroundColor:"rgba(255,255,255,.8)",position:"absolute",top:0,bottom:0,left:0,right:0,zIndex:9999}},Object(i.h)("div",{style:{position:"absolute",top:"50%",right:0,left:0,textAlign:"center",color:"grey",fontSize:36}},Object(i.h)("div",null,Object(i.h)(l.c,{id:"imageupload.drag-files-here"},"drop your files here :)")))),Object(i.h)("div",null,Object(i.h)("input",{class:"btn btn-info col-sm-12",multiple:!0,type:"file",id:"image-file",onchange:this.handleAddFiles,ref:e=>{this.fileInput=e}})),Object(i.h)("div",null,Object.keys(e).length>0?Object(i.h)("h3",null,Object(i.h)(l.c,{id:"imageupload.upload-images"},"Uploaded images")):"",Object(i.h)("ul",{class:"list-group"},Object.keys(e).map(t=>{const{uploadMeta:s={}}=e[t],a=t.match(/(jpg|jpeg|png|gif|heic|heif|svg|webp|tif)/i);return Object(i.h)("li",{class:"list-group-item list-group-item-action flex-column align-items-start"},Object(i.h)("div",{class:"d-flex w-100 justify-content-between"},a&&Object(i.h)("img",{class:"img-fluid mr-3",src:e[t].event.target.result,style:"max-height: 50px;"}),Object(i.h)("small",null,e[t].event.uploadDone),Object(i.h)(l.c,{id:"imageupload.uploading-image"},"Laster opp bilde..."),Object(i.h)("small",null,d.a.formatBytes(e[t].event.total,2))),Object(i.h)("div",{class:"progress mt-1",style:"height: 4px;"},Object(i.h)("div",{class:"progress-bar progress-bar-striped progress-bar-animated bg-success",role:"progressbar",style:`width: ${s.progress}%; height: 4px;`,"aria-valuenow":s.progress,"aria-valuemin":"0","aria-valuemax":"100"})))}))),this.props.children)}})||a;t.a=n}}]);
//# sourceMappingURL=7.chunk.b8b1b.esm.js.map