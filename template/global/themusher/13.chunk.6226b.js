(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{zYNi:function(e,t,s){"use strict";(function(e){function n(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,n)}return s}function a(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?n(Object(s),!0).forEach((function(t){o(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):n(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function o(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var i,l,c,h,u=s("hosL"),d=(s("QRet"),s("Utv1")),b=s("/eY4"),p=s("OhSV"),m=(s("Y3FI"),s("fh8t")),f=s.n(m),g=(s("go65"),s("HQo+")),O=s("wanP"),j=s("ZQlJ"),y=s("s4FZ"),w=s("q/oJ"),v=s("cH0S"),k=s("fVsX"),x=s("8n2v"),T=s("gWxU"),S=s("Nanz"),C=s("zUny"),R=(s("bbv7"),s("ukv5")),D=(s("eQ6k"),s("e0EM")),M=s("ZOvn"),I=M.a.marginTop(!0,!1),P=(M.a.marginTopBack(!1),M.a.marginBottom(),M.a.subMenuMarginTop(),{isLoading:!1,email:"",submenu:"ads",jwtToken:d.a.getJwtToken(),reloadInSec:null,reloadIsActive:!1,leaderboardMode:"mushers",filterByraceClass:"",showLeaderBoard:!0,showNews:!0}),B=Object(b.a)(i=function(t){function s(e){var s;return(s=t.call(this,e)||this).initComponent=function(){s.setState({reloadIsActive:!0},(function(){return s.tickReloadTimeer()}))},s.tickReloadTimeer=function(){var e=s.props.reloadLastEpoch;if(s.state.reloadIsActive){var t=Math.floor((new Date).getTime()/1e3);s.setState({reloadInSec:60-(t-e)}),clearTimeout(s.updateTimer.tick),s.updateTimer.tick=setTimeout((function(){return s.tickReloadTimeer()}),1e3)}return!1},s.state=a({},P),s.updateTimer={},s}r(s,t);var n=s.prototype;return n.componentDidMount=function(){this.initComponent()},n.componentWillUnmount=function(){clearTimeout(this.updateTimer.tick)},n.render=function(){var t=this.state.reloadInSec,s=this.props,n=s.radius,a=void 0===n?13:n,o=s.fontSize,r=void 0===o?11:o,i=s.classNames,l=void 0===i?"":i,c=Math.floor(d.a.normalizeBetween(t,0,60,0,100));return Object(u.h)(e,null,Object(u.h)("span",{class:l},Object(u.h)(O.a,{key:"gauge-reload-page",color:"primary",radius:a,showPercentText:!1,percent:c,showCenterText:!0,centerText:t,centerTextSize:r,centerTextY:"55%"})))},s}(u.Component))||i,L=Object(b.a)(l=function(t){function s(e){var s;return(s=t.call(this,e)||this).chooseSubmenu=function(e){var t=e.target.closest("button").dataset.submenu;s.setState({submenu:t})},s.state={},s}return r(s,t),s.prototype.render=function(){var t=this,s=this.props.stores,n=s.raceStore.waypoints,a=this.props,o=a.raceClass,r=void 0===o?{}:o,i=a.race,l=void 0===i?{}:i,c=a.onMarkerClick,h=void 0===c?function(){}:c;return Object(u.h)(e,null,Object(u.h)("div",{class:"d-flex justify-content-center align-items-center mb-2"},Object(u.h)("span",{style:"font-size: 1.3em;"},Object(u.h)(p.c,{id:"races.gps-ranking"},"GPS Ranking"),": ",l.title," - ",r.title)),Object(u.h)("div",{class:"w-100 overflow-auto",style:"max-height: 60vh;"},!n||0===n.length&&Object(u.h)(e,null,Object(u.h)("div",{class:"text-center text-muted"},Object(u.h)("div",{class:"display-1"},Object(u.h)("i",{class:"fas fa-dog"})),Object(u.h)("div",{class:"w-100"},Object(u.h)("h3",null,Object(u.h)(p.c,{id:"races.no-teams-found"},"No teams found!")),Object(u.h)(p.c,{id:"races.loading-teams"},"Loading teams...")),Object(u.h)("div",{class:"spinner-border text-primary",style:"width: 3rem; height: 3rem;",role:"status"},Object(u.h)("span",{class:"sr-only"},"Loading...")))),Object(u.h)("table",{class:"table table-sm table-striped"},n&&n.map((function(s,n){var a=d.a.format(s.restTime/s.raceTime*100,0);M.a.displayNameShort(s);return Object(u.h)(e,null,Object(u.h)("tr",{onClick:function(){return h(s)}},Object(u.h)("td",{style:"width: 15px;",class:"text-center"},s.rank),Object(u.h)("td",null,Object(u.h)("div",{class:"d-flex justify-content-between align-items-start w-100"},Object(u.h)("div",{class:"flex-grow-1"},Object(u.h)("div",{class:"float-right ml-2"},Object(u.h)("div",{class:"text-center"},Object(u.h)(O.a,{key:"gauge-reload-page",color:a<40?a<30?"danger":"warning":"success",radius:30,showPercentText:!1,percent:a,showCenterText:!0,centerText:a+"%",centerTextSize:15,centerTextY:"55%"}))),Object(u.h)("div",{class:"float-right"},s.finishTime<9999999999?Object(u.h)(e,null,Object(u.h)("i",{class:"fas fa-flag-checkered text-success"})):Object(u.h)(e,null,"rest"===s.currentState?Object(u.h)(e,null,Object(u.h)("i",{class:"fas fa-bed text-warning"})):Object(u.h)(e,null,Object(u.h)("i",{class:"fas fa-running text-primary"})))),Object(u.h)("span",{class:"text-white rounded-pill-left px-2 mr-2",style:"background-color: "+M.a.getRankingColor(s.rank||n+1)+";"},s.bib),s.flag,"  ",s.title,Object(u.h)("div",null,Object(u.h)("small",null,s.finishTime<9999999999?Object(u.h)(e,null,s.diffToFirstFinishTime>0?Object(u.h)(e,null,Object(u.h)("span",{class:"text-muted"},Object(u.h)("i",{class:"fas fa-arrow-up"}))," ",d.a.secToHms(s.diffToFirstFinishTime)):Object(u.h)(e,null,Object(u.h)("span",{class:"text-muted"},Object(u.h)("i",{class:"fas fa-flag-checkered"}))," ",d.a.formatDate(d.a.parseInputDate(s.finishTime),{locale:"no-NB",hour12:!1,hour:"2-digit",minute:"2-digit"})),Object(u.h)("nobr",null,Object(u.h)("i",{class:"fas fa-running text-muted"})," ",d.a.secToHms(s.raceTime)),Object(u.h)("nobr",null,Object(u.h)("i",{class:"fas fa-bed ml-2 text-muted"})," ",d.a.format(s.restTime/s.raceTime*100,0),"%")):Object(u.h)(e,null,Object(u.h)("nobr",null,Object(u.h)("span",{class:"text-muted"},Object(u.h)("i",{class:"fas fa-flag-checkered"}))," ",d.a.format(s.distanceToFinish,1)," km"),s.distanceToFinish!==s.distanceToFirst&&s.distanceToFirst>0&&Object(u.h)(e,null,Object(u.h)("nobr",null,Object(u.h)("span",{class:"text-muted font-weight-light ml-2"},"1st:")," ",d.a.format(s.distanceToFirst,1)," km")),s.distanceToFinish!==s.distanceToForward&&s.distanceToForward>0&&Object(u.h)(e,null,Object(u.h)("nobr",null,Object(u.h)("span",{class:"text-muted ml-2"},Object(u.h)("i",{class:"fas fa-arrow-up"}))," ",d.a.format(s.distanceToForward,1)," km")),s.distanceToBehind>0&&Object(u.h)(e,null,Object(u.h)("nobr",null,Object(u.h)("span",{class:"text-muted ml-2"},Object(u.h)("i",{class:"fas fa-arrow-down"}))," ",d.a.format(s.distanceToBehind,1)," km")),Object(u.h)("br",null),Object(u.h)("nobr",null,Object(u.h)("span",{class:"text-muted"},Object(u.h)("i",{class:"fas fa-tachometer-alt"}))," ",d.a.format((s.currentAvgSpeed?3.6*s.currentAvgSpeed:s.speed)||0,1)," km/h"),Object(u.h)("nobr",null,Object(u.h)("i",{class:"fas fa-running ml-2 text-muted"})," ",d.a.secToHms(s.raceTime)),Object(u.h)("nobr",null,Object(u.h)("i",{class:"fas fa-bed ml-2 text-muted"})," ",d.a.format(s.restTime/s.raceTime*100,0),"%")))))),Object(u.h)("div",{class:"mt-1 container-fluid"},Object(u.h)(R.a,{stores:t.props.stores,states:s.states,duration:s.raceTime,key:"state-"+s.bib,height:"6px",showText:!1})))))})))))},s}(u.Component))||l,H=Object(b.a)(c=function(t){function s(e){var s;return(s=t.call(this,e)||this).toggleAdminInfo=function(e){e.stopPropagation(),s.setState({showAdminInfo:!s.state.showAdminInfo})},s.toggleInfo=function(e){e.stopPropagation(),s.setState({showInfo:!s.state.showInfo})},s.onDogClick=function(e,t,n){e.preventDefault(),e.stopPropagation();var a=n.find((function(e){return e.uuidv4===t}));return s.setState({currentDog:a,showDog:t,dogs:n}),!1},s.chooseSubmenu=function(e){var t=e.target.closest("button").dataset.submenu;s.setState({submenu:t})},s.state={},s}return r(s,t),s.prototype.render=function(){for(var t=this.props.stores,s=t.raceStore,n=t.userStore,a=this.state,o=a.showAdminInfo,r=a.submenu,i=void 0===r?"details":r,l=a.showDog,c=a.currentDog,h=void 0===c?{}:c,b=this.props,m=b.wpData,g=void 0===m?{}:m,O=b.onMarkerClick,w=void 0===O?function(){}:O,v=s.findWaypointByBib(g.bib),k=n.isAdmin,x=n.user,T=void 0===x?{}:x,S=(g.bib?s.getMusherByBibId(g.bib):s.getMusherByBibEmail(g.email))||{},C=s.getTeamById(S.team),R=C.members?C.members.find((function(e){return e.email===S.email})):{},I=(s.getClassByBib(g.bib),s.getTotalsByTeamId(S.team)),P=M.a.getImage({user:R,team:C,priority:"user",fallback:S.image1}),B=M.a.displayNameShort(R)||M.a.displayNameShort(S),L=M.a.getRankingColor(v.rank),H=M.a.hasBirthday(h.birth),N=h.birth?Math.ceil(M.a.daysUntilNextBirthday(h.birth)):365,z=s.findNearestMushers(g.bib),A=z.inFront,F=z.behind,E=(d.a.format(v.restTime/v.raceTime*100,0),C&&C.imageHeader&&C.imageHeader.s3XXLargeLink?C.imageHeader:{s3XXLargeLink:S.topImage1||"./assets/homerun-race-logo.png"}),W=C&&C.images?[].concat(C.images):[],J=0;J<3;J+=1)S["image"+J]&&W.push({s3SmallLink:S["image"+J],s3LargeLink:S["image"+J]});C.members&&C.members.indexOf(T.id),C.followers&&C.followers.indexOf(T.id),C.followRequests&&C.followRequests.findIndex((function(e){return e.id===T.id})),Math.floor((new Date).getTime()/1e3);return Object(u.h)(e,null,F.bib&&Object(u.h)("button",{class:"btn btn-link text-primary mx-2 py-0 float-right",onClick:function(){return w(F)},style:"line-height: 1.0em; font-size: 2.0em;"},Object(u.h)("i",{class:"fas fa-angle-right"})),A.bib&&Object(u.h)("button",{class:"btn btn-link text-primary mx-2 py-0 float-right",onClick:function(){return w(A)},style:"line-height: 1.0em; font-size: 2.0em;"},Object(u.h)("i",{class:"fas fa-angle-left"})),Object(u.h)("div",{class:"d-flex justify-content-center align-items-center mb-2"},Object(u.h)("span",{style:"font-size: 1.3em; height: 16vh;"}," ")),Object(u.h)("div",{class:"w-100 overflow-auto",style:"max-height: 55vh;"},Object(u.h)("div",{class:"w-100 position-absolute",style:"z-index: -1; height: 18vh; top: 0px; left: 0px; background-size: cover; background-repeat: no-repeat; background-position: 50% 30%; background-color: #a0a0a0; "+(E?'background-image: url("'+E.s3XXLargeLink+'");':"")}),Object(u.h)("div",{class:"d-flex position-relative"},Object(u.h)("div",{class:"position-relative text-center border rounded-circle imageRounded imageRoundedMedium",style:P?'background-image: url("'+P+'"); background-size: cover;':""},!P&&Object(u.h)("div",{class:"text-muted",style:"font-size: 25px; padding-top: 5px;"},B),Object(u.h)("div",{class:"rounded-pill-both px-2 text-center position-absolute "+(L?"":"bg-secondary")+" font-weight-bold",style:"bottom: -20px; right: 0; "+(L?"background-color: "+L+";":"")},S.bib&&"n/a"!==S.bib&&Object(u.h)(e,null,S.bib))),Object(u.h)("div",{class:"flex-grow-1 pl-3 text-overflow mb-3",style:"line-height: 1.8em;"},Object(u.h)("div",{class:"float-right",style:"font-size: 1.2em;"},v.finishTime<9999999999?Object(u.h)(e,null,Object(u.h)("i",{class:"fas fa-flag-checkered text-success"})):Object(u.h)(e,null,"rest"===v.currentState?Object(u.h)(e,null,Object(u.h)("i",{class:"fas fa-bed text-warning"})):Object(u.h)(e,null,Object(u.h)("i",{class:"fas fa-running text-primary"})))),Object(u.h)("h3",{class:"mb-0"},S.flag," ",S.firstname," ",S.lastname),Object(u.h)("h6",{class:"mb-0"},S.sportsClub||Object(u.h)(e,null," ")))),Object(u.h)("div",{class:"d-flex justify-content-center mb-3"},Object(u.h)("div",{class:"col px-0 pt-2"},Object(u.h)("button",{type:"button",class:"btn btn-block rounded-pill-left rounded-none "+("details"===i?"btn-primary":"btn-outline-primary")+" text-nowrap",style:"text-overflow: ellipsis; overflow: hidden;",onClick:this.chooseSubmenu,"data-submenu":"details"},"Details")),Object(u.h)("div",{class:"col px-0 pt-2"},Object(u.h)("button",{type:"button",class:"btn btn-block rounded-none "+("team"===i?"btn-primary":"btn-outline-primary")+" text-nowrap",style:"text-overflow: ellipsis; overflow: hidden;",onClick:this.chooseSubmenu,"data-submenu":"team"},"Team")),Object(u.h)("div",{class:"col px-0 pt-2"},Object(u.h)("button",{type:"button",class:"btn btn-block rounded-pill-right rounded-none "+("dogs"===i?"btn-primary":"btn-outline-primary")+" text-nowrap",style:"text-overflow: ellipsis; overflow: hidden;",onClick:this.chooseSubmenu,"data-submenu":"dogs"},"Dogs"))),Object(u.h)("div",{class:"w-100 overflow-auto position-relative"},"details"===i&&Object(u.h)(e,null,Object(u.h)(D.a,{stores:this.props.stores,wp:v,musher:S})),"team"===i&&Object(u.h)(e,null,C.public>0?Object(u.h)(e,null,Object(u.h)("h3",null,C.name),Object(u.h)(f.a,{markdown:M.a.replaceImages(C.description,C.images),markdownOpts:M.a.getMarkdownOptions()}),Object(u.h)(y.a,{stores:this.props.stores,images:W})):Object(u.h)(e,null,Object(u.h)("div",{class:"text-center text-muted"},Object(u.h)("div",{class:"display-1"},Object(u.h)("i",{class:"fas fa-dog"})),Object(u.h)("h3",null,Object(u.h)(p.c,{id:"teams.no-public-team"},"No public team!")),Object(u.h)(p.c,{id:"teams.no-public-team"},"This team is not publicly visible."),W&&Object(u.h)("div",{class:"my-3"},Object(u.h)(y.a,{stores:this.props.stores,images:W}))))),"dogs"===i&&Object(u.h)(e,null,C.public>0?Object(u.h)(e,null,C.dogs&&Object(u.h)("div",{class:"w-100 container-fluid"},Object(u.h)("div",{class:"row pt-2"},Object(u.h)(j.a,{stores:this.props.stores,dogs:C.dogs.map((function(e){return e.id})),allDogs:C.dogs,onDogClick:this.onDogClick}))),l&&Object(u.h)(e,null,Object(u.h)("div",{class:"d-flex mb-0 mt-3 position-relative"},Object(u.h)("div",{class:"text-center border rounded-circle imageRounded imageRoundedLarge text-muted pt-2",style:h.image?'background-image: url("'+h.image.s3LargeLink+'"); background-size: cover;':""},!h.image&&Object(u.h)("span",{class:"font-weight-lighter",style:"font-size: 35px;"},d.a.ucfirst(h.name,!0))),Object(u.h)("div",{class:"flex-grow-1 pl-3 pr-2",style:"border-right: 4px solid "+n.findHarness(h.harness,"colorNonstop")+" !important; line-height: 1.2em;"},Object(u.h)("h5",{class:"mb-1"},h.shortname||h.name," ",h.shortname&&""!==h.shortname&&Object(u.h)(e,null," - ",Object(u.h)("span",{class:"font-weight-lighter"},h.name)),H&&Object(u.h)(e,null,Object(u.h)("i",{class:"fas fa-birthday-cake ml-3"}))),Object(u.h)("div",null,N<7&&Object(u.h)(e,null,Object(u.h)("span",{class:"text-muted mr-2"},Object(u.h)("i",{class:"fas fa-birthday-cake"})," in ",N," days")),h.birth&&Object(u.h)("span",{class:"mr-2"},d.a.age(h.birth,h.deceased)),"female"===h.gender?Object(u.h)("i",{class:"fas fa-venus"}):Object(u.h)("i",{class:"fas fa-mars"})))))):Object(u.h)(e,null,Object(u.h)("div",{class:"text-center text-muted"},Object(u.h)("div",{class:"display-1"},Object(u.h)("i",{class:"fas fa-dog"})),Object(u.h)("h3",null,Object(u.h)(p.c,{id:"teams.no-public-team"},"No public team!")),Object(u.h)(p.c,{id:"teams.no-public-team"},"This team is not publicly visible.")))),k&&Object(u.h)("div",{style:"max-height: 200px; max-width: 70vw; overflow: auto;"},Object(u.h)("button",{class:"btn btn-link btn-block",onClick:this.toggleAdminInfo},"Toggle admin info"),o&&Object(u.h)(e,null,Object(u.h)("small",null,Object(u.h)("xmp",null,"musher: ",JSON.stringify(S,null,4),Object(u.h)("br",null),"user: ",JSON.stringify(R,null,4),Object(u.h)("br",null),"team: ",JSON.stringify(C,null,4),Object(u.h)("br",null),"totals: ",JSON.stringify(I,null,4),Object(u.h)("br",null))))))))},s}(u.Component))||c,N=Object(b.a)(h=function(t){function s(e){var s;return(s=t.call(this,e)||this).handleHistoryPointIndex=function(e){var t=parseInt(e.target.value,10);clearTimeout(s.updateTimer.reload),s.setState({historyPointIndex:t,timerRunning:!1},(function(){s.props.stores.raceStore.updateWaypointPosition(Math.abs(s.state.historyPointIndex))}))},s.playHistory=function(){clearTimeout(s.updateTimer.reload);var e=s.state,t=e.historyPointIndex,n=e.replaySpeed,o=s.props.stores.raceStore,r=o.getRaceTrackerTimestamp(t+1),i={historyPointIndex:t+1,timerRunning:!1,playingHistory:!0};r&&(i.raceTrackerPointTimestamp=r),s.setState(a({},i),(function(){o.updateWaypointPosition(Math.abs(t+1))})),clearTimeout(s.updateTimer.history),s.updateTimer.history=setTimeout((function(){s.playHistory()}),1e3*n)},s.pauseHistory=function(){clearTimeout(s.updateTimer.history),s.setState({playingHistory:!1})},s.loadLiveRaceResults=function(e,t){return new Promise((function(n,a){var o,r,i,l,c,h,u,d,b,p,m,f,g,O;return void 0===e&&(e=s.props),o=t.teamIds,r=t.focusOnMushers,i=t.bibs,c=t.historySteps,d=(h=e.stores).userStore,b=(u=h.raceStore).race,(p=s.state).historyPointIndex,m=p.replayHistory,f=p.timerRunning,g=s.props.showDrawerReplay,O=u.getClassById(l=t.classid)||{},Promise.resolve(u.getRaceTrackerData(b.raceTrackerRace,{historySteps:c,history:m||g,bibs:i,classid:l,startDate:O.startDate,endDate:O.endDate,isAdmin:d.isAdmin})).then((function(){try{return u.getRaceTrackerActiveTeams(o,r,i),f&&(clearTimeout(s.updateTimer.reload),s.updateTimer.reload=setTimeout((function(){console.log("loadLiveRaceResults.reloading...");var e=Math.floor((new Date).getTime()/1e3);s.setState({reloadLastEpoch:e}),s.loadLiveRaceResults(s.props,{teamIds:o,focusOnMushers:r,bibs:i,classid:l,historySteps:c})}),6e4)),n()}catch(e){return a(e)}}),a)}))},s.loadRaceResults=function(e,t,n){return new Promise((function(a,o){var r,i;return void 0===e&&(e=s.props),r=e.stores.raceStore,i=s.state.timerRunning,Promise.resolve(r.loadWorkoutSummary(t,e.raceid)).then((function(){try{return r.getWorkoutSummaryActiveTeams(t,n),i&&(clearTimeout(s.updateTimer.reload),s.updateTimer.reload=setTimeout((function(){var e=Math.floor((new Date).getTime()/1e3);s.setState({reloadLastEpoch:e}),s.loadRaceResults(s.props,t,n)}),6e4)),a()}catch(e){return o(e)}}),o)}))},s.loadRace=function(e){return new Promise((function(t,n){var a,o,r,i,l,c,h,u,d,b,p,m,f,g,O;void 0===e&&(e=s.props);var j=function(){try{return t()}catch(e){return n(e)}},y=function(e){try{return console.log(e),j()}catch(e){return n(e)}};try{return s.setState({isLoading:!0}),o=(a=e.stores).raceStore,r=a.appState,l=(i=e).classid,c=i.filterByBibs,h=i.historySteps,Promise.resolve(o.load(i.raceid)).then(function(){try{if(o.getAllClassesSortedBy(),d=r.focusOnMushers,p=void 0===(b=r.selectedClassIds)?[]:b,-1===(m=null==(u=o.race)?void 0:u.classes.map((function(e){return e.id}))).indexOf(f=l||p[0])&&r.setSelectedClassId(f=m[0]),l&&r.toggleSelectedClassId(l,!0),g=u.classes.filter((function(e){return e.id===f})).filter((function(e){return e.contestants&&e.contestants.length>0})).map((function(e){return e.contestants.filter((function(e){return e.team>0})).map((function(e){return e.team}))})).flat(),O=c||u.classes.filter((function(e){return e.id===f})).filter((function(e){return e.contestants&&e.contestants.length>0})).map((function(e){return e.contestants.filter((function(e){return e.bib>0})).map((function(e){return e.bib}))})).flat(),g.length>0)return Promise.resolve(o.loadTeams(g.join(","),!1,!0,!0)).then(function(){try{return e.call(this)}catch(e){return y(e)}}.bind(this),y);function e(){function e(){return s.setState({isLoading:!1}),j()}return u.liveRace>0?Promise.resolve(s.loadLiveRaceResults(s.props,{teamIds:g,focusOnMushers:d,bibs:O,classid:f,historySteps:h})).then(function(){try{return e.call(this)}catch(e){return y(e)}}.bind(this),y):Promise.resolve(s.loadRaceResults(s.props,g,d)).then(function(){try{return e.call(this)}catch(e){return y(e)}}.bind(this),y)}return e.call(this)}catch(e){return y(e)}}.bind(this),y)}catch(e){y(e)}}))},s.setLeaderboardMode=function(e){s.setState({leaderboardMode:e.target.parentElement.dataset.mode||e.target.dataset.mode})},s.chooseRaceClass=function(e){s.setState({filterByraceClass:e.target.value})},s.toggleShowLeaderBoard=function(e){s.setState(!0===e?{showLeaderBoard:!1}:{showLeaderBoard:!s.state.showLeaderBoard})},s.toggleShowNews=function(e){s.setState(!0===e?{showNews:!1}:{showNews:!s.state.showNews})},s.closeAllDrawers=function(){s.setState({showResults:!1,showDrawerCheckpoint:!1,showDrawerMusher:!1})},s.onMarkerClick=function(e){s.closeAllDrawers(),s.setState({showDrawerMusher:!0,wpData:e})},s.onMusherClick=function(e){s.setState({showDrawerMusher:!0,wpData:e})},s.onCpMarkerClick=function(e){if(!e||!e.id)return null;s.closeAllDrawers(),s.setState({selectedCheckpointId:e.id,showDrawerCheckpoint:!0,cpData:e})},s.toggleDrawerMusher=function(){s.setState({showDrawerMusher:!s.state.showDrawerMusher})},s.toggleDrawerCheckpoint=function(){s.setState({showDrawerCheckpoint:!s.state.showDrawerCheckpoint})},s.toggleResults=function(){var e=s.state.showResults;s.closeAllDrawers(),s.setState({showResults:!e})},s.selectCheckpoint=function(e){s.closeAllDrawers(),s.setState({selectedCheckpointId:e,showDrawerCheckpoint:!0,showDrawerMusher:!1,showDrawer:!1})},s.onTeamClick=function(e,t){return e.preventDefault(),e.stopPropagation(),s.setState({showTeam:t}),!1},s.hideTeam=function(){s.setState({showTeam:null})},s.onUserClick=function(e){return e.preventDefault(),e.stopPropagation(),!1},s.onDogClick=function(e,t,n){return e.preventDefault(),e.stopPropagation(),s.setState({showDog:t,dogs:n}),!1},s.hideDog=function(){s.setState({showDog:null})},s.setReplaySpeed=function(e){var t=e.target.closest("button").dataset.speed;s.setState({replaySpeed:parseFloat(t)})},s.filterByClass=function(e){return new Promise((function(t,n){var a,o,r,i,l,c,h,u,d,b,p,m=function(){try{return t()}catch(e){return n(e)}},f=function(e){try{return console.log(e),m()}catch(e){return n(e)}};try{if(a=e.target.closest("button").dataset.id,r=(o=s.props).historySteps,i=o.filterByBibs,(s.state.replayHistory||o.showDrawerReplay)&&s.toggleReplayHistory(),c=(l=s.props.stores).appState,(h=l.raceStore).cleanupMemoryClass(),c.toggleSelectedClassId(a,!0),d=c.focusOnMushers,b=(u=h.race).classes.filter((function(e){return e.id===a})).filter((function(e){return e.contestants&&e.contestants.length>0})).map((function(e){return e.contestants.filter((function(e){return e.team>0})).map((function(e){return e.team}))})).flat(),p=i||u.classes.filter((function(e){return e.id===a})).filter((function(e){return e.contestants&&e.contestants.length>0})).map((function(e){return e.contestants.filter((function(e){return e.bib>0})).map((function(e){return e.bib}))})).flat(),s.setState({allTeamIds:b,bibs:p,selectedMusherBib:"",showDrawerCheckpoint:!1,showDrawerMusher:!1,showDrawer:!1}),b.length>0)return Promise.resolve(h.loadTeams(b.join(","),!1,!0,!0)).then(function(){try{return g.call(this)}catch(e){return f(e)}}.bind(this),f);function g(){function e(){return m()}return u.liveRace>0?Promise.resolve(s.loadLiveRaceResults(s.props,{teamIds:b,focusOnMushers:d,bibs:p,classid:a,historySteps:r})).then(function(){try{return e.call(this)}catch(e){return f(e)}}.bind(this),f):Promise.resolve(s.loadRaceResults(s.props,b,d)).then(function(){try{return e.call(this)}catch(e){return f(e)}}.bind(this),f)}return g.call(this)}catch(e){f(e)}}))},s.toggleFocusOnMusher=function(e){try{var t=s.props.stores,n=t.appState,a=t.raceStore;n.toggleFocusOnMusher(e.target.parentElement.dataset.musherid||e.target.dataset.musherid);var o=n.focusOnMushers,r=void 0===o?[]:o,i=n.selectedClassIds,l=(void 0===i?[]:i)[0],c=a.race,h=c.classes.filter((function(e){return e.id===l})).filter((function(e){return e.contestants&&e.contestants.length>0})).map((function(e){return e.contestants.filter((function(e){return e.bib>0})).map((function(e){return e.bib}))})).flat();c.liveRace>0?a.getRaceTrackerActiveTeams(null,r,h):a.getWorkoutSummaryActiveTeams(null,r,h)}catch(e){console.log(e)}},s.toggleBib=function(){try{var e=s.props.stores,t=e.appState,n=e.raceStore.getMusherByBibId(s.state.bib);t.toggleFocusOnMusher(n.id)}catch(e){console.log(e)}},s.checkForEnter=function(e){"Enter"===e.key&&s.toggleBib()},s.toggleReplayHistory=function(){var e=s.state.replayHistory;clearTimeout(s.updateTimer.reload),s.setState({showDrawer:!1,historyPointIndex:0,replayHistory:!e,timerRunning:e},(function(){return new Promise((function(t,n){var a,o,r,i;return Promise.resolve(s.loadRace()).then((function(){try{if(a=s.state.historyPointIndex,r=(o=s.props.stores.raceStore).maxPoints,e)console.log("toggleReplayHistory: setting to maxPoints",r),o.updateWaypointPosition(Math.abs(r-1));else for(console.log("toggleReplayHistory: setting to first points"),i=0,10;i<10;i+=1)o.updateWaypointPosition(Math.abs(a+i));return t()}catch(e){return n(e)}}),n)}))}))},s.toggleLines=function(){s.setState({showLines:!s.state.showLines})},s.state=a(a({},P),{},{reloadLastEpoch:Math.floor((new Date).getTime()/1e3),historyPointIndex:0,timerRunning:!0,replayHistory:!1,replaySpeed:1}),s.updateTimer={},s}r(s,t);var n=s.prototype;return n.componentWillUnmount=function(){clearTimeout(this.updateTimer.reload),clearTimeout(this.updateTimer.history),clearTimeout(this.updateTimer.tick)},n.componentDidMount=function(){this.loadRace();try{var e={width:(t=window).innerWidth,height:t.innerHeight};e.width<800&&(this.toggleShowLeaderBoard(!0),this.toggleShowNews(!0))}catch(e){console.log(e)}var t},n.componentWillReceiveProps=function(e){this.props.classid===e.classid&&this.props.showDrawerReplay===e.showDrawerReplay||this.loadRace(e)},n.render=function(){var t=this,s=this.state,n=s.historyPointIndex,a=s.timerRunning,o=s.playingHistory,r=s.replaySpeed,i=s.raceTrackerPointTimestamp,l=s.showLines,c=s.allTeamIds,h=this.props.stores,b=h.userStore,p=h.raceStore,m=h.appState,O=b.user,j=void 0===O?{}:O,y=b.isAdmin,R=this.props,D=R.raceid,P=R.showHeader,N=void 0===P||P,z=R.drawerClassNames,A=R.drawerWidth,F=R.showDrawerReplay,E=R.largeMarkers,W=R.isAnimatedMarkers,J=R.linkBase,U=void 0===J?"/app-races/":J,X=m.focusOnMushers,Y=void 0===X?[]:X,q=m.selectedClassIds,Q=void 0===q?[]:q,_=this.state,G=_.reloadLastEpoch,Z=_.showDrawerMusher,V=_.showDrawerCheckpoint,K=_.wpData,$=void 0===K?{}:K,ee=_.showResults,te=_.showTeam,se=_.showDog,ne=_.replayHistory,ae=_.selectedCheckpointId,oe=p.waypoints,re=p.geoJSONs,ie=p.zoomToMarkers,le=p.race,ce=p.maxPoints,he=$.bib?p.getMusherByBibId($.bib):p.getMusherByBibEmail($.email),ue=p.getTeamById(he.team),de=p.getClassById(Q[0])||{},be=[];de.waypoints&&de.waypoints.length>0?be=de.waypoints:de.checkpoints&&de.checkpoints.length>0&&(be=de.checkpoints.slice().filter((function(e){return e.position&&e.position[0]})).map((function(e){return{id:e.id,title:e.name,lat:e.position[0],lng:e.position[1]}})));var pe=!0;le.countryRegexp&&(j&&j.currentLocationGeocode&&new RegExp(le.countryRegexp,"i").test(j.currentLocationGeocode.formattedCountry)&&(pe=!1));return Object(u.h)(e,null,te&&Object(u.h)(w.a,null,Object(u.h)(T.default,{stores:this.props.stores,teamid:te,marginTop:"0px;",marginBottom:"0px;",back:this.hideTeam,hideTeam:this.hideTeam})),se&&Object(u.h)(w.a,null,Object(u.h)(S.default,{stores:this.props.stores,dogid:se,marginTop:"0px;",marginBottom:"0px;",back:this.hideDog,dogs:ue.dogs})),N&&Object(u.h)(k.a,{height:I},Object(u.h)("div",{class:"d-flex justify-content-between align-items-center w-100"},Object(u.h)("div",{class:"d-flex align-items-center"},Object(u.h)("span",{class:"",style:"font-size: 2.3em;"},Object(u.h)("a",{href:""+U+le.id},Object(u.h)("i",{class:"fas fa-angle-left"}))),Object(u.h)("span",{class:"ml-4 text-primary",style:"font-size: 1.4em;",onClick:this.toggleResults},Object(u.h)("i",{class:"fas fa-list-ol"})),Object(u.h)("span",{class:"ml-4 text-primary",style:"font-size: 1.4em;"},!le.resultsHide&&Object(u.h)("a",{href:""+U+le.id+"/results"},Object(u.h)("i",{class:"fas fa-stopwatch"})))),Object(u.h)("div",null,Object(u.h)("span",{class:"font-weight-normal text-white",style:"font-size: 1.2em;"},le.title)),le.liveRace>0?Object(u.h)(e,null,Object(u.h)("div",{class:"d-flex align-items-center text-primary",onClick:this.toggleReplayHistory},Object(u.h)("span",{class:""},"Replay"),Object(u.h)("span",{class:"ml-2",style:"font-size: 1.4em;"},Object(u.h)("i",{class:"fas fa-play"})))):Object(u.h)(e,null,Object(u.h)("div",{class:"d-flex align-items-center"}," "))),Object(u.h)("div",{class:"w-100 overflow-hidden"},Object(u.h)("div",{class:"d-flex flex-row flex-nowrap pb-2 px-1",style:"overflow: auto; scroll-snap-type: x mandatory;"},le.classes&&le.classes.map((function(s,n){return Object(u.h)(e,null,Object(u.h)("div",{class:"col px-0 pt-0"},Object(u.h)("button",{type:"button",class:"btn btn-block "+M.a.getPillClass(le.classes.length,n)+" rounded-none "+(Q.indexOf(s.id)>-1?"btn-primary":"btn-outline-primary")+" text-nowrap",style:"text-overflow: ellipsis; overflow: hidden;",onClick:t.filterByClass,"data-id":s.id},s.title)))}))))),pe?Object(u.h)(e,null,Object(u.h)("div",{class:"container-fluid position-relative p-0 w-100 h-100",style:"margin-top: "+(N?I:0)+";"},le.id?Object(u.h)(e,null,Object(u.h)(g.a,{marginTop:I,stores:this.props.stores,raceid:D,waypoints:oe,geoJSONs:l?re:null,waypoints2:be,zoomToMarkers:ie,fullscreenMap:!0,onMarkerClick:this.onMarkerClick,onMarker2Click:this.onCpMarkerClick,showHeatmap:le.liveRace<1,allTeamIds:c,showTracks:le.liveRace>=1,selectedClassIds:Q,showDistanceMarkers:!1,groupWaypoints:!1,focusOnMushers:Y,largeMarkers:E,isAnimatedMarkers:W,replaySpeed:1e3*r})):Object(u.h)(e,null,Object(u.h)(x.a,{stores:this.props.stores})),a&&Object(u.h)("div",{class:"position-absolute",style:"top: 125px; left: 5px; z-index: 9999; width: 30px; height: 30px;"},Object(u.h)(B,{stores:this.props.stores,classNames:"float-right ml-2",reloadLastEpoch:G})),Y&&Y.length>0&&Object(u.h)(e,null,Object(u.h)("div",{class:"row mb-2",style:' background-color: #1C1F4C; background-image: url("https://themusher.app/assets/tv-single-background.jpg"); background-size: cover !important; background-position: 0 0; border-radius: 10px; '},Object(u.h)("div",{class:"col-12 text-white",style:"font-size: 1.3em;"},Y&&Y.map((function(s){var n=p.getMusherById(s);return Object(u.h)(e,null,Object(u.h)("div",null,Object(u.h)("nobr",null,Object(u.h)("span",{class:"mr-2",onClick:t.toggleFocusOnMusher,"data-musherid":n.id},Y.indexOf(n.id)>-1?Object(u.h)("i",{class:"fas fa-times text-warning"}):Object(u.h)("i",{class:"far fa-star"})),Object(u.h)("span",{class:"text-right",style:"width: 50px; display: inline-block;"},n.bib)," ",n.flag," ",n.firstname," ",n.lastname,Object(u.h)("br",null))))}))))),le.mapCredits&&Object(u.h)(e,null,Object(u.h)("div",{class:"position-absolute",style:"bottom: 30px; left: 7px; z-index: 9999; width: 100px; height: 40px;"},Object(u.h)(f.a,{markdown:M.a.replaceImages(le.mapCredits,le.images),markdownOpts:M.a.getMarkdownOptions()}))),(F||ne)&&Object(u.h)(e,null,Object(u.h)(v.a,{stores:this.props.stores,onCloseClick:this.toggleReplayHistory,classNames:z,width:A},ce>0?Object(u.h)(e,null,Object(u.h)("div",{class:"d-flex justify-content-center mx-3"},o?Object(u.h)(e,null,Object(u.h)("div",{class:"pl-1"},Object(u.h)("button",{class:"btn btn-warning",onClick:this.pauseHistory},Object(u.h)("i",{class:"fas fa-pause"})))):Object(u.h)(e,null,Object(u.h)("div",{class:"pl-1"},Object(u.h)("button",{class:"btn btn-success",onClick:this.playHistory},Object(u.h)("i",{class:"fas fa-play"})))),Object(u.h)("div",{class:"pl-2 pt-2 flex-grow-1"},Object(u.h)("input",{type:"range",class:"custom-range w-100",min:0,max:ce,value:n,onInput:this.handleHistoryPointIndex}))),Object(u.h)("div",{class:"d-flex justify-content-center"},Object(u.h)("div",{class:"col px-0 pt-2"},Object(u.h)("button",{type:"button",class:"btn btn-block rounded-pill-left rounded-none "+(1===r?"btn-secondary":"btn-outline-secondary")+" text-nowrap",style:"text-overflow: ellipsis; overflow: hidden;",onClick:this.setReplaySpeed,"data-speed":1},"60x")),Object(u.h)("div",{class:"col px-0 pt-2"},Object(u.h)("button",{type:"button",class:"btn btn-block rounded-none "+(.5===r?"btn-secondary":"btn-outline-secondary")+" text-nowrap",style:"text-overflow: ellipsis; overflow: hidden;",onClick:this.setReplaySpeed,"data-speed":.5},"120x")),Object(u.h)("div",{class:"col px-0 pt-2"},Object(u.h)("button",{type:"button",class:"btn btn-block rounded-none "+(.25===r?"btn-secondary":"btn-outline-secondary")+" text-nowrap",style:"text-overflow: ellipsis; overflow: hidden;",onClick:this.setReplaySpeed,"data-speed":.25},"240x")),Object(u.h)("div",{class:"col px-0 pt-2"},Object(u.h)("button",{type:"button",class:"btn btn-block right rounded-none "+(.12===r?"btn-secondary":"btn-outline-secondary")+" text-nowrap",style:"text-overflow: ellipsis; overflow: hidden;",onClick:this.setReplaySpeed,"data-speed":.12},"480x")),Object(u.h)("div",{class:"col px-0 pt-2"},Object(u.h)("button",{type:"button",class:"btn btn-block rounded-pill-right rounded-none "+(.05===r?"btn-secondary":"btn-outline-secondary")+" text-nowrap",style:"text-overflow: ellipsis; overflow: hidden;",onClick:this.setReplaySpeed,"data-speed":.05},"1000x"))),Object(u.h)("div",{class:"d-flex justify-content-center"},Object(u.h)("div",{class:"flex-grow-1 pt-0 font-weight-bolder text-center",style:"font-size: 1.1em;"},i&&Object(u.h)(e,null,d.a.formatDate(d.a.parseInputDate(i),{locale:"no-NB",hour12:!1,hour:"2-digit",minute:"2-digit"})),y&&Object(u.h)(e,null,"/ ",n)),y&&Object(u.h)(e,null,Object(u.h)("button",{class:"btn btn-danger mt-2 mr-4 rounded-pill-both rounded-none",onClick:this.toggleLines},Object(u.h)("i",{class:"fas fa-wave-square"})," Show lines")))):Object(u.h)(e,null,Object(u.h)("div",{class:"spinner-border text-primary",role:"status"},Object(u.h)("span",{class:"sr-only"},"Loading..."))))),ee&&Object(u.h)(e,null,Object(u.h)(v.a,{stores:this.props.stores,onCloseClick:this.toggleResults,classNames:z,width:A},Object(u.h)(L,{stores:this.props.stores,raceClass:de,race:le,onMarkerClick:this.onMusherClick}))),Z&&Object(u.h)(e,null,Object(u.h)(v.a,{stores:this.props.stores,onCloseClick:this.toggleDrawerMusher,classNames:z,width:A},Object(u.h)(H,{stores:this.props.stores,wpData:$,onMarkerClick:this.onMarkerClick,onTeamClick:this.onTeamClick,onUserClick:this.onUserClick,onDogClick:this.onDogClick}))),V&&Object(u.h)(e,null,Object(u.h)(v.a,{stores:this.props.stores,onCloseClick:this.toggleDrawerCheckpoint},Object(u.h)(C.a,{stores:this.props.stores,id:ae,onClickNav:this.selectCheckpoint}))))):Object(u.h)(e,null,Object(u.h)("div",{class:"container-fluid position-relative p-0 w-100 h-100",style:"margin-top: "+(N?I:0)+";"},Object(u.h)("div",{class:"text-center text-muted"},Object(u.h)("div",{class:"display-1"},Object(u.h)("i",{class:"fas fa-hand-paper"})),Object(u.h)("h3",null,"Not allowed to view tracking"),le.countryRegexpMessage))))},s}(u.Component))||h;t.a=N}).call(this,s("hosL").Fragment)}}]);
//# sourceMappingURL=13.chunk.6226b.js.map