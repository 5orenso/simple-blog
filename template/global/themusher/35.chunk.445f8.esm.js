(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{LOkn:function(e,t,s){"use strict";function a(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function i(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?a(Object(s),!0).forEach((function(t){r(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):a(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function r(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}s.r(t);var n,d,o,l=s("hosL"),c=(s("Utv1"),s("/eY4")),h=(s("cneo"),s("OhSV")),p=s("Y3FI"),u=(s("go65"),s("ZOvn")),b=s("om2D"),f=s("TiXY");const g=u.a.marginTop(!1),m=u.a.marginTopBack(!1),O=u.a.marginBottom(),v={isLoading:!1};let j=Object(c.a)(n=class extends l.Component{constructor(...e){var t;super(...e),t=this,this.handleImageErrored=e=>{const t=e.target;t.onerror=null,setTimeout(()=>{t.src+="?"+new Date},1e3)},this.removeImage=async function(e){const{newsStore:s}=t.props.stores,{news:a}=t.props;s.removeImage({id:a.id,name:e.target.parentElement.dataset.name||e.target.dataset.name})},this.removeMainImage=()=>{const{news:e,field:t,updateField:s}=this.props;s({id:e.id,field:t,value:{}})}}render(){const{saved:e,news:t,type:s="text",rows:a,field:i,title:r,icon:n,help:d,onInput:o,updateField:c}=this.props,p=t[i];return"image"===s?Object(l.h)("div",{class:"form-group "+(e[`${i}.${t.id}`]?"is-valid":"")},Object(l.h)("label",{for:i+"Input"},n&&Object(l.h)("i",{class:n+" text-muted"})," ",r),Object(l.h)("div",{class:"container-fluid"},Object(l.h)("div",{class:"row"},t.images&&t.images.map(e=>Object(l.h)("div",{class:"col-3 p-1"},Object(l.h)("img",{src:e.s3SmallLink,class:"img-fluid",onError:this.handleImageErrored}),Object(l.h)("button",{class:"btn btn-sm btn-link",onClick:this.removeImage,"data-name":e.name},Object(l.h)("i",{class:"fas fa-trash"})," Del"))))),Object(l.h)(b.a,{saved:e,object:t,field:i,updateField:c,autoOpen:!1}),e[`${i}.${t.id}`]?Object(l.h)("div",{class:"valid-feedback",style:"display: block;"},Object(l.h)(h.c,{id:"news.changes-saved"},"Endringene er lagret")):Object(l.h)("small",{id:i+"Help",class:"form-text text-muted"},d)):"file"===s?Object(l.h)("div",{class:"form-group "+(e[`${i}.${t.id}`]?"is-valid":"")},Object(l.h)("label",{for:i+"Input"},n&&Object(l.h)("i",{class:n+" text-muted"})," ",r),Object(l.h)(f.a,{saved:e,object:t,field:i,updateField:c}),e[`${i}.${t.id}`]?Object(l.h)("div",{class:"valid-feedback",style:"display: block;"},Object(l.h)(h.c,{id:"news.changes-saved"},"Endringene er lagret")):Object(l.h)("small",{id:i+"Help",class:"form-text text-muted"},d)):"textarea"===s?Object(l.h)("div",{class:"form-group "+(e[`${i}.${t.id}`]?"is-valid":"")},Object(l.h)("label",{for:i+"Input"},n&&Object(l.h)("i",{class:n+" text-muted"})," ",r),Object(l.h)("textarea",{type:s,class:"form-control "+(e[`${i}.${t.id}`]?"is-valid":""),id:i+"Input","aria-describedby":i+"Help",value:p,rows:a,"data-id":t.id,"data-field":i,onInput:o}),e[`${i}.${t.id}`]?Object(l.h)("div",{class:"valid-feedback",style:"display: block;"},Object(l.h)(h.c,{id:"news.changes-saved"},"Endringene er lagret")):Object(l.h)("small",{id:i+"Help",class:"form-text text-muted"},d)):Object(l.h)("div",{class:"form-group "+(e[`${i}.${t.id}`]?"is-valid":"")},Object(l.h)("label",{for:i+"Input"},n&&Object(l.h)("i",{class:n+" text-muted"})," ",r),Object(l.h)("input",{type:s,class:"form-control "+(e[`${i}.${t.id}`]?"is-valid":""),id:i+"Input","aria-describedby":i+"Help",value:p,"data-id":t.id,"data-field":i,onInput:o}),e[`${i}.${t.id}`]?Object(l.h)("div",{class:"valid-feedback",style:"display: block;"},Object(l.h)(h.c,{id:"news.changes-saved"},"Endringene er lagret")):Object(l.h)("small",{id:i+"Help",class:"form-text text-muted"},d))}})||n,w=Object(c.a)(d=class extends l.Component{constructor(...e){super(...e),this.onInput=e=>{const{field:t}=this.props,s=e.target.value,{newsStore:a}=this.props.stores;a.updateObjectKeyValue("newNews",t,s)}}render(){const{field:e,icon:t,title:s,help:a}=this.props,{newsStore:i}=this.props.stores,{newNews:r}=i;return Object(l.h)("div",{class:"form-group"},Object(l.h)("label",{for:e+"Input"},t&&Object(l.h)("i",{class:t+" text-muted"})," ",s),Object(l.h)("input",{type:"text",class:"form-control",id:e+"Input","aria-describedby":e+"Help",onInput:this.onInput,value:r[e]}),Object(l.h)("small",{id:e+"Help",class:"form-text text-muted"},a))}})||d,y=Object(c.a)(o=class extends l.Component{constructor(e){var t;super(e),t=this,this.updateField=e=>{const{id:t,field:s,type:a,elementtype:i}=e.target.dataset,r=e.target.value;this.updateFieldValue({id:parseInt(t,10),field:s,value:r,type:a,elementtype:i})},this.updateFieldValue=({id:e,field:s,value:a,datatype:i,elementtype:r,skipTimer:n=!1})=>{const{newsStore:d}=this.props.stores;let o=a,l=a;const{news:c}=d;"images"===s&&Array.isArray(c.images)&&Array.isArray(a)&&(l=[...c.images,...a]),"array"!==i||Array.isArray(a)||(o="number"===r?a.split(",").map(e=>parseFloat(e)||e):a.split(",")),d.updateField(e,s,l),n?this.doUpdateField(e,s,o):(clearTimeout(this.updateTimer[s]),this.updateTimer[s]=setTimeout((async function(){t.doUpdateField(e,s,o)}),500))},this.insertNewNews=async function(){const{newsStore:e}=t.props.stores,{newNews:s}=e;e.insert(i({},s))},this.back=()=>{const{createNew:e}=this.props,{newsStore:t}=this.props.stores,{news:s}=t;e?Object(p.route)("/news/"):Object(p.route)("/news/"+s.id)},this.state=i({},v),this.updateTimer={}}async loadNews(e=this.props){this.setState({isLoading:!0});const{newsStore:t}=this.props.stores;await t.load(e.id)}async doUpdateField(e,t,s){const{newsStore:a}=this.props.stores;await a.saveField(e,t,s)}componentDidMount(){this.loadNews()}render(){const{createNew:e}=this.props,{newsStore:t,userStore:s}=this.props.stores,{isAdmin:a}=s;if(!a)return"";const{news:i,saved:r}=t;return Object(l.h)("div",{class:"container-fluid",style:`margin-bottom: ${O}; margin-top: ${g};`},Object(l.h)("div",{class:"d-flex justify-content-between mb-2"},Object(l.h)("div",null,Object(l.h)("button",{class:"btn btn-link pl-0 fixed-top text-primary",style:`top: ${m}; left: 5px; font-size: 35px; width: 45px;`,onClick:this.back},Object(l.h)("i",{class:"fas fa-arrow-circle-left"}))),Object(l.h)("div",null,Object(l.h)("h5",{class:"text-muted"},"News and howto content")),Object(l.h)("div",null,"Â ")),e?Object(l.h)("div",{class:"row"},Object(l.h)("div",{class:"col-12"},Object(l.h)("h5",null,Object(l.h)(h.c,{id:"news.add-new"},"Lag nytt innhold")),Object(l.h)(w,{stores:this.props.stores,field:"title",icon:"fas fa-heading",title:Object(l.h)(h.c,{id:"news.title"},"Tittel"),help:Object(l.h)(h.c,{id:"news.title-help"},"Title of this news story")}),Object(l.h)(w,{stores:this.props.stores,field:"tag",icon:"fas fa-eye",title:Object(l.h)(h.c,{id:"news.tag"},"Tag"),help:Object(l.h)(h.c,{id:"news.tag-help"},"Tag of this news story"),onInput:this.updateField}),Object(l.h)("button",{type:"button",class:"btn btn-primary mb-2",onclick:this.insertNewNews},"Save news"))):Object(l.h)("div",{class:"row"},Object(l.h)("div",{class:"col-12"},Object(l.h)(j,{saved:r,news:i,field:"title",icon:"fas fa-heading",title:Object(l.h)(h.c,{id:"news.title"},"Title"),help:Object(l.h)(h.c,{id:"news.title-help"},"Title of this news story"),onInput:this.updateField}),Object(l.h)(j,{saved:r,news:i,field:"active",icon:"fas fa-heading",title:Object(l.h)(h.c,{id:"news.active"},"Active"),help:Object(l.h)(h.c,{id:"news.active-help"},"Is this active yet?"),onInput:this.updateField}),Object(l.h)(j,{saved:r,news:i,field:"tag",icon:"fas fa-heading",title:Object(l.h)(h.c,{id:"news.tag"},"Tag"),help:Object(l.h)(h.c,{id:"news.tag-help"},"Tag of this news story"),onInput:this.updateField}),Object(l.h)(j,{saved:r,news:i,field:"ingress",icon:"fas fa-quote-right",type:"textarea",title:Object(l.h)(h.c,{id:"news.ingress"},"Ingress"),help:Object(l.h)(h.c,{id:"news.ingress-help"},"Ingress of this news story"),onInput:this.updateField}),Object(l.h)(j,{saved:r,news:i,field:"body",icon:"fas fa-quote-right",type:"textarea",rows:20,title:Object(l.h)(h.c,{id:"news.body"},"Body"),help:Object(l.h)(h.c,{id:"news.body-help"},"Body of this news story"),onInput:this.updateField}),Object(l.h)(j,{saved:r,news:i,field:"image",type:"image",icon:"fas fa-camera",stores:this.props.stores,title:Object(l.h)(h.c,{id:"news.photo"},"Bilder"),help:Object(l.h)(h.c,{id:"news.photo-help"},"Images for this news story."),onInput:this.updateField,updateField:this.updateFieldValue}))))}})||o;t.default=y},TiXY:function(e,t,s){"use strict";var a,i=s("hosL"),r=s("/eY4"),n=(s("cneo"),s("Utv1"),s("OhSV")),d=s("u2zT");let o=Object(r.a)(a=class extends i.Component{constructor(e){super(e),this.handleAddImage=e=>{const{updateField:t,object:s,field:a}=this.props;t({id:s.id,field:a,value:e})},this.state={files:[]}}render(){const{uploadStatus:e=(()=>{}),before:t=(()=>{}),after:s=(()=>{}),autoOpen:a=!1}=this.props;return Object(i.h)("div",{class:"row"},Object(i.h)("div",{class:"col-12"},Object(i.h)(n.c,{id:"form.files.upload-file"},"Last opp fil"),":",Object(i.h)("br",null),Object(i.h)(d.a,{handleAddImage:this.handleAddImage,apiUrl:"/api/fileupload",uploadStatus:e,before:t,after:s,autoOpen:a},Object(i.h)("div",{style:{height:30,width:"100%"}}))))}})||a;t.a=o},om2D:function(e,t,s){"use strict";var a,i=s("hosL"),r=s("/eY4"),n=(s("cneo"),s("Utv1"),s("u2zT"));let d=Object(r.a)(a=class extends i.Component{constructor(e){super(e),this.handleAddImage=e=>{const{addToImages:t=!0}=this.props,{updateField:s,object:a,field:i}=this.props;if(i&&s({id:a.id,field:i,value:e,skipTimer:!0}),t){const t=[];t.push(e),s({id:a.id,field:"images",value:t,skipTimer:!0})}},this.state={files:[]}}render(){const{uploadStatus:e=(()=>{}),before:t=(()=>{}),after:s=(()=>{}),autoOpen:a=!0}=this.props;return Object(i.h)("div",{class:"row"},Object(i.h)("div",{class:"col-12"},Object(i.h)(n.a,{handleAddImage:this.handleAddImage,uploadStatus:e,apiUrl:"/api/fileupload",before:t,after:s,autoOpen:a},Object(i.h)("div",{style:{height:30,width:"100%"}}))))}})||a;t.a=d},u2zT:function(e,t,s){"use strict";var a,i=s("hosL"),r=s("/eY4"),n=s("Utv1"),d=s("OhSV");let o=Object(r.a)(a=class extends i.Component{constructor(e){super(e),this.dropRef=Object(i.createRef)(),this.handleDrag=e=>{e.preventDefault(),e.stopPropagation()},this.handleDragIn=e=>{e.preventDefault(),e.stopPropagation(),this.dragCounter++,e.dataTransfer.items&&e.dataTransfer.items.length>0&&this.setState({drag:!0})},this.handleDragOut=e=>{e.preventDefault(),e.stopPropagation(),this.dragCounter--,0===this.dragCounter&&this.setState({drag:!1})},this.handleDrop=e=>{if(e.preventDefault(),e.stopPropagation(),this.setState({drag:!1}),e.dataTransfer.files&&e.dataTransfer.files.length>0){for(let t=0,s=e.dataTransfer.files.length;t<s;t+=1){this.readLocalFile(e.dataTransfer.files[t])}this.dragCounter=0}},this.handleAddFiles=e=>{e.preventDefault();const t=e.target;for(let e=0,s=t.files.length;e<s;e+=1){this.readLocalFile(t.files[e])}},this.handleEvent=()=>{0},this.handleUpload=e=>{const{uploadStatus:t=(()=>{}),before:s=(()=>{}),after:a=(()=>{})}=this.props;t(!1),n.a.isFunction(s)&&s();const i=new FormData;i.append("files[]",e);const r={progress:1};r.xhr=new XMLHttpRequest,r.xhr.upload.addEventListener("progress",t=>{this.updateProgress(t,e)}),r.xhr.addEventListener("loadstart",t=>{this.handleEvent(t,e)}),r.xhr.addEventListener("load",t=>{this.handleEvent(t,e)}),r.xhr.addEventListener("loadend",t=>{const s=e;n.a.isFunction(a)&&a(),this.handleEvent(t,s)}),r.xhr.addEventListener("progress",t=>{this.handleEvent(t,e)}),r.xhr.addEventListener("error",t=>{this.handleEvent(t,e)}),r.xhr.addEventListener("abort",t=>{this.handleEvent(t,e)}),r.xhr.addEventListener("readystatechange",t=>{this.uploadDone(t,e)}),r.xhr.open("POST",`${n.a.getApiServer()}${this.props.apiUrl}`),r.xhr.setRequestHeader("Authorization","Bearer "+n.a.getJwtToken()),r.xhr.send(i);const d=e.name,o=this.state.uploadedFilesData;o[d]||(o[d]={}),o[d].uploadMeta=r,o[d].imageNum=this.state.imageNum,this.setState({uploadedFilesData:o})},this.readLocalFile=e=>new Promise((t,s)=>{const a=new FileReader;a.addEventListener("error",e=>{s(e)}),a.addEventListener("load",s=>{const a=e,i=a.name,r=this.state.uploadedFilesData;r[i]||(r[i]={}),r[i].event=s,this.setState({uploadedFilesData:r}),this.handleUpload(a),t(s)}),a.readAsDataURL(e)}),this.updateProgress=(e,t)=>{if(e.lengthComputable){const s=t.name,a=this.state.uploadedFilesData,i=e.loaded/e.total*100;0,a[s].uploadMeta.progress=i,this.setState({uploadedFilesData:a})}},this.uploadDone=(e,t)=>{const s=t.name,a=this.state.uploadedFilesData,i=a[s].uploadMeta;if(i&&4===i.xhr.readyState&&201===i.xhr.status){const e=JSON.parse(i.xhr.responseText).data.files;for(let t=0;t<e.length;t+=1){this.addFileToUpload(e[t]),this.fileInput.value=""}}},this.state={drag:!1,loadingProgress:0,uploadedFiles:[],uploadedFilesData:{}}}addFileToUpload(e){const{uploadedFilesData:t}=this.state,{handleAddImage:s,uploadStatus:a=(()=>{})}=this.props;delete t[e.name],this.setState({uploadedFilesData:t}),s(e),a(!0)}componentDidMount(){const e=this.dropRef.current;e.addEventListener("dragenter",this.handleDragIn),e.addEventListener("dragleave",this.handleDragOut),e.addEventListener("dragover",this.handleDrag),e.addEventListener("drop",this.handleDrop);const{autoOpen:t}=this.props;t&&setTimeout(()=>{this.fileInput.click()},10)}componentWillUnmount(){const e=this.dropRef.current;e.removeEventListener("dragenter",this.handleDragIn),e.removeEventListener("dragleave",this.handleDragOut),e.removeEventListener("dragover",this.handleDrag),e.removeEventListener("drop",this.handleDrop)}render(){const{uploadedFilesData:e}=this.state;return Object(i.h)("div",{style:{position:"relative"},ref:this.dropRef},this.state.drag&&Object(i.h)("div",{style:{border:"dashed grey 4px",backgroundColor:"rgba(255,255,255,.8)",position:"absolute",top:0,bottom:0,left:0,right:0,zIndex:9999}},Object(i.h)("div",{style:{position:"absolute",top:"50%",right:0,left:0,textAlign:"center",color:"grey",fontSize:36}},Object(i.h)("div",null,Object(i.h)(d.c,{id:"imageupload.drag-files-here"},"drop your files here :)")))),Object(i.h)("div",null,Object(i.h)("input",{class:"btn btn-info col-sm-12",multiple:!0,type:"file",id:"image-file",onchange:this.handleAddFiles,ref:e=>{this.fileInput=e}})),Object(i.h)("div",null,Object.keys(e).length>0?Object(i.h)("h3",null,Object(i.h)(d.c,{id:"imageupload.upload-images"},"Uploaded images")):"",Object(i.h)("ul",{class:"list-group"},Object.keys(e).map(t=>{const{uploadMeta:s={}}=e[t],a=t.match(/(jpg|jpeg|png|gif|heic|heif|svg|webp|tif)/i);return Object(i.h)("li",{class:"list-group-item list-group-item-action flex-column align-items-start"},Object(i.h)("div",{class:"d-flex w-100 justify-content-between"},a&&Object(i.h)("img",{class:"img-fluid mr-3",src:e[t].event.target.result,style:"max-height: 50px;"}),Object(i.h)("small",null,e[t].event.uploadDone),Object(i.h)(d.c,{id:"imageupload.uploading-image"},"Laster opp bilde..."),Object(i.h)("small",null,n.a.formatBytes(e[t].event.total,2))),Object(i.h)("div",{class:"progress mt-1",style:"height: 4px;"},Object(i.h)("div",{class:"progress-bar progress-bar-striped progress-bar-animated bg-success",role:"progressbar",style:`width: ${s.progress}%; height: 4px;`,"aria-valuenow":s.progress,"aria-valuemin":"0","aria-valuemax":"100"})))}))),this.props.children)}})||a;t.a=o}}]);
//# sourceMappingURL=35.chunk.445f8.esm.js.map