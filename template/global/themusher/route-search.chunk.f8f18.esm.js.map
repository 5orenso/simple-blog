{"version":3,"sources":["webpack:///./components/team/index.js","webpack:///./routes/search/index.js"],"names":["Team","observer","Component","requestFollowTeam","e","preventDefault","stopPropagation","teamStore","userStore","this","props","stores","user","teamId","parseInt","target","parentElement","dataset","team","followRequest","setState","requestSent","getButton","text","state","skipHome","isYourTeam","members","indexOf","id","isFollowing","followers","isBlocked","blockedFollowers","hasRequestedFollow","followRequests","findIndex","class","type","onClick","unFollowTeam","disabled","data-team","public","render","showButton","currentMonth","Date","getMonth","currentYear","getFullYear","month","year","seasonStart","workoutSummary","findWorkoutSummary","language","teamAmbition","findTeamAmbition","ambition","ambitions","teamType","findTeamType","image","s3SmallLink","url","style","href","name","dogs","length","distanceKm","value","elevation","duration","util","secToHms","speedAvg","initialState","submenu","hits","searchText","Search","constructor","super","loadAll","async","appState","storyStore","search","getSearch","publicTeams","publicUsers","localUpdateField","searchResultStories","searchResultDogs","searchResultWorkouts","searchResultTeams","searchResultTracks","allData","idx","map","a","Math","max","reduce","partialSum","route","chooseSubmenu","menu","componentDidMount","componentWillReceiveProps","nextProps","fields","placeholder","onInput","linkState","data-menu","dog","uuidv4","workout","feed","track","story","key"],"mappings":"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","file":"route-search.chunk.f8f18.esm.js","sourcesContent":["import { h, Component } from 'preact';\nimport util from 'preact-util';\nimport { observer } from 'mobx-preact';\nimport { Text, Localizer } from 'preact-i18n';\n\nimport Speed from '../../components/data/speed';\nimport Elevation from '../../components/data/elevation';\nimport Weight from '../../components/data/weight';\nimport Distance from '../../components/data/distance';\nimport Temperature from '../../components/data/temperature';\n\n@observer\nclass Team extends Component {\n    requestFollowTeam = (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        const { teamStore, userStore } = this.props.stores;\n        const { user } = userStore;\n        const teamId = parseInt(e.target.parentElement.dataset.team || e.target.dataset.team, 10);\n        teamStore.followRequest(teamId, user);\n        this.setState({ requestSent: true });\n    }\n\n    getButton = (text = '') => {\n        const { requestSent } = this.state;\n        const { userStore } = this.props.stores;\n        const { user } = userStore;\n        const { team, skipHome } = this.props;\n        const isYourTeam = team.members && team.members.indexOf(user.id) > -1;\n        const isFollowing = team.followers && team.followers.indexOf(user.id) > -1;\n        const isBlocked = team.blockedFollowers && team.blockedFollowers.indexOf(user.id) > -1;\n        const hasRequestedFollow = requestSent || team.followRequests && team.followRequests.findIndex(e => e.id === user.id) > -1;\n\n        if (isYourTeam) {\n            if (skipHome) {\n                return '';\n            }\n            return (\n                <i class='fas fa-home' />\n            );\n        }\n        if (isFollowing) {\n            return (\n                <button\n                    type='button'\n                    class={`btn btn-sm btn-outline-secondary float-right`}\n                    onClick={this.unFollowTeam}\n                    disabled='true'\n                    data-team={team.id}\n                >\n                    <i class='fas fa-link mr-2' />\n                    <Text id='teams.connect.is-following'>Følger</Text> {text}\n                </button>\n            );\n        }\n        if (isBlocked) {\n            return '';\n            // return (\n            //     <button\n            //         class={`btn btn-block btn-outline-secondary float-right`}\n            //         disabled='true'\n            //     >\n            //         <i class='fas fa-hand-paper mr-2' />\n            //         <Text id='teams.connect.is-blocked'>Blokkert</Text> {text}\n            //     </button>\n            // );\n        }\n        if (hasRequestedFollow) {\n            return (\n                <button\n                    type='button'\n                    class={`btn btn-sm btn-outline-secondary float-right`}\n                    disabled='true'\n                >\n                    <i class='fas fa-hourglass-half mr-2' />\n                    <Text id='teams.connect.has-requested'>Venter på godkjenning</Text> {text}\n                </button>\n            );\n        }\n        if (team.public) {\n            return (\n                <button\n                    type='button'\n                    class={`btn btn-sm btn-outline-success float-right`}\n                    onClick={this.requestFollowTeam}\n                    data-team={team.id}\n                >\n                    <i class='far fa-hand-point-right mr-2' />\n                    <Text id='teams.connect.follow'>Følg</Text> {text}\n                </button>\n            );\n        }\n    }\n\n    render() {\n        const { team, showButton } = this.props;\n        const { teamStore, userStore } = this.props.stores;\n\n        const currentMonth = new Date().getMonth() + 1;\n        const currentYear = new Date().getFullYear();\n\t\tconst { month = currentMonth, year = currentYear } = this.props;\n\t\tconst seasonStart = parseInt(month < 8 ? year - 1 : year, 10);\n\n        const workoutSummary = teamStore.findWorkoutSummary(team.id, seasonStart) || {};\n        const { user } = userStore;\n        const { language = 'en' } = user;\n        const teamAmbition = userStore.findTeamAmbition({ ambition: team.ambitions, language });\n        const teamType = userStore.findTeamType({ type: team.type, language });\n        const image = team.image && team.image.s3SmallLink ? team.image : null;\n\n        const { url = `/teams/${team.id}` } = this.props;\n\n        return (\n            <div class='w-100 mb-3'>\n                <div class='row'>\n                    <div class='col-12 col-sm-8 col-lg-6 offset-sm-2 offset-lg-3 d-flex mb-0 position-relative'>\n                        <div class='position-relative d-flex flex-grow-1'>\n                            {/* {JSON.stringify(team, null, 4)} */}\n                            <div class={`text-center border rounded-circle imageRounded`} style={image ? `background-image: url(\"${image.s3SmallLink}\"); background-size: cover;` : ''}>\n                                {!image && <i class='fas fa-users text-muted mt-3' style='font-size: 40px;' />}\n                            </div>\n                            <div class='flex-grow-1 pl-3' style='line-height: 1.2em;'>\n                                <a class='stretched-link' href={url}>\n                                    <h5 class='mb-1' style='line-height: 1.0em;'>{team.name}</h5>\n                                </a>\n                                <div>\n                                    {teamType && <span class='badge badge-pill badge-secondary'>{teamType}</span>}\n                                    {teamAmbition && <span class='badge badge-pill badge-secondary ml-2'>{teamAmbition}</span>}\n                                </div>\n                                <small class='text-muted'>\n                                    {team && team.dogs && <span class=''><i class='fas fa-dog' /> {team.dogs.length}</span>} \n                                    {team && team.members && <span class='ml-2'><i class='fas fa-user' /> {team.members.length}</span>}\n\n                                    {workoutSummary && workoutSummary.distanceKm > 0 && <span class='ml-2'><i class='fas fa-road' /> <Distance stores={this.props.stores} value={workoutSummary.distanceKm} /></span>}\n                                    {workoutSummary && workoutSummary.elevation > 0 && <span class='ml-2'><i class='fas fa-mountain' /> <Elevation stores={this.props.stores} value={workoutSummary.elevation} /></span>}\n                                    {workoutSummary && workoutSummary.duration > 0 && <span class='ml-2'><i class='fas fa-clock' /> {util.secToHms(workoutSummary.duration)}</span>}\n                                    {workoutSummary && workoutSummary.speedAvg > 0 && <span class='ml-2'><i class='fas fa-tachometer-alt' /> <Speed stores={this.props.stores} value={workoutSummary.speedAvg} /></span>}\n                                </small>\n                            </div>\n                        </div>\n                        {showButton && <div>\n                            {this.getButton()}\n                        </div>}\n                    </div>\n                </div>\n            </div>\n        );\n    }\n}\n\nexport default Team;\n","import { h, Component } from 'preact';\nimport util from 'preact-util';\nimport { observer } from 'mobx-preact';\nimport { Text, Localizer } from 'preact-i18n';\nimport linkState from 'linkstate';\n\nimport { route } from 'preact-router';\n\nimport Dog from '../../components/dog';\nimport Workout from '../../components/workout';\nimport Team from '../../components/team';\nimport Track from '../../components/track';\nimport User from '../../components/user';\nimport Story from '../../components/story/publicStory';\n\nimport TeamPublicFeedLine from '../../components/team/publicFeedLine';\n\nconst initialState = {\n\tsubmenu: 'dogs',\n\thits: 0,\n\tsearchText: '',\n};\n\n@observer\nclass Search extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            ...initialState,\n        };\n    }\n\n\tloadAll = async (props = this.props) => {\n\t\tconst { appState, storyStore, teamStore } = this.props.stores;\n\t\tconst { search } = props;\n\t    await appState.getSearch(search);\n\t\tconst { publicTeams, publicUsers } = appState;\n\t\tstoryStore.localUpdateField('publicTeams', publicTeams);\n\t\tstoryStore.localUpdateField('publicUsers', publicUsers);\n\t\tteamStore.localUpdateField('publicTeams', publicTeams);\n\t\tteamStore.localUpdateField('publicUsers', publicUsers);\n\n\t\tconst { searchResultStories, searchResultDogs, searchResultWorkouts, searchResultTeams, searchResultTracks } = appState;\n\t\tconst allData = [searchResultStories, searchResultDogs, searchResultWorkouts, searchResultTeams, searchResultTracks];\n\t\tconst names = ['stories', 'dogs', 'workouts', 'teams', 'tracks', 'users'];\n\t\tconst idx = allData\n\t\t\t.map(a => a.length)\n\t\t\t.indexOf(Math.max(...allData.map(a => a.length)));\n\t\tconst hits = allData.map(a => a.length).reduce((partialSum, a) => partialSum + a, 0);\n\t\tthis.setState({\n\t\t\tsearchText: search,\n\t\t\tsubmenu: names[idx],\n\t\t\thits,\n\t\t});\n\t}\n\n\tsearch = () => {\n\t\tconst { searchText } = this.state;\n\t\troute(`/search/${searchText}`, true);\n\t}\n\n\tchooseSubmenu = (e) => {\n\t\tconst submenu = e.target.parentElement.dataset.menu || e.target.dataset.menu;\n\t\tthis.setState({ submenu });\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.loadAll();\n\t}\n\n\tcomponentWillReceiveProps(nextProps) {\n        // console.log('componentWillReceiveProps', nextProps);\n        if (nextProps.search !== this.props.search) {\n            this.loadAll(nextProps);\n        }\n    }\n\n\trender() {\n\t\tconst { appState, userStore } = this.props.stores;\n\t\tconst { search } = this.props;\n\n\t\tconst { isAdmin } = userStore;\n\t\tconst { searchResultStories, searchResultDogs, searchResultWorkouts, searchResultTeams, searchResultTracks } = appState;\n\t\tconst { submenu, hits, searchText } = this.state;\n\t\treturn (\n\t\t\t<div class='container-fluid' style='margin-bottom: 200px; margin-top: 60px;'>\n\t\t\t\t<div class='row'>\n\t\t\t\t\t<div class='col-12 offset-0 col-sm-8 offset-sm-2 col-lg-6 offset-lg-3 mt-0 mb-2'>\n\t\t\t\t\t\t<h1><Text id='search.title'>Search</Text></h1>\n\t\t\t\t\t\t<h5 class='my-3'><Text id='search.search-for' fields={{ search, hits }}>{hits} in your search for \"{search}\"</Text></h5>\n\n\t\t\t\t\t\t<div class='d-flex justify-content-center py-3'>\n\t\t\t\t\t\t\t<Localizer>\n\t\t\t\t\t\t\t\t<input class='form-control form-control mr-2' type='search' placeholder={<Text id='header.search-placeholder'>Søk etter det meste...</Text>}\n\t\t\t\t\t\t\t\t\tvalue={searchText}\n\t\t\t\t\t\t\t\t\tonInput={linkState(this, 'searchText')}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</Localizer>\n\t\t\t\t\t\t\t<button class='btn btn-outline-success' type='button'\n\t\t\t\t\t\t\t\tonClick={this.search}\n\t\t\t\t\t\t\t><Text id='header.search'>Søk</Text></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class='col-12 offset-0 col-sm-8 offset-sm-2 col-lg-6 offset-lg-3 my-3'>\n\t\t\t\t\t\t<div class='row'>\n\t\t\t\t\t\t\t<div class='w-100 overflow-hidden'>\n                                <div\n                                    class='d-flex flex-row flex-nowrap pb-2 px-1'\n                                    style='overflow: auto; scroll-snap-type: x mandatory;'\n                                >\n\t\t\t\t\t\t\t\t\t<div class='col px-0 pt-2'>\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tclass={`btn btn-block rounded-pill-left rounded-none ${submenu === 'dogs' ? 'btn-primary' : 'btn-outline-primary'} text-nowrap`}\n\t\t\t\t\t\t\t\t\t\t\tstyle='text-overflow: ellipsis; overflow: hidden;'\n\t\t\t\t\t\t\t\t\t\t\tdata-menu='dogs'\n\t\t\t\t\t\t\t\t\t\t\tonClick={this.chooseSubmenu}\n\t\t\t\t\t\t\t\t\t\t><i class='fas fa-dog' /> <Text id='search.dogs'>Dogs</Text> ({searchResultDogs.length || 0})</button>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class='col px-0 pt-2'>\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tclass={`btn btn-block rounded-none ${submenu === 'workouts' ? 'btn-primary' : 'btn-outline-primary'} text-nowrap`}\n\t\t\t\t\t\t\t\t\t\t\tstyle='text-overflow: ellipsis; overflow: hidden;'\n\t\t\t\t\t\t\t\t\t\t\tdata-menu='workouts'\n\t\t\t\t\t\t\t\t\t\t\tonClick={this.chooseSubmenu}\n\t\t\t\t\t\t\t\t\t\t><i class='fas fa-running' /> <Text id='search.workouts'>Workouts</Text> ({searchResultWorkouts.length || 0})</button>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class='col px-0 pt-2'>\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tclass={`btn btn-block rounded-none ${submenu === 'teams' ? 'btn-primary' : 'btn-outline-primary'} text-nowrap`}\n\t\t\t\t\t\t\t\t\t\t\tstyle='text-overflow: ellipsis; overflow: hidden;'\n\t\t\t\t\t\t\t\t\t\t\tdata-menu='teams'\n\t\t\t\t\t\t\t\t\t\t\tonClick={this.chooseSubmenu}\n\t\t\t\t\t\t\t\t\t\t><i class='fas fa-users' /> <Text id='search.teams'>Teams</Text> ({searchResultTeams.length || 0})</button>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class='col px-0 pt-2'>\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tclass={`btn btn-block rounded-none ${submenu === 'tracks' ? 'btn-primary' : 'btn-outline-primary'} text-nowrap`}\n\t\t\t\t\t\t\t\t\t\t\tstyle='text-overflow: ellipsis; overflow: hidden;'\n\t\t\t\t\t\t\t\t\t\t\tdata-menu='tracks'\n\t\t\t\t\t\t\t\t\t\t\tonClick={this.chooseSubmenu}\n\t\t\t\t\t\t\t\t\t\t><i class='fas fa-map-marked-alt' /> <Text id='search.tracks'>Tracks</Text> ({searchResultTracks.length || 0})</button>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class='col px-0 pt-2'>\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tclass={`btn btn-block rounded-pill-right rounded-none ${submenu === 'stories' ? 'btn-primary' : 'btn-outline-primary'} text-nowrap`}\n\t\t\t\t\t\t\t\t\t\t\tstyle='text-overflow: ellipsis; overflow: hidden;'\n\t\t\t\t\t\t\t\t\t\t\tdata-menu='stories'\n\t\t\t\t\t\t\t\t\t\t\tonClick={this.chooseSubmenu}\n\t\t\t\t\t\t\t\t\t\t><i class='fas fa-comments' /> <Text id='search.stories'>Stories</Text> ({searchResultStories.length || 0})</button>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{submenu === 'dogs' && <>\n\t\t\t\t\t\t<div class='col-12'>\n\t\t\t\t\t\t\t{(!searchResultDogs || searchResultDogs.length === 0) && <>\n\t\t\t\t\t\t\t\t<div class='text-center text-muted'>\n\t\t\t\t\t\t\t\t\t<div class='display-1'>\n\t\t\t\t\t\t\t\t\t\t<i class='fas fa-dog' />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<h3 class='font-weight-lighter'>\n\t\t\t\t\t\t\t\t\t\t<Text id='search.no-dogs-found'>No dogs found.</Text>\n\t\t\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</>}\n\t\t\t\t\t\t\t{searchResultDogs && searchResultDogs.map(dog => (\n\t\t\t\t\t\t\t\t<Dog stores={this.props.stores} dog={dog} url={`/dogs/public/${dog.uuidv4}`} />\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</>}\n\t\t\t\t\t{submenu === 'workouts' && <>\n\t\t\t\t\t\t<div class='col-12 offset-0 col-sm-8 offset-sm-2 col-lg-6 offset-lg-3 mt-0 mb-2'>\n\t\t\t\t\t\t\t{(!searchResultWorkouts || searchResultWorkouts.length === 0) && <>\n\t\t\t\t\t\t\t\t<div class='text-center text-muted'>\n\t\t\t\t\t\t\t\t\t<div class='display-1'>\n\t\t\t\t\t\t\t\t\t\t<i class='fas fa-running' />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<h3 class='font-weight-lighter'>\n\t\t\t\t\t\t\t\t\t\t<Text id='search.no-workouts-found'>No workouts found.</Text>\n\t\t\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</>}\n\t\t\t\t\t\t\t{searchResultWorkouts && searchResultWorkouts.map((workout, idx) => (\n\t\t\t\t\t\t\t\t<div class='row mb-4'>\n\t\t\t\t\t\t\t\t\t<div class='col-12 py-3'>\n\t\t\t\t\t\t\t\t\t\t<TeamPublicFeedLine\n\t\t\t\t\t\t\t\t\t\t\tstores={this.props.stores}\n\t\t\t\t\t\t\t\t\t\t\tfeed={workout}\n\t\t\t\t\t\t\t\t\t\t\tidx={idx}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</>}\n\t\t\t\t\t{submenu === 'teams' && <>\n\t\t\t\t\t\t<div class='col-12'>\n\t\t\t\t\t\t\t{(!searchResultTeams || searchResultTeams.length === 0) && <>\n\t\t\t\t\t\t\t\t<div class='text-center text-muted'>\n\t\t\t\t\t\t\t\t\t<div class='display-1'>\n\t\t\t\t\t\t\t\t\t\t<i class='fas fa-users' />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<h3 class='font-weight-lighter'>\n\t\t\t\t\t\t\t\t\t\t<Text id='search.no-teams-found'>No teams found.</Text>\n\t\t\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</>}\n\t\t\t\t\t\t\t{searchResultTeams && searchResultTeams.map(team => <>\n\t\t\t\t\t\t\t\t<Team stores={this.props.stores} team={team} url={`/teams/public/${team.uuidv4}`} showButton={true} />\n\t\t\t\t\t\t\t</>)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</>}\n\t\t\t\t\t{submenu === 'tracks' && <>\n\t\t\t\t\t\t<div class='col-12'>\n\t\t\t\t\t\t\t{(!searchResultTracks || searchResultTracks.length === 0) && <>\n\t\t\t\t\t\t\t\t<div class='text-center text-muted'>\n\t\t\t\t\t\t\t\t\t<div class='display-1'>\n\t\t\t\t\t\t\t\t\t\t<i class='fas fa-map-marked-alt' />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<h3 class='font-weight-lighter'>\n\t\t\t\t\t\t\t\t\t\t<Text id='search.no-tracks-found'>No tracks found.</Text>\n\t\t\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</>}\n\t\t\t\t\t\t\t{searchResultTracks && searchResultTracks.map(track => (\n\t\t\t\t\t\t\t\t<Track stores={this.props.stores} track={track} />\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</>}\n\t\t\t\t\t{submenu === 'stories' && <>\n\t\t\t\t\t\t<div class='col-12 offset-0 col-sm-8 offset-sm-2 col-lg-6 offset-lg-3 mt-0 mb-2'>\n\t\t\t\t\t\t\t{(!searchResultStories || searchResultStories.length === 0) && <>\n\t\t\t\t\t\t\t\t<div class='text-center text-muted'>\n\t\t\t\t\t\t\t\t\t<div class='display-1'>\n\t\t\t\t\t\t\t\t\t\t<i class='fas fa-comments' />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<h3 class='font-weight-lighter'>\n\t\t\t\t\t\t\t\t\t\t<Text id='search.no-stories-found'>No stories found.</Text>\n\t\t\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</>}\n\t\t\t\t\t\t\t{searchResultStories && searchResultStories.map(story => (\n\t\t\t\t\t\t\t\t<div class='row mb-4'>\n\t\t\t\t\t\t\t\t\t<div class='col-12 py-3'>\n\t\t\t\t\t\t\t\t\t\t<Story\n\t\t\t\t\t\t\t\t\t\t\tstores={this.props.stores}\n\t\t\t\t\t\t\t\t\t\t\tstory={story}\n\t\t\t\t\t\t\t\t\t\t\tkey={`story-detail-${story.id}`}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</>}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default Search;\n"],"sourceRoot":""}