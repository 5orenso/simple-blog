{"version":3,"sources":["webpack:///./components/forgotten/index.js","webpack:///./components/error/index.js"],"names":["Login","observer","Component","constructor","props","super","handleEmailInput","async","e","userStore","stores","email","target","value","setState","clearTimeout","checkEmailTimer","setTimeout","checkEmail","updateCapsLockStatus","isCapsLock","this","sendLoginLink","state","validateCode","code","validateLoginCode","resetLoginLinkMessages","resetLoginMessages","resetEmailSent","updateObjectField","newUser","routeLoginNew","route","login","routeLogin","changeLanguage","lang","appState","setLanguage","showToken","componentDidMount","language","render","showLogo","emailIsAvailable","loginLink","emailSent","message","messageIcon","error","errorIcon","loginMessage","loginMessageIcon","loginError","loginErrorIcon","isValidEmail","util","validateEmail","isOkToSendLink","isValidCode","class","src","height","icon","remove","type","style","id","onInput","linkState","placeholder","onClick","disabled","onKeypress","href","role","Error","componentDidUpdate","removeTimer","componentWillUnmount","onclick","className"],"mappings":"2NAWMA,EADLC,Y,EAAD,cACoBC,YAChBC,YAAYC,GAAO,MACfC,MAAMD,GADS,YAUnBE,iBAAmBC,eAAOC,GACtB,MAAM,UAAEC,GAAc,EAAKL,MAAMM,OAC3BC,EAAQH,EAAEI,OAAOC,MACvB,EAAKC,SAAS,CAAEH,UAChBI,aAAa,EAAKC,iBAClB,EAAKA,gBAAkBC,WAAW,IAAMR,EAAUS,WAAWP,GAAQ,MAftD,KAkBnBQ,qBAAwBC,IACpBC,KAAKP,SAAS,CACVM,gBApBW,KAwBnBE,cAAgB,KACZ,MAAM,MAAEX,EAAQ,IAAOU,KAAKE,OACtB,UAAEd,GAAcY,KAAKjB,MAAMM,OACjCD,EAAUa,cAAcX,IA3BT,KA8BnBa,aAAe,KACX,MAAM,MAAEb,EAAF,KAASc,GAASJ,KAAKE,OACvB,UAAEd,GAAcY,KAAKjB,MAAMM,OACjCD,EAAUiB,kBAAkBf,EAAOc,IAjCpB,KAoCnBE,uBAAyB,KACrB,MAAM,UAAElB,GAAcY,KAAKjB,MAAMM,OACjCD,EAAUkB,0BAtCK,KAyCnBC,mBAAqB,KACjB,MAAM,UAAEnB,GAAcY,KAAKjB,MAAMM,OACjCD,EAAUmB,sBA3CK,KA8CnBC,eAAiB,KACb,MAAM,UAAEpB,GAAcY,KAAKjB,MAAMM,OACjCD,EAAUqB,kBAAkB,YAAa,aAAa,IAhDvC,KAmDnBC,QAAU,KACN,MAAM,MAAEpB,EAAQ,IAAOU,KAAKE,OACtB,cAAES,EAAiB,aAAYrB,GAAYU,KAAKjB,MACtD6B,gBAAMD,IAtDS,KAyDnBE,MAAQ,KACJ,MAAM,MAAEvB,EAAQ,IAAOU,KAAKE,OACtB,WAAEY,EAAc,IAAGxB,GAAYU,KAAKjB,MAC1C6B,gBAAME,IA5DS,KA+DnBC,eAAkB5B,IACd,MAAM6B,EAAO7B,EAAEI,OAAOC,OACtB,SAAEyB,GAAajB,KAAKjB,MAAMM,OAC1B4B,EAASC,YAAYF,IAhErBhB,KAAKE,MAAQ,CACTiB,WAAW,EACXpB,YAAY,EACZT,MAAOU,KAAKjB,MAAMO,MAClBc,KAAM,IA+DdgB,oBACI,MAAM,UAAEhC,EAAF,SAAa6B,GAAajB,KAAKjB,MAAMM,QACrC,SAAEgC,EAAW,MAASJ,EACxBjB,KAAKjB,MAAMO,QACXI,aAAaM,KAAKL,iBAClBK,KAAKL,gBAAkBC,WAAW,IAAMR,EAAUS,WAAWG,KAAKjB,MAAMO,MAAO+B,GAAW,MAIlGC,SACI,MAAM,WAAEvB,EAAF,MAAcT,EAAd,KAAqBc,GAASJ,KAAKE,OACnC,SAAEe,EAAF,UAAY7B,GAAcY,KAAKjB,MAAMM,QACrC,SAAEkC,GAAW,GAASvB,KAAKjB,OAC3B,SAAEsC,EAAW,MAASJ,GACtB,iBAAEO,EAAF,UAAoBC,EAApB,MAA+BZ,GAAUzB,GACzC,UAAEsC,EAAF,QAAaC,EAAb,YAAsBC,EAAtB,MAAmCC,EAAnC,UAA0CC,GAAcL,GAE1DE,QAASI,EAAcH,YAAaI,EACpCH,MAAOI,EAAYH,UAAWI,GAC9BrB,EAEEsB,EAAeC,IAAKC,cAAc/C,GAClCgD,EAAiBH,IAAiBX,EAClCe,EAAcH,IAAKjC,aAAaC,EAAM,IAAQ,QAIpD,OAAIsB,EAEI,mBAAKc,MAAM,mBACP,mBAAKA,MAAM,OACP,mBAAKA,MAAM,uFACNjB,GAAY,mBACT,mBAAKiB,MAAM,2CACK,mBACR,mBAAKC,IAAM,mDAAmDC,OAAO,WAUjF,YAAC,IAAD,CAAOf,QAASE,EAAOc,KAAMb,EAAWc,OAAQ5C,KAAKM,yBACrD,YAAC,IAAD,CAAOqB,QAASM,EAAYU,KAAMT,EAAgBU,OAAQ5C,KAAKO,qBAC/D,YAAC,IAAD,CAASoB,QAASA,EAASgB,KAAMf,EAAagB,OAAQ5C,KAAKM,yBAC3D,YAAC,IAAD,CAASqB,QAASI,EAAcY,KAAMX,EAAkBY,OAAQ5C,KAAKO,qBAErE,mBAAKiC,MAAM,cAEP,YAAC,IAAD,KACI,qBAAOK,KAAK,OACRL,MAAQ,iCAA+BpC,EAAQmC,EAAc,WAAa,aAAgB,IAC1FO,MAAM,uCACNC,GAAG,YACHC,QAASC,YAAUjD,KAAM,QACzBR,MAAOY,EACP8C,YAAa,YAAC,IAAD,CAAMH,GAAG,2BAAT,kBAGpB3C,IAASmC,GAAe,mBAAKC,MAAM,8BAA8BM,MAAO,mBACrE,YAAC,IAAD,CAAMC,GAAG,2BAAT,oEAEH3C,GAAQmC,IAAgBf,GAAoB,mBAAKgB,MAAM,8BAA8BM,MAAO,mBACzF,YAAC,IAAD,CAAMC,GAAG,uBAAT,uBAIR,sBAAQP,MAAQ,mCAAsEK,KAAK,SACvFM,QAASnD,KAAKG,aACdiD,UAAWb,GAEX,iBAAGC,MAAM,4BACT,YAAC,IAAD,CAAMO,GAAG,4BAAT,2BAIJ,qBAAOP,MAAM,yCACT,sBAAQA,MAAM,oCACVW,QAASnD,KAAKa,OAEd,YAAC,IAAD,CAAMkC,GAAG,wBAAT,4CAIR,qBAAOP,MAAM,yCACT,sBAAQA,MAAM,oCACVW,QAASnD,KAAKQ,gBAEd,YAAC,IAAD,CAAMuC,GAAG,0BAAT,gCAWxB,mBAAKP,MAAM,mBACP,mBAAKA,MAAM,OACP,mBAAKA,MAAM,uFACNjB,GAAY,mBACT,mBAAKiB,MAAM,2CACK,mBACR,mBAAKC,IAAM,mDAAmDC,OAAO,WAUjF,YAAC,IAAD,CAAOf,QAASE,EAAOc,KAAMb,EAAWc,OAAQ5C,KAAKM,yBACrD,YAAC,IAAD,CAASqB,QAASA,EAASgB,KAAMf,EAAagB,OAAQ5C,KAAKM,yBAE3D,mBAAKkC,MAAM,cAEP,YAAC,IAAD,KACI,qBAAOK,KAAK,QACRL,MAAQ,iCAA+BlD,EAAS6C,IAAiBX,EAAmB,WAAa,aAAgB,IACjHuB,GAAG,aACHC,QAAShD,KAAKf,iBACdO,MAAOF,EACP+D,WAAalE,IAAQiD,IAAKrC,WAAWZ,EAAGa,KAAKF,uBAC7CoD,YAAa,YAAC,IAAD,CAAMH,GAAG,mBAAT,aAGpBzD,GAAS6C,GAAgBX,GAAoB,mBAAKgB,MAAM,8BAA8BM,MAAQ,mBAC3F,YAAC,IAAD,CAAMC,GAAG,6BAAT,yBAD0C,IACwB,iBAAGO,KAAO,aAAYhE,GAAS,YAAC,IAAD,CAAMyD,GAAG,sBAAT,mBADvD,OAG7CzD,IAAU6C,GAAgB,mBAAKK,MAAM,8BAA8BM,MAAO,mBACvE,YAAC,IAAD,CAAMC,GAAG,6BAAT,uEAEHzD,GAAS6C,IAAiBX,GAAoB,mBAAKgB,MAAM,8BAA8BM,MAAO,mBAC3F,YAAC,IAAD,CAAMC,GAAG,8BAAT,wBAKPhD,GAAc,mBAAKyC,MAAM,qBAAqBe,KAAK,SAChD,YAAC,IAAD,CAAMR,GAAG,6BAAT,qBAGJ,sBAAQP,MAAQ,mCAAyEK,KAAK,SAC1FM,QAASnD,KAAKC,cACdmD,UAAWd,GAEX,iBAAGE,MAAM,4BACT,YAAC,IAAD,CAAMO,GAAG,6BAAT,2BAGJ,qBAAOP,MAAM,yCACT,sBAAQA,MAAM,oCACVW,QAASnD,KAAKa,OAEd,YAAC,IAAD,CAAMkC,GAAG,wBAAT,mD,EAWjBpE,a,mGCvPT6E,EADL5E,Y,EAAD,cACoBC,YAChB4E,qBACI,MAAM,OAAEb,EAAS,UAAa5C,KAAKjB,MACnCW,aAAaM,KAAK0D,aAClB1D,KAAK0D,YAAc9D,WAAW,IAAMgD,IAPnB,KAUrBe,uBACIjE,aAAaM,KAAK0D,aAGtBpC,SACI,MAAM,QAAEK,EAAF,KAAWgB,EAAX,OAAiBC,EAAS,UAAa5C,KAAKjB,MAElD,OAAK4C,EAID,mBAAKa,MAAM,aACP,mBAAKA,MAAM,0BACP,mBAAKA,MAAQ,UACT,iBAAGc,KAAK,IAAIM,QAAShB,EAAQJ,MAAM,eAC/B,iBAAGqB,UAAU,kBAEhBlB,GAAQ,kBAAIH,MAAM,mBAAkB,iBAAGA,MAAOG,KAC9ChB,GAAW,wBAAOA,MAVxB,O,EAkBJ6B","file":"39.chunk.ae696.esm.js","sourcesContent":["import { h, Component } from 'preact';\nimport util from 'preact-util';\nimport { observer } from 'mobx-preact';\nimport { route } from 'preact-router';\nimport linkState from 'linkstate';\nimport { Text, Localizer, withText } from 'preact-i18n';\n\nimport Error from '../error';\nimport Message from '../message';\n\n@observer\nclass Login extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            showToken: false,\n            isCapsLock: false,\n            email: this.props.email,\n            code: '',\n        };\n    }\n\n    handleEmailInput = async (e) => {\n        const { userStore } = this.props.stores;\n        const email = e.target.value;\n        this.setState({ email });\n        clearTimeout(this.checkEmailTimer);\n        this.checkEmailTimer = setTimeout(() => userStore.checkEmail(email), 1000);\n    }\n\n    updateCapsLockStatus = (isCapsLock) => {\n        this.setState({\n            isCapsLock,\n        });\n    }\n\n    sendLoginLink = () => {\n        const { email = '' } = this.state;\n        const { userStore } = this.props.stores;\n        userStore.sendLoginLink(email);\n    }\n\n    validateCode = () => {\n        const { email, code } = this.state;\n        const { userStore } = this.props.stores;\n        userStore.validateLoginCode(email, code);\n    }\n\n    resetLoginLinkMessages = () => {\n        const { userStore } = this.props.stores;\n        userStore.resetLoginLinkMessages();\n    }\n\n    resetLoginMessages = () => {\n        const { userStore } = this.props.stores;\n        userStore.resetLoginMessages();\n    }\n\n    resetEmailSent = () => {\n        const { userStore } = this.props.stores;\n        userStore.updateObjectField('loginLink', 'emailSent', false);\n    }\n\n    newUser = () => {\n        const { email = '' } = this.state;\n        const { routeLoginNew = `/register/${email}` } = this.props;\n        route(routeLoginNew);\n    }\n\n    login = () => {\n        const { email = '' } = this.state;\n        const { routeLogin = `/${email}` } = this.props;\n        route(routeLogin);\n    }\n\n    changeLanguage = (e) => {\n        const lang = e.target.value;\n\t\tconst { appState } = this.props.stores;\n        appState.setLanguage(lang);\n    }\n\n    componentDidMount() {\n        const { userStore, appState } = this.props.stores;\n        const { language = 'en' } = appState;\n        if (this.props.email) {\n            clearTimeout(this.checkEmailTimer);\n            this.checkEmailTimer = setTimeout(() => userStore.checkEmail(this.props.email, language), 1000);\n        }\n    }\n\n    render() {\n        const { isCapsLock, email, code } = this.state;\n        const { appState, userStore } = this.props.stores;\n        const { showLogo = true } = this.props;\n        const { language = 'en' } = appState;\n        const { emailIsAvailable, loginLink, login } = userStore;\n        const { emailSent, message, messageIcon, error, errorIcon } = loginLink;\n        const {\n            message: loginMessage, messageIcon: loginMessageIcon,\n            error: loginError, errorIcon: loginErrorIcon\n        } = login;\n\n        const isValidEmail = util.validateEmail(email);\n        const isOkToSendLink = isValidEmail && !emailIsAvailable;\n        const isValidCode = util.validateCode(code, 100000, 999999);\n\n        const darkmode = true;\n\n        if (emailSent) {\n            return (\n                <div class='container-fluid'>\n                    <div class='row'>\n                        <div class='col-12 offset-0 col-sm-8 offset-sm-2 col-md-6 offset-md-3 col-lg-4 offset-lg-4 pt-5'>\n                            {showLogo && <>\n                                <div class='d-flex justify-content-center mb-5 mt-5'>\n                                    {darkmode ? <>\n                                        <img src={`https://themusher.app/assets/logo-qpaws-dark.png`} height='100' />\n                                    </> : <>\n                                        <img src={`https://themusher.app/assets/logo-qpaws-light.png`} height='100' />\n                                    </>}\n                                </div>\n                            </>}\n                            {/* <div class='d-flex justify-content-center'>\n                                <h5 class='mt-1 mb-5'><Text id='forgotten.forgotten'>Glemt passord</Text></h5>\n                            </div> */}\n\n                            <Error message={error} icon={errorIcon} remove={this.resetLoginLinkMessages} />\n                            <Error message={loginError} icon={loginErrorIcon} remove={this.resetLoginMessages} />\n                            <Message message={message} icon={messageIcon} remove={this.resetLoginLinkMessages}  />\n                            <Message message={loginMessage} icon={loginMessageIcon} remove={this.resetLoginMessages}  />\n\n                            <div class='form-group'>\n                                {/* <label for='codeInput'><i class='fas fa-unlock-alt' /> <Text id='forgotten.one-time-code'>Engangskode for</Text> {email}</label> */}\n                                <Localizer>\n                                    <input type='text'\n                                        class={`form-control form-control-lg ${code ? (isValidCode ? 'is-valid' : 'is-invalid') : ''}`}\n                                        style='font-size: 40px; letter-spacing: 5px'\n                                        id='codeInput'\n                                        onInput={linkState(this, 'code')}\n                                        value={code}\n                                        placeholder={<Text id='forgotten.one-time-code'>Engangskode</Text>}\n                                    />\n                                </Localizer>\n                                {code && !isValidCode && <div class=\"invalid-feedback text-white\" style={'display: block;'}>\n                                    <Text id='forgotten.otp-not-valid'>Hmm, koden ser ikke helt riktig ut. Kan det være en skrivefeil?</Text>\n                                </div>}\n                                {code && isValidCode && !emailIsAvailable && <div class=\"invalid-feedback text-white\" style={'display: block;'}>\n                                    <Text id='forgotten.otp-valid'>Koden ser bra ut.</Text>\n                                </div>}\n                            </div>\n\n                            <button class={`btn btn-block btn-lg ${isValidCode ? 'btn-primary' : 'btn-primary'}`} type='button'\n                                onClick={this.validateCode}\n                                disabled={!isValidCode}\n                            >\n                                <i class='far fa-paper-plane mr-2' />\n                                <Text id='forgotten.login-with-otp'>Logg meg inn med koden</Text>\n                            </button>\n\n\n                            <small class='form-text text-muted mt-5 text-center'>\n                                <button class='btn btn-small btn-link text-white'\n                                    onClick={this.login}\n                                >\n                                    <Text id='forgotten.goto-login'>Jeg husker passordet. Gå til logg inn.</Text>\n                                </button>\n                            </small>\n\n                            <small class='form-text text-muted mt-2 text-center'>\n                                <button class='btn btn-small btn-link text-white'\n                                    onClick={this.resetEmailSent}\n                                >\n                                    <Text id='forgotten.send-new-otp'>Jeg trenger en ny kode.</Text>\n                                </button>\n                            </small>\n\n                        </div>\n                    </div>\n                </div>\n            );\n        }\n\n        return (\n            <div class='container-fluid'>\n                <div class='row'>\n                    <div class='col-12 offset-0 col-sm-8 offset-sm-2 col-md-6 offset-md-3 col-lg-4 offset-lg-4 pt-5'>\n                        {showLogo && <>\n                            <div class='d-flex justify-content-center mb-5 mt-5'>\n                                {darkmode ? <>\n                                    <img src={`https://themusher.app/assets/logo-qpaws-dark.png`} height='100' />\n                                </> : <>\n                                    <img src={`https://themusher.app/assets/logo-qpaws-light.png`} height='100' />\n                                </>}\n                            </div>\n                        </>}\n                        {/* <div class='d-flex justify-content-center'>\n                            <h5 class='mt-1 mb-5'><Text id='forgotten.forgotten'>Glemt passord</Text></h5>\n                        </div> */}\n\n                        <Error message={error} icon={errorIcon} remove={this.resetLoginLinkMessages} />\n                        <Message message={message} icon={messageIcon} remove={this.resetLoginLinkMessages}  />\n\n                        <div class='form-group'>\n                            {/* <label for='emailInput'><i class='far fa-envelope' /> <Text id='forgotten.email'>E-post</Text></label> */}\n                            <Localizer>\n                                <input type='email'\n                                    class={`form-control form-control-lg ${email ? (isValidEmail && !emailIsAvailable ? 'is-valid' : 'is-invalid') : ''}`}\n                                    id='emailInput'\n                                    onInput={this.handleEmailInput}\n                                    value={email}\n                                    onKeypress={(e) => { util.isCapsLock(e, this.updateCapsLockStatus); }}\n                                    placeholder={<Text id='forgotten.email'>E-post</Text>}\n                                />\n                            </Localizer>\n                            {email && isValidEmail && emailIsAvailable && <div class='invalid-feedback text-white' style={`display: block;`}>\n                                <Text id='forgotten.email-not-found'>E-posten finnes ikke.</Text> <a href={`/register/${email}`}><Text id='forgotten.register'>registrere deg</Text></a> 😃\n                            </div>}\n                            {email && !isValidEmail && <div class=\"invalid-feedback text-white\" style={'display: block;'}>\n                                <Text id='forgotten.email-not-valid'>Hmm, e-posten ser ikke helt riktig ut. Kan det være en skrivefeil?</Text>\n                            </div>}\n                            {email && isValidEmail && !emailIsAvailable && <div class=\"invalid-feedback text-white\" style={'display: block;'}>\n                                <Text id='forgotten.email-looks-good'>E-post ser bra ut.</Text>\n                            </div>}\n                        </div>\n\n\n                        {isCapsLock && <div class='alert alert-danger' role='alert'>\n                            <Text id='forgotten.caps-lock-is-on'>CAPS LOCK er på!</Text>\n                        </div>}\n\n                        <button class={`btn btn-block btn-lg ${isOkToSendLink ? 'btn-primary' : 'btn-primary'}`} type='button'\n                            onClick={this.sendLoginLink}\n                            disabled={!isOkToSendLink}\n                        >\n                            <i class='far fa-paper-plane mr-2' />\n                            <Text id='forgotten.send-reset-link'>Send meg en reset link</Text>\n                        </button>\n\n                        <small class='form-text text-muted mt-5 text-center'>\n                            <button class='btn btn-small btn-link text-white'\n                                onClick={this.login}\n                            >\n                                <Text id='forgotten.goto-login'>Jeg husker passordet. Gå til logg inn.</Text>\n                            </button>\n                        </small>\n\n                    </div>\n                </div>\n            </div>\n        );\n    }\n}\n\nexport default Login;\n","import { h, Component } from 'preact';\nimport { observer } from 'mobx-preact';\n\nconst ERROR_DISPLAY_MS = 10000;\n\n@observer\nclass Error extends Component {\n    componentDidUpdate() {\n        const { remove = () => {} } = this.props;\n        clearTimeout(this.removeTimer);\n        this.removeTimer = setTimeout(() => remove(), ERROR_DISPLAY_MS);\n    }\n\n    componentWillUnmount() {\n        clearTimeout(this.removeTimer);\n    }\n\n    render() {\n        const { message, icon, remove = () => {} } = this.props;\n\n        if (!message) {\n            return '';\n        }\n        return (\n            <div class='container'>\n                <div class='alert alert-danger row'>\n                    <div class={`col-12`}>\n                        <a href='#' onclick={remove} class='float-right'>\n                            <i className='fas fa-times' />\n                        </a>\n                        {icon && <h1 class='float-left mr-3'><i class={icon} /></h1>}\n                        {message && <span>{message}</span>}\n                    </div>\n                </div>\n            </div>\n        );\n    }\n}\n\nexport default Error;\n"],"sourceRoot":""}