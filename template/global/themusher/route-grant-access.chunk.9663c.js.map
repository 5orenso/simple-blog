{"version":3,"sources":["webpack:///./routes/grant-access/index.js"],"names":["GrantAccess","observer","props","loadApplication","stores","applicationStore","load","state","id","loadTeam","setState","isLoading","teamStore","workoutStore","currentTeam","changeLanguage","e","appState","setLanguage","target","value","grantAccess","accessGranted","grantObject","user","userStore","returnUrl","grantedDate","Date","team","appId","findApplicationById","saveField","denyAccess","route","saveInputParams","util","set","get","componentWillMount","this","componentDidMount","render","subsection","language","darkmode","application","class","src","height","role","title","body","images","minHeight","markdown","mu","replaceImages","markdownOpts","getMarkdownOptions","email","href","uuidv4","native","callback","key","showAll","onClick","showLogo","routeLoginOk","routeLoginNew","routeLoginForgot","routeLogin","skipPubSub","style","onInput","selected","Component"],"mappings":"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","file":"route-grant-access.chunk.9663c.js","sourcesContent":["import { h, Component } from 'preact';\nimport util from 'preact-util';\nimport { observer } from 'mobx-preact';\nimport { route } from 'preact-router';\nimport linkState from 'linkstate';\nimport { Text, Localizer, withText } from 'preact-i18n';\nimport Markdown from 'preact-markdown';\n\nimport mu from '../../lib/musher-util';\n\nimport LoginForm from '../../components/login/loginForm';\nimport LoginRegister from '../../components/register';\nimport LoginForgot from '../../components/forgotten';\nimport Teams from '../../components/team/teams';\nimport ImageScroller from '../../components/imageScroller';\n\n@observer\nclass GrantAccess extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            returnUrl: '',\n            id: 0,\n        };\n    }\n\n    loadApplication = () => {\n        const { id } = this.state;\n        const { applicationStore } = this.props.stores;\n        applicationStore.load(id);\n    }\n\n    loadTeam = async () => {\n        this.setState({ isLoading: true });\n\t\tconst { teamStore, workoutStore } = this.props.stores;\n\t\tconst { currentTeam } = workoutStore;\n\t\tawait teamStore.load(currentTeam);\n\t\tthis.setState({ isLoading: false });\n    }\n\n    changeLanguage = (e) => {\n        const lang = e.target.value;\n\t\tconst { appState } = this.props.stores;\n        appState.setLanguage(lang);\n    }\n\n    grantAccess = async () => {\n        const { userStore, teamStore, workoutStore } = this.props.stores;\n        const { currentTeam } = workoutStore;\n        const { user } = userStore;\n        const { returnUrl, id } = this.state;\n        const grantObject = {\n            grantedDate: new Date(),\n            returnUrl,\n            team: currentTeam,\n            appId: id,\n        };\n        const existingApp = userStore.findApplicationById(id);\n        if (!existingApp) {\n            await userStore.saveField(user.id, 'applications', grantObject);\n            await userStore.saveField(user.id, 'settings.veterinaryAllowed', 1);\n            await teamStore.saveField(currentTeam, 'public', 1);\n        }\n        this.setState({\n            accessGranted: 1,\n        });\n    }\n\n    denyAccess = () => {\n        route(`/`);\n    }\n\n    saveInputParams = () => {\n        let { returnUrl, id } = this.props;\n        if (returnUrl) {\n            util.set('returnUrl', returnUrl);\n            util.set('id', id);\n        } else {\n            returnUrl = util.get('returnUrl');\n            id = util.get('id');\n        }\n        this.setState({\n            returnUrl,\n            id,\n        });\n    }\n\n    componentWillMount() {\n        this.saveInputParams();\n    }\n\n    componentDidMount() {\n        this.loadApplication();\n        this.loadTeam();\n    }\n\n    render() {\n        const { appState, userStore, applicationStore, workoutStore, teamStore } = this.props.stores;\n        const { subsection } = this.props;\n        const { returnUrl, id, accessGranted } = this.state;\n\t\tconst { currentTeam } = workoutStore;\n        const { user } = userStore;\n        const { language = 'en', darkmode } = appState;\n        const { application } = applicationStore;\n        const { team } = teamStore;\n\n        if (!application) {\n            return (\n                <div class='container-fluid'>\n                    <div class='row'>\n                        <div class='col-10 offset-1 col-sm-8 offset-sm-2 col-md-6 offset-md-3 col-lg-4 offset-lg-4 pt-5'>\n\n                            <div class='d-flex justify-content-center'>\n                                {darkmode ? <>\n                                    <img src={`https://themusher.app/assets/logo-qpaws-dark.png`} height='100' />\n                                </> : <>\n                                    <img src={`https://themusher.app/assets/logo-qpaws-light.png`} height='100' />\n                                </>}\n                            </div>\n                            <div class='d-flex justify-content-center'>\n                                <h5 class='mt-1 mb-3 font-weight-lighter'><Text id='grant-access.title'>Grant access</Text></h5>\n                            </div>\n\n                            <div class='alert alert-danger' role='alert'>\n                                <h5>Error</h5>\n                                Application not found!\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            );\n        }\n\n        const { title, body, email, images } = application;\n        return (\n            <div class='container-fluid'>\n                <div class='row'>\n                    <div class='col-10 offset-1 col-sm-8 offset-sm-2 col-md-6 offset-md-3 col-lg-4 offset-lg-4 pt-5'>\n                        <div class='d-flex justify-content-center'>\n                            {darkmode ? <>\n                                <img src={`https://themusher.app/assets/logo-qpaws-dark.png`} height='100' />\n                            </> : <>\n                                <img src={`https://themusher.app/assets/logo-qpaws-light.png`} height='100' />\n                            </>}\n                        </div>\n                        <div class='d-flex justify-content-center'>\n                            <h5 class='mt-1 mb-3 font-weight-lighter'><Text id='grant-access.title'>Grant access</Text></h5>\n                        </div>\n\n                        <ImageScroller stores={this.props.stores} images={images} minHeight={'50px'} />\n                        <h5 class='mt-3'>{title}</h5>\n                        <p class='mt-3'>\n                            <Markdown markdown={mu.replaceImages(body, images, language)} markdownOpts={mu.getMarkdownOptions()} />\n                        </p>\n                    </div>\n                </div>\n                <div class='row'>\n                    {user.email ? <>\n                        {accessGranted ? <>\n                            <div class='col-10 offset-1 col-sm-8 offset-sm-2 col-md-6 offset-md-3 col-lg-4 offset-lg-4 mt-3 border-top pt-3'>\n                                <div class='display-1 text-success text-center'>\n                                    <i class='fas fa-check' />\n                                </div>\n                                <p>\n                                    <Text id='grant-access.access-granted'>Access granted. Now please click the button below to go back to</Text> {title}.\n                                </p>\n                                <a \n                                    class='btn btn-success btn-block' \n                                    href={`${returnUrl}?userId=${user.uuidv4}&teamId=${team.uuidv4}`}\n                                    native\n                                >\n                                    <Text id='grant-access.back-to-application'>Back to</Text>: {title} <i class='fas fa-arrow-right' />\n                                </a>\n                            </div>\n                        </> : <>\n                            <div class='col-10 offset-1 col-sm-8 offset-sm-2 col-md-6 offset-md-3 col-lg-4 offset-lg-4 mt-3 border-top pt-3'>\n                                <h5 class='font-weight-light'>\n                                    <Text id='grant-access.data-shared'>Data beeing shared</Text>:\n                                </h5>\n                                <p>\n                                    <i class='fas fa-user' />: <Text id='grant-access.fields-shared-person'>Image, Name, email, cellphone, address</Text>\n                                </p>\n                                <p>\n                                    <i class='fas fa-dog' />: <Text id='grant-access.fields-shared-dog'>Image, Name, chipId, gender, birth, vaccines</Text>\n                                </p>\n                                <p>\n                                    <i class='fas fa-users' />: <Text id='grant-access.fields-shared-team'>Name, description, images</Text>\n                                </p>\n                            </div>\n                            <div class='col-10 offset-1 col-sm-8 offset-sm-2 col-md-6 offset-md-3 col-lg-4 offset-lg-4 mt-3 border-top pt-3'>\n                                <h5 class='font-weight-light'>\n                                    <Text id='grant-access.choose-team'>Choose team</Text>\n                                </h5>\n                                <div class='col-12'>\n                                    <Teams stores={this.props.stores} callback={this.loadTeam} key={`teams-${currentTeam}`} showAll={false} />\n                                </div>\n                            </div>\n                            {currentTeam ? <>                            \n                                <div class='col-10 offset-1 col-sm-8 offset-sm-2 col-md-6 offset-md-3 col-lg-4 offset-lg-4 mt-3'>\n                                    <button\n                                        class='btn btn-primary btn-block'\n                                        onClick={this.grantAccess}\n                                    >\n                                        <i class='fas fa-check' /> <Text id='grant-access.grant'>Grant access</Text>\n                                    </button>\n\n                                    <button\n                                        class='mt-4 btn btn-sm btn-link text-muted float-right'\n                                        onClick={this.denyAccess}\n                                    >\n                                        <Text id='grant-access.deny'>Deny access</Text>\n                                    </button>\n                                </div>\n                            </> : <>\n                                <div class='col-10 offset-1 col-sm-8 offset-sm-2 col-md-6 offset-md-3 col-lg-4 offset-lg-4 mt-3'>\n                                    <span class='display-4'>\n                                        <i class='fas fa-hand-point-up' /> Choose team\n                                    </span>\n                                </div>\n                            </>}\n                        </>}\n                    </> : <>\n                        {!subsection && <LoginForm stores={this.props.stores}\n                            showLogo={false}\n                            routeLoginOk={`/grant-access`}\n                            routeLoginNew={`/grant-access/newUser`}\n                            routeLoginForgot={`/grant-access/forgotPassword`}\n                        />}\n\n                        {subsection === 'newUser' && <LoginRegister stores={this.props.stores}\n                            showLogo={false}\n                            routeLogin={`/grant-access`}\n                            routeLoginForgot={`/grant-access/forgotPassword`}\n                            skipPubSub={true}\n                        />}\n\n                        {subsection === 'forgotPassword' && <LoginForgot stores={this.props.stores}\n                            showLogo={false}\n                            routeLogin={`/grant-access`}\n                            routeLoginNew={`/grant-access/newUser`}\n                        />}\n                    </>}\n\n                </div>\n                <div class='col-10 offset-1 col-sm-8 offset-sm-2 col-md-6 offset-md-3 col-lg-4 offset-lg-4'>\n                    <div class='form-row align-items-center'>\n\t\t\t\t\t\t\t<div class='col-auto my-1 mx-auto' style='width: 80px;'>\n\t\t\t\t\t\t\t\t<select class='custom-select'\n\t\t\t\t\t\t\t\t\tstyle='background-color: inherit; border: none;'\n\t\t\t\t\t\t\t\t\tonInput={this.changeLanguage}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<option value='no' selected={language === 'no'}>🇳🇴 NO</option>\n\t\t\t\t\t\t\t\t\t<option value='en' selected={language === 'en'}>🇬🇧 EN</option>\n                                    <option value='es' selected={language === 'es'}>🇪🇸 ES</option>\n                                    <option value='de' selected={language === 'de'}>🇩🇪 DE</option>\n                                    <option value='fr' selected={language === 'fr'}>🇫🇷 FR</option>\n                                    <option value='ru' selected={language === 'ru'}>🇷🇺 RU</option>\n                                    <option value='se' selected={language === 'se'}>🇸🇪 SE</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n                </div>\n            </div>\n        );\n    }\n}\n\nexport default GrantAccess;\n"],"sourceRoot":""}