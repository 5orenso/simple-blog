{"version":3,"sources":["webpack:///./routes/grant-access/index.js"],"names":["GrantAccess","observer","Component","constructor","props","super","loadApplication","id","this","state","applicationStore","stores","load","changeLanguage","e","lang","target","value","appState","setLanguage","grantAccess","async","userStore","user","returnUrl","team","grantObject","grantedDate","Date","appId","findApplicationById","saveField","setState","accessGranted","denyAccess","route","saveInputParams","util","set","get","componentWillMount","componentDidMount","render","subsection","language","application","class","role","title","body","images","markdown","mu","replaceImages","markdownOpts","getMarkdownOptions","email","href","uuidv4","native","onClick","showLogo","routeLoginOk","routeLoginNew","routeLoginForgot","routeLogin","skipPubSub","style","onInput","selected"],"mappings":"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","file":"route-grant-access.chunk.c5e08.esm.js","sourcesContent":["import { h, Component } from 'preact';\nimport util from 'preact-util';\nimport { observer } from 'mobx-preact';\nimport { route } from 'preact-router';\nimport linkState from 'linkstate';\nimport { Text, Localizer, withText } from 'preact-i18n';\nimport Markdown from 'preact-markdown';\n\nimport mu from '../../lib/musher-util';\n\nimport LoginForm from '../../components/login/loginForm';\nimport LoginRegister from '../../components/register';\nimport LoginForgot from '../../components/forgotten';\n\n@observer\nclass GrantAccess extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            returnUrl: '',\n            id: 0,\n        };\n    }\n\n    loadApplication = () => {\n        const { id } = this.state;\n        const { applicationStore } = this.props.stores;\n        applicationStore.load(id);\n    }\n\n    changeLanguage = (e) => {\n        const lang = e.target.value;\n\t\tconst { appState } = this.props.stores;\n        appState.setLanguage(lang);\n    }\n\n    grantAccess = async () => {\n        const { userStore } = this.props.stores;\n        const { user } = userStore;\n        const { returnUrl, id, team } = this.state;\n        const grantObject = {\n            grantedDate: new Date(),\n            returnUrl,\n            team,\n            appId: id,\n        };\n        const existingApp = userStore.findApplicationById(id);\n        if (!existingApp) {\n            await userStore.saveField(user.id, 'applications', grantObject);\n        }\n        this.setState({\n            accessGranted: 1,\n        });\n    }\n\n    denyAccess = () => {\n        route(`/`, true);\n    }\n\n    saveInputParams = () => {\n        let { returnUrl, id } = this.props;\n        if (returnUrl) {\n            util.set('returnUrl', returnUrl);\n            util.set('id', id);\n        } else {\n            returnUrl = util.get('returnUrl');\n            id = util.get('id');\n        }\n        this.setState({\n            returnUrl,\n            id,\n        });\n    }\n\n    componentWillMount() {\n        this.saveInputParams();\n    }\n\n    componentDidMount() {\n        this.loadApplication();\n    }\n\n    render() {\n        const { appState, userStore, applicationStore } = this.props.stores;\n        const { subsection } = this.props;\n        const { returnUrl, id, accessGranted } = this.state;\n\n        const { user } = userStore;\n        const { language = 'en' } = appState;\n        const { application } = applicationStore;\n\n        if (!application) {\n            return (\n                <div class='container-fluid'>\n                    <div class='row'>\n                        <div class='col-10 offset-1 col-sm-8 offset-sm-2 col-md-6 offset-md-3 col-lg-4 offset-lg-4 pt-5'>\n                            <h1 class='mt-5'><i class='fas fa-paw' /> The Musher</h1>\n                            <h5 class='mt-1 mb-5 font-weight-lighter'><Text id='grant-access.title'>Grant access</Text></h5>\n                            <div class='alert alert-danger' role='alert'>\n                                <h5>Error</h5>\n                                Application not found!\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            );\n        }\n\n        const { title, body, email, images } = application;\n        return (\n            <div class='container-fluid'>\n                <div class='row'>\n                    <div class='col-10 offset-1 col-sm-8 offset-sm-2 col-md-6 offset-md-3 col-lg-4 offset-lg-4 pt-5'>\n                        <h1 class='mt-5'><i class='fas fa-paw' /> The Musher</h1>\n                        <h5 class='mt-1 mb-5 font-weight-lighter'><Text id='grant-access.title'>Grant access</Text></h5>\n                        <h5>{title}</h5>\n                        <p>\n                            <Markdown markdown={mu.replaceImages(body, images, language)} markdownOpts={mu.getMarkdownOptions()} />\n                        </p>\n                    </div>\n                </div>\n                <div class='row'>\n                    {user.email ? <>\n                            <div class='col-10 offset-1 col-sm-8 offset-sm-2 col-md-6 offset-md-3 col-lg-4 offset-lg-4'>\n\n                            <div class='my-4'>\n                                <h5 class='font-weight-light'>\n                                    <Text id='grant-access.data-shared'>Data beeing shared</Text>:\n                                </h5>\n                                <p>\n                                    <i class='fas fa-user' />: <Text id='grant-access.fields-shared-person'>Image, Name, email, cellphone, address</Text>\n                                </p>\n                                <p>\n                                    <i class='fas fa-dog' />: <Text id='grant-access.fields-shared-dog'>Image, Name, chipId, gender, birth, vaccines</Text>\n                                </p>\n                                <p>\n                                    <i class='fas fa-users' />: <Text id='grant-access.fields-shared-team'>Name, description, images</Text>\n                                </p>\n                            </div>\n                            \n                            {accessGranted ? <>\n                                <a href={`${returnUrl}?userId=${user.uuidv4}`} native>Go back to application</a>\n                            </> : <>                                \n                                <button\n                                    class='btn btn-success'\n                                    onClick={this.grantAccess}\n                                >\n                                    <Text id='grant-access.grant'>Grant access</Text>\n                                </button>\n\n                                <button\n                                    class='btn btn-sm btn-link text-muted float-right'\n                                    onClick={this.denyAccess}\n                                >\n                                    <Text id='grant-access.deny'>Deny access</Text>\n                                </button>\n                            </>}\n                        </div>\n                    </> : <>\n                        {!subsection && <LoginForm stores={this.props.stores}\n                            showLogo={false}\n                            routeLoginOk={`/grant-access`}\n                            routeLoginNew={`/grant-access/newUser`}\n                            routeLoginForgot={`/grant-access/forgotPassword`}\n                        />}\n\n                        {subsection === 'newUser' && <LoginRegister stores={this.props.stores}\n                            showLogo={false}\n                            routeLogin={`/grant-access`}\n                            routeLoginForgot={`/grant-access/forgotPassword`}\n                            skipPubSub={true}\n                        />}\n\n                        {subsection === 'forgotPassword' && <LoginForgot stores={this.props.stores}\n                            showLogo={false}\n                            routeLogin={`/grant-access`}\n                            routeLoginNew={`/grant-access/newUser`}\n                        />}\n                    </>}\n\n                </div>\n                <div class='col-10 offset-1 col-sm-8 offset-sm-2 col-md-6 offset-md-3 col-lg-4 offset-lg-4'>\n                    <div class='form-row align-items-center'>\n\t\t\t\t\t\t\t<div class='col-auto my-1 mx-auto' style='width: 80px;'>\n\t\t\t\t\t\t\t\t<select class='custom-select'\n\t\t\t\t\t\t\t\t\tstyle='background-color: inherit; border: none;'\n\t\t\t\t\t\t\t\t\tonInput={this.changeLanguage}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<option value='no' selected={language === 'no'}>🇳🇴 NO</option>\n\t\t\t\t\t\t\t\t\t<option value='en' selected={language === 'en'}>🇬🇧 EN</option>\n                                    <option value='es' selected={language === 'es'}>🇪🇸 ES</option>\n                                    <option value='de' selected={language === 'de'}>🇩🇪 DE</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n                </div>\n            </div>\n        );\n    }\n}\n\nexport default GrantAccess;\n"],"sourceRoot":""}