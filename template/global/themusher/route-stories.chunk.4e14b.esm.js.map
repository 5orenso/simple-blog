{"version":3,"sources":["webpack:///./components/story/publicDetail.js","webpack:///./routes/stories/index.js"],"names":["initialState","StoryPublicFeed","observer","Component","constructor","props","super","this","state","inputRef","storyStore","stores","story","loadPublicFeed","componentDidMount","loadStoriesPublicFeed","componentWillReceiveProps","nextProps","render","appState","publicFeed","darkmode","class","length","map","showAllComments","MARGIN_TOP","mu","marginTop","MARGIN_BOTTOM","marginBottom","MARGIN_TOP_BACK","marginTopBack","isLoading","submenu","viewmenu","Home","reloadFeeds","async","e","preventDefault","setState","sortby","sortBy","target","value","a","b","likes","comments","id","sortPublicFeed","back","history","goBack","userStore","messageStore","getFingerprint","getInfo","getNotifications","getUnReadMessages","user","currentLocationInfo","coords","latitude","lat","longitude","lon","altitude","getWeatherUser","loadAll","hashtag","teamid","path","team","findPublicTeamByUuidv4","yrWeather","currentLocationGeocode","formatted_address","place","image","getImage","shortname","name","username","displayNameShort","displayName","style","onClick","data","public","href","uuidv4","onChange"],"mappings":"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","file":"route-stories.chunk.4e14b.esm.js","sourcesContent":["import { h, Component } from 'preact';\nimport util from 'preact-util';\nimport { observer } from 'mobx-preact';\nimport Story from './publicStory';\n\nimport mu from '../../lib/musher-util';\n\nconst initialState = {};\n\n@observer\nclass StoryPublicFeed extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            ...initialState,\n        };\n\t\tthis.inputRef = {};\n    }\n\n    async loadStoriesPublicFeed(props = this.props) {\n\t\tconst { storyStore } = props.stores;\n        const { story } = props;\n\t\tawait storyStore.loadPublicFeed({ story });\n\t}\n\n\tcomponentDidMount() {\n        this.loadStoriesPublicFeed();\n\t}\n\n    componentWillReceiveProps(nextProps) {\n        // console.log('componentWillReceiveProps', nextProps);\n        if (nextProps.story !== this.props.story) {\n            this.loadStoriesPublicFeed(nextProps);\n        }\n    }\n\n    render() {\n        const { storyStore, appState } = this.props.stores;\n        const { publicFeed } = storyStore;\n        const { darkmode } = appState;\n\n        return (\n            <div class='w-100'>\n\n                <div class='row pb-4 bg-light'>\n                    <div class={`col-12 col-sm-8 col-lg-6 offset-sm-2 offset-lg-3 my-1 position-relative rounded rounded-lg py-3 bg-${darkmode ? 'black' : 'white'} shadow-sm`}>\n                        {!publicFeed || publicFeed.length === 0 && <>\n                            <div class='text-center text-muted mt-5'>\n                                <div class='display-1 text-center mb-5'>\n                                    <i class='fas fa-comment' />\n                                </div>\n                                <h3>No story found!</h3>\n                            </div>\n                        </>}\n                        {publicFeed && publicFeed.map((story) => <>\n                            <Story\n                                stores={this.props.stores}\n                                story={story}\n                                showAllComments={true}\n                            />\n                        </>)}\n                    </div>\n                </div>\n            </div>\n        );\n    }\n}\n\nexport default StoryPublicFeed;\n","import { h, Component } from 'preact';\nimport util from 'preact-util';\nimport { observer } from 'mobx-preact';\nimport { Text, Localizer } from 'preact-i18n';\nimport { route } from 'preact-router';\nimport linkState from 'linkstate';\n\nimport PubSub, { topics } from '../../lib/pubsub';\n\nimport mu from '../../lib/musher-util';\nconst MARGIN_TOP = mu.marginTop(false);\nconst MARGIN_BOTTOM = mu.marginBottom();\nconst MARGIN_TOP_BACK = mu.marginTopBack(false);\n\nimport StoryAdd from '../../components/story/add';\nimport StoryPublicFeed from '../../components/story/publicFeed';\nimport StoryPublicDetail from '../../components/story/publicDetail';\nimport Ad from '../../components/ad/';\nimport YrWeather from '../../components/yrweather/';\n\nconst initialState = {\n\tisLoading: false,\n\tsubmenu: 'lastWorkouts',\n\tviewmenu: 'wall',\n};\n\n@observer\nclass Home extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            ...initialState,\n        };\n    }\n\n\tasync loadAll() {\n\t\tconst { appState, userStore, messageStore } = this.props.stores;\n\t\tthis.setState({ isLoading: true });\n        await appState.getFingerprint();\n        await userStore.getInfo();\n\t\tawait userStore.getNotifications();\n        await messageStore.getUnReadMessages();\n\n\t\tconst { user } = userStore;\n\t\tif (user.currentLocationInfo && user.currentLocationInfo.coords) {\n\t\t\tconst { latitude: lat, longitude: lon, altitude } = user.currentLocationInfo.coords;\n\t\t\tuserStore.getWeatherUser({ lat, lon, altitude });\n\t\t}\n\t\tthis.setState({ isLoading: false });\n    }\n\n\treloadFeeds = async (e) => {\n\t\te.preventDefault();\n\t\tthis.setState({ isLoading: true });\n\t\tthis.setState({ isLoading: false });\n\t}\n\n    sortby = (e) => {\n        const { storyStore } = this.props.stores;\n        const sortField = e.target.value;\n        let sortBy = () => {};\n        switch (sortField) {\n            case 'likes':\n                sortBy = (a, b) => a.likes && b.likes && a.likes.length < b.likes.length;\n                break;\n            case '-likes':\n                sortBy = (a, b) => a.likes && b.likes && a.likes.length > b.likes.length;\n                break;\n            case 'comments':\n                sortBy = (a, b) => a.comments && b.comments && a.comments.length < b.comments.length;\n                break;\n            case '-comments':\n                sortBy = (a, b) => a.comments && b.comments && a.comments.length > b.comments.length;\n                break;\n            default:\n                sortBy = (a, b) => a.id < b.id;\n                break;\n        }\n        storyStore.sortPublicFeed(sortBy);\n    }\n\n\tcomponentDidMount() {\n\t\tthis.loadAll();\n\t}\n\n    back = () => {\n        const { history } = this.props.stores;\n        history.goBack();\n    }\n\n\trender() {\n        const { isLoading, viewmenu } = this.state;\n        const { story, hashtag, teamid, path } = this.props;\n\t\tconst { userStore, appState, storyStore } = this.props.stores;\n        const { darkmode } = appState;\n        const team = storyStore.findPublicTeamByUuidv4(teamid);\n\n\t\tconst { user } = userStore;\n\t\tconst { yrWeather, currentLocationGeocode = {} } = user;\n\t\tconst { formatted_address: place } = currentLocationGeocode;\n\n        const image = mu.getImage({ team });\n\n        let shortname;\n        let name;\n        let username;\n        if (team && team.name) {\n            shortname = mu.displayNameShort(team);\n            name = mu.displayName(team);\n            username = mu.displayName(user);\n        } else if (user && user.id) {\n            shortname = mu.displayNameShort(user);\n            name = mu.displayName(user);\n        }\n\n\t\treturn (\n\t\t\t<div class='container-fluid' style={`margin-bottom: ${MARGIN_BOTTOM}; margin-top: ${MARGIN_TOP};`}>\n                <button class='btn btn-link pl-0 fixed-top text-primary'\n                    style={`top: ${MARGIN_TOP_BACK}; left: 5px; font-size: 35px; width: 45px;`}\n                    onClick={this.back}>\n                    <i class='fas fa-arrow-circle-left' />\n                </button>\n\n                <div class='bg-light'>\n                    <YrWeather stores={this.props.stores} data={yrWeather} place={place} />\n                </div>\n\n                <StoryAdd stores={this.props.stores} />\n\n                <div class='row bg-light pb-3 pt-3'>\n                    <div class='col-12 offset-0 col-sm-8 offset-sm-2 col-lg-6 offset-lg-3 border-bottom'>\n                        <div class='row'>\n                            <div class='col-7 text-overflow'>\n                                <h3>\n                                    {hashtag && <>\n                                        <span class='badge badge-primary'>#{hashtag}</span>\n                                    </>}\n                                    {team && <>\n                                        <div class='d-flex position-relative'>\n                                            <div\n                                                class={`text-center border rounded-circle imageRounded imageRoundedSmall`}\n                                                style={image ? `background-image: url(\"${image}\"); background-size: cover;` : ''}\n                                            >\n                                                {!image && <div class='text-muted' style='font-size: 20px; padding-top: 3px;'>{shortname}</div>}\n                                            </div>\n                                            <div class='flex-grow-1 pl-3 text-overflow' style='line-height: 1.2em;'>\n                                                <h3 class='mb-1'>\n                                                    {team.public ? <>\n                                                        <a href={`/teams/public/${team.uuidv4}`} class='stretched-link'>{name}</a>\n                                                    </> : <>\n                                                        {name}\n                                                    </>}\n                                                </h3>\n                                            </div>\n                                        </div>\n                                    </>}\n                                </h3>\n                            </div>\n                            <div class='col-5'>\n                                <small class='float-right mt-1'>\n                                    <select\n                                        class='custom-select custom-select-sm'\n                                        id='team'\n                                        onChange={this.sortby}\n                                    >                    \n                                        <option value=''><Text id='story.sort.new'>Nyeste først</Text></option>\n                                        <option value='likes'><Text id='story.sort.likes-desc'>Flest likes først</Text></option>\n                                        <option value='-likes'><Text id='story.sort.likes-asc'>Færrest likes først</Text></option>\n                                        <option value='comments'><Text id='story.sort.comments-desc'>Flest kommentarer først</Text></option>\n                                        <option value='-comments'><Text id='story.sort.comments-asc'>Færrest kommentarer først</Text></option>\n                                    </select>\n                                </small>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <StoryPublicFeed stores={this.props.stores} story={story} hashtag={hashtag} teamid={teamid} path={path} />\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default Home;\n"],"sourceRoot":""}