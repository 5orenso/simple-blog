
{%- macro colorArticleBackground(category, frontpage, isJumbotron, article) -%}
    style="{%- if article && article.background -%}
        background-color: {{ article.background }} !important;
    {%- elseif isJumbotron && category.bgColorJumbotron -%}
        background-color: {{ category.bgColorJumbotron }} !important;
    {%- elseif isFrontpage && frontpage.bgColorJumbotron -%}
        background-color: {{ frontpage.bgColorJumbotron }} !important;
    {%- elseif category.bgColorMain -%}
        background-color: {{ category.bgColorMain }} !important;
    {%- elseif frontpage.bgColorMain -%}
        background-color: {{ frontpage.bgColorMain }} !important;
    {%- endif -%}"
{%- endmacro -%}

{%- macro colorArticleBackgroundPadding(category, frontpage, isJumbotron, article) -%}
    {%- if article && article.background -%}
        p-2
    {%- elseif isJumbotron && category.bgColorJumbotron -%}
        p-2
    {%- elseif isFrontpage && frontpage.bgColorJumbotron -%}
        p-2
    {%- elseif category.bgColorMain -%}
        p-2
    {%- elseif frontpage.bgColorMain -%}
        p-2
    {%- else -%}
        p-0
    {%- endif -%}
{%- endmacro -%}

{%- macro colorArticleText(category, frontpage, isJumbotron, article, heading) -%}
    style="{%- if article && article.forground -%}
        color: {{ article.forground }} !important;
    {%- elseif isJumbotron && category.colorJumbotron -%}
        color: {{ category.colorJumbotron }} !important;
    {%- elseif isFrontpage && frontpage.colorJumbotron -%}
        color: {{ frontpage.colorJumbotron }} !important;
    {%- elseif category.colorMain -%}
        color: {{ category.colorMain }} !important;
    {%- elseif frontpage.colorMain -%}
        color: {{ frontpage.colorMain }} !important;
    {%- endif -%}
    {%- if heading === 'h1' && article && article.fontsizeH1 -%}
        font-size: {{ article.fontsizeH1 }}rem;
    {%- endif -%}
    {%- if heading === 'h1' && article && article.fontweightH1 -%}
        font-weight: {{ article.fontweightH1 }};
    {%- endif -%}
    {%- if heading === 'h3' && article && article.fontsizeH3 -%}
        font-size: {{ article.fontsizeH3 }}rem;
    {%- endif -%}
    {%- if heading === 'h3' && article && article.fontweightH3 -%}
        font-weight: {{ article.fontweightH3 }};
    {%- endif -%}
    {%- if heading === 'h5' && article && article.fontsizeH5 -%}
        font-size: {{ article.fontsizeH5 }}rem;
    {%- endif -%}
    {%- if heading === 'h5' && article && article.fontweightH5 -%}
        font-weight: {{ article.fontweightH5 }};
    {%- endif -%}"
{%- endmacro -%}

{% macro articleTeaser(art, col, extraClasses, heading) %}
    <div class="col-12 col-sm-12 col-md-{{ col || 4 }} post-data my-1 {{ extraClasses }}" >
        <div {{ colorArticleBackground(art.catRef, null, null, art) }}>
        {% if art.img[0] && art.img[0].src|match('(jpg|jpeg|png|gif|heic|heif|svg|webp|tif|JPG)$', 'i') %}
            <div class="post-thumb d-flex align-items-center">
                <a href="{% if art.url %}{{ art.url }}{% else %}/v2/{{ art.category|asLinkPart }}/{{ art.title|asLinkPart }}/{{ art.id }}{% endif %}">
                    <img src="https://{{ imageServer }}/800x/{{ imagePath }}/{{ art.img[0].src }}" alt="{{ art.title|e }}" class="img-fluid">
                </a>
            </div>
        {% endif %}
        <div class="post-content {{ colorArticleBackgroundPadding(art.catRef, null, null, art) }}" {{ colorArticleText(art.catRef, null, null, art) }}>
            {% if art.catRef.hideFrontpageTitle %}
            {% else %}
                <{{ heading || 'h3' }}>
                    <a href="{% if art.url %}{{ art.url }}{% else %}/v2/{{ art.category|asLinkPart }}/{{ art.title|asLinkPart }}/{{ art.id }}{% endif %}" {{ colorArticleText(art.catRef, null, null, art, heading) }}>
                        {{ art.title }}
                    </a>
                </{{ heading || 'h3' }}>
            {% endif %}

            {% if art.catRef.hideFrontpageTeaser %}
            {% elseif art.teaser %}
                <p class='mb-1'>{{ art.teaser|raw }}</p>
            {% elseif art.ingress %}
                <p class='mb-1'>{{ art.ingress|raw }}</p>
            {% endif %}


            {% for widget in ['helloworld', 'clock', 'booking', 'sheet', 'poll', 'gallery', 'weather', 'rating', 'related'] %}
                {% if art.widgetList === widget %}
                    <div class='w-100 my-2' data-widget-host="simple-blog-{{ widget }}">
                        <script type="text/props">
                            {
                                "apiServer": "{{ blog.protocol }}://{{ blog.domain }}",
                                "jwtToken": "{{ jwtToken }}",
                                "sessionEmail": "{{ session.email }}",
                                "sessionAge": "{{ session.age }}",
                                "articleId": {{ article.id }}
                            }
                        </script>
                    </div>
                    <script async src="/preact/simple-blog-{{ widget }}/bundle.js?time={{ env.epoch }}"></script>
                {% endif %}
            {% endfor %}


            <!-- <p class="lead">{{ art.body|substring(0, 150)|markdown|cleanHtml }}...</p> -->
            {% if art.catRef.hideMetaInfo %}
            {% else %}
                <small class='d-none d-lg-inline'>
                    <div {{ colorArticleText(art.catRef, null, null, art) }}>
                        <small class='font-weight-lighter mr-1'>
                            <i class="far fa-folder-open"></i>
                            <a href="/v2/{{ art.category|asLinkPart }}/" class="post-cat text-muted" {{ colorArticleText(art.catRef, null, null, art) }}>{{ art.category }}</a>
                        </small>
                        <small class='font-weight-lighter mr-1'>/</small>
                        <small class='font-weight-lighter mr-1'>{{ art.published|asHumanReadable }}</small>
                        <small class='font-weight-lighter mr-1'>/</small>
                        <small class='font-weight-lighter mr-1'><a title="Lesetid for artikkel"><i class="far fa-clock"></i> {{ art.body|readTime('no') }}</a></small>
                    </div>
                </small>
            {% endif %}
        </div>
        </div>
    </div>

{% endmacro %}
