
{%- macro colorArticleBackground(category, frontpage, isJumbotron, article) -%}
    style="{%- if article && article.background -%}
        background-color: {{ article.background }} !important;
    {%- elseif isJumbotron && category.bgColorJumbotron -%}
        background-color: {{ category.bgColorJumbotron }} !important;
    {%- elseif isFrontpage && frontpage.bgColorJumbotron -%}
        background-color: {{ frontpage.bgColorJumbotron }} !important;
    {%- elseif category.bgColorMain -%}
        background-color: {{ category.bgColorMain }} !important;
    {%- elseif frontpage.bgColorMain -%}
        background-color: {{ frontpage.bgColorMain }} !important;
    {%- endif -%}
    {%- if category.artlistCss -%}
        {{ category.artlistCss }}
    {%- elseif frontpage.artlistCss -%}
        {{ frontpage.artlistCss }}
    {%- elseif blog.artlistCss -%}
        {{ blog.artlistCss }}
    {%- endif -%}"
{%- endmacro -%}

{%- macro colorArticleBackgroundPadding(category, frontpage, isJumbotron, article) -%}
    {%- if article && article.background -%}
        p-2
    {%- elseif isJumbotron && category.bgColorJumbotron -%}
        p-2
    {%- elseif isFrontpage && frontpage.bgColorJumbotron -%}
        p-2
    {%- elseif category.bgColorMain -%}
        p-2
    {%- elseif frontpage.bgColorMain -%}
        p-2
    {%- else -%}
        p-0
    {%- endif -%}
{%- endmacro -%}

{%- macro colorArticleText(category, frontpage, isJumbotron, article, heading) -%}
    style="{%- if article && article.forground -%}
        color: {{ article.forground }} !important;
    {%- elseif isJumbotron && category.colorJumbotron -%}
        color: {{ category.colorJumbotron }} !important;
    {%- elseif isFrontpage && frontpage.colorJumbotron -%}
        color: {{ frontpage.colorJumbotron }} !important;
    {%- elseif category.colorMain -%}
        color: {{ category.colorMain }} !important;
    {%- elseif frontpage.colorMain -%}
        color: {{ frontpage.colorMain }} !important;
    {%- endif -%}
    {%- if category.useImageOneAsBackground -%}
        background: url(https://{{ imageServer }}/1920x/{{ imagePath }}/{{ article.img[0].src }}) no-repeat center center fixed; 
        -webkit-background-size: cover;
        -moz-background-size: cover;
        -o-background-size: cover;
        background-size: cover;
    {%- endif -%}
    {%- if heading === 'h1' && article && article.fontsizeH1 -%}
        font-size: {{ article.fontsizeH1 }}rem;
    {%- endif -%}
    {%- if heading === 'h1' && article && article.fontweightH1 -%}
        font-weight: {{ article.fontweightH1 }};
    {%- endif -%}
    {%- if heading === 'h3' && article && article.fontsizeH3 -%}
        font-size: {{ article.fontsizeH3 }}rem;
    {%- endif -%}
    {%- if heading === 'h3' && article && article.fontweightH3 -%}
        font-weight: {{ article.fontweightH3 }};
    {%- endif -%}
    {%- if heading === 'h5' && article && article.fontsizeH5 -%}
        font-size: {{ article.fontsizeH5 }}rem;
    {%- endif -%}
    {%- if heading === 'h5' && article && article.fontweightH5 -%}
        font-weight: {{ article.fontweightH5 }};
    {%- endif -%}"
{%- endmacro -%}

{% macro adList(adlist) %}
    <div class="{% if adlist[0].catRef.artlistContainerClass %}{{ adlist[0].catRef.artlistContainerClass }}{% else %}container-fluid{% endif %}" {{ colorArticleBackground(adlist[0].catRef) }}>
        <div class="{% if adlist[0].catRef.artlistRowClass %}{{ adlist[0].catRef.artlistRowClass }}{% else %}row d-flex justify-content-center adContainer{% endif %}">
            {% for art in adlist %}
                <div class="{% if art.catRef.artlistColClass %}{{ art.catRef.artlistColClass }}{% else %}col my-2 d-flex align-items-center justify-content-center adBox {% endif %}">
                    {% if art.url %}
                        <a {% if art.catRef.artlistSkipLinkTarget %}{% else %}target="_blank"{% endif %} href="{{ art.url }}" title="{{ art.title|e }} - {{ art.teaser|e }}">
                    {% endif %}
                        {% if art.ingress %}
                            <div class='{{ art.catRef.artlistTeaserClass }}'>{{ art.ingress|md|safe }}</div>
                        {% elseif art.img[0] %}
                            <img src="https://{{ imageServer }}/{% if art.imgSizeList %}{{ art.imgSizeList }}{% elseif art.catRef.artlistImageSize %}{{ art.catRef.artlistImageSize }}{% else %}220x{% endif %}/{{ imagePath }}/{{ art.img[0].src }}"
                                alt="{{ art.title|e }} - {{ art.teaser|e }}"
                                class="{% if art.catRef.artlistImageClass %}{{ art.catRef.artlistImageClass }}{% else %}img-fluid adImage{% endif %}"
                                {% if art.catRef.artlistImageCss %}style="{{ art.catRef.artlistImageCss }}"{% endif %}
                            ><br clear="all">
                        {% elseif art.teaser %}
                            <div class='{{ art.catRef.artlistTeaserClass }}'>{{ art.teaser|md|safe }}</div>
                        {% endif %}
                    {% if art.url %}
                        </a>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    </div>
{% endmacro %}

{% macro designList(artlist) %}
    {% for art in artlist %}
        <div class="{% if art.classNames %}{{ art.classNames }}{% endif %}" {% if art.cssStyles %}style="{{ art.cssStyles }}"{% endif %}>
            {% if art.url %}
                <a {% if art.catRef.artlistSkipLinkTarget %}{% else %}target="_blank"{% endif %} href="{{ art.url }}" title="{{ art.title|e }} - {{ art.teaser|e }}">
            {% endif %}
                {% if art.ingress %}
                    <div class='{{ art.catRef.artlistTeaserClass }}'>{{ art.ingress|md|safe }}</div>
                {% elseif art.img[0] %}
                    <img src="https://{{ imageServer }}/{% if art.imgSizeList %}{{ art.imgSizeList }}{% elseif art.catRef.artlistImageSize %}{{ art.catRef.artlistImageSize }}{% else %}220x{% endif %}/{{ imagePath }}/{{ art.img[0].src }}"
                        alt="{{ art.title|e }} - {{ art.teaser|e }}"
                        class="{% if art.catRef.artlistImageClass %}{{ art.catRef.artlistImageClass }}{% else %}img-fluid{% endif %}"
                        {% if art.catRef.artlistImageCss %}style="{{ art.catRef.artlistImageCss }}"{% endif %}
                    ><br clear="all">
                {% elseif art.teaser %}
                    <div class='{{ art.catRef.artlistTeaserClass }}'>{{ art.teaser|md|safe }}</div>
                {% endif %}
            {% if art.url %}
                </a>
            {% endif %}
        </div>
    {% endfor %}
{% endmacro %}

{% macro articleTeaser(art, col, extraClasses, heading) %}
    <div class="{% if art.catRef.artlistColClass %}{{ art.catRef.artlistColClass }}{% else %}col-12 col-sm-12 col-md-{{ col || 4 }} post-data my-1{% endif %} {{ extraClasses }} {{ art.catRef.artlistContainerClass }}" >
        <div {{ colorArticleBackground(art.catRef, null, null, art) }}>
            {% if art.img[0] && art.img[0].src|match('(jpg|jpeg|png|gif|heic|heif|svg|webp|tif|JPG|JPEG|PNG|GIF|HEIC|HEIF|SVG|WEBP|TIF)$', 'i') %}
                <div class="post-thumb d-flex align-items-center">
                    {% if art.url %}
                        <a href="{{ art.url }}" {{ colorArticleText(art.catRef, null, null, art, heading) }}>
                            <img src="https://{{ imageServer }}/{% if art.imgSizeList %}{{ art.imgSizeList }}{% elseif art.catRef.artlistImageSize %}{{ art.catRef.artlistImageSize }}{% else %}800x{% endif %}/{{ imagePath }}/{{ art.img[0].src }}"
                                alt="{{ art.title|e }}"
                                class="{% if art.catRef.artlistImageClass %}{{ art.catRef.artlistImageClass }}{% else %}img-fluid{% endif %}"
                                {% if art.catRef.artlistImageCss %}style="{{ art.catRef.artlistImageCss }}"{% endif %}
                            >
                        </a>
                    {% elseif art.catRef.skipDefaultArtLink %}
                        <img src="https://{{ imageServer }}/{% if art.imgSizeList %}{{ art.imgSizeList }}{% elseif art.catRef.artlistImageSize %}{{ art.catRef.artlistImageSize }}{% else %}800x{% endif %}/{{ imagePath }}/{{ art.img[0].src }}" alt="{{ art.title|e }}" class="img-fluid {{ art.catRef.artlistImageClass }}">
                    {% else %}
                        <a href="/v2/{{ art.category|asLinkPart }}/{{ art.title|asLinkPart }}/{{ art.id }}">
                            <img src="https://{{ imageServer }}/{% if art.imgSizeList %}{{ art.imgSizeList }}{% elseif art.catRef.artlistImageSize %}{{ art.catRef.artlistImageSize }}{% else %}800x{% endif %}/{{ imagePath }}/{{ art.img[0].src }}" alt="{{ art.title|e }}" class="img-fluid {{ art.catRef.artlistImageClass }}">
                        </a>
                    {% endif %}
                </div>
            {% endif %}
            <div class="post-content {{ colorArticleBackgroundPadding(art.catRef, null, null, art) }}" {{ colorArticleText(art.catRef, null, null, art) }}>
                {% if art.catRef.hideFrontpageTitle %}
                {% else %}
                    <{{ heading || 'h3' }} class="{{ art.catRef.artlistTitleClass }}">
                        {% if art.url %}
                            <a href="{{ art.url }}" {{ colorArticleText(art.catRef, null, null, art, heading) }}>
                                {{ art.title }}
                            </a>
                        {% elseif art.catRef.skipDefaultArtLink %}
                            {{ art.title }}
                        {% else %}
                            <a href="/v2/{{ art.category|asLinkPart }}/{{ art.title|asLinkPart }}/{{ art.id }}" {{ colorArticleText(art.catRef, null, null, art, heading) }}>
                                {{ art.title }}
                            </a>
                        {% endif %}
                    </{{ heading || 'h3' }}>
                {% endif %}

                {% if art.catRef.hideFrontpageTeaser %}
                {% elseif art.teaser %}
                    <div class='mb-1 {{ art.catRef.artlistTeaserClass }}'>{{ art.teaser|md|safe }}</div>
                {% elseif art.ingress %}
                    <div class='mb-1 {{ art.catRef.artlistTeaserClass }}'>{{ art.ingress|md|safe }}</div>
                {% endif %}

                {% for widget in ['helloworld', 'clock', 'booking', 'form', 'sheet', 'poll', 'gallery', 'weather', 'map', 'rating', 'related'] %}
                    {% if art.widgetList === widget %}
                        <div class='w-100 my-2 clearfix' data-widget-host="simple-blog-{{ widget }}">
                            <script type="text/props">
                                {
                                    "apiServer": "{{ blog.protocol }}://{{ blog.domain }}",
                                    "jwtToken": "{{ jwtToken }}",
                                    "sessionEmail": "{{ session.email }}",
                                    "sessionAge": "{{ session.age }}",
                                    "articleId": {{ art.id }}
                                }
                            </script>
                        </div>
                        <script async src="/preact/simple-blog-{{ widget }}/bundle.js?time={{ env.epoch }}"></script>
                    {% endif %}
                {% endfor %}


                <!-- <p class="lead">{{ art.body|substring(0, 150)|markdown|cleanHtml }}...</p> -->
                {% if art.catRef.hideMetaInfo %}
                {% else %}
                    <small class='d-none d-lg-inline'>
                        <div {{ colorArticleText(art.catRef, null, null, art) }}>
                            <small class='font-weight-lighter mr-1'>
                                <i class="far fa-folder-open"></i>
                                <a href="/v2/{{ art.category|asLinkPart }}/" class="post-cat text-muted" {{ colorArticleText(art.catRef, null, null, art) }}>{{ art.category }}</a>
                            </small>
                            <small class='font-weight-lighter mr-1'>/</small>
                            <small class='font-weight-lighter mr-1'>{{ art.published|asHumanReadable }}</small>
                            <small class='font-weight-lighter mr-1'>/</small>
                            <small class='font-weight-lighter mr-1'><a title="Lesetid for artikkel"><i class="far fa-clock"></i> {{ art.body|readTime('no') }}</a></small>
                        </div>
                    </small>
                {% endif %}
            </div>
        </div>
    </div>

{% endmacro %}
